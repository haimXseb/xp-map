# FULL PROJECT DUMP
# This file contains the entire codebase structure and content.
# Treat each section below as a separate file path.

==================================================
FILE_PATH: tsconfig.node.json
==================================================
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



==================================================
FILE_PATH: PRD.md
==================================================
# Dashboard PRD - Project Management Dashboard

**Version**: 1.0  
**Last Updated**: 2025-12-28  
**Status**: Planning

---

## Executive Summary

Dashboard ××•× ×œ×™×™×Ÿ ×œ× ×™×”×•×œ ×”×¤×¨×•×™×§×˜ Figma Accessibility Plugin. ××¡×š ×¨××©×™ ××¨×›×–×™ (Home/Master Plan) ×©××¦×™×’ ×ª××•× ×ª ××¦×‘ ××œ××”, ×¢× drill-down ×œ×˜××‘×™× ××¤×•×¨×˜×™×.

**Core Principle**: "Single Source of Truth" - ×›×œ ×”× ×ª×•× ×™× × ×’×–×¨×™× ××§×‘×¦×™ Markdown/JSON ×©×”×¤×¨×•×™×§×˜ ××™×™×¦×¨, ×œ× ××”×“×©×‘×•×¨×“ ×¢×¦××•.

---

## 1. Architecture Overview

### Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Project Files  â”‚
â”‚  (Source Files) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Generated/Updated by:
         â”‚ - Cursor (after tasks)
         â”‚ - Build scripts
         â”‚ - Git hooks
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Truth Files    â”‚
â”‚  (Markdown/JSON)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Read by:
         â”‚ - Dashboard (fetch)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Dashboard     â”‚
â”‚   (HTML/JS)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Truth Files (Source of Truth)

| File | Format | Purpose | Updated By |
|------|--------|---------|------------|
| `docs/EXECUTION_LOG.json` | JSON | Task status, decisions, blockers | Cursor (after each task) |
| `docs/UI-Map.md` | Markdown | UI state machine, UX flow | Cursor (when UI changes) |
| `docs/Project-plan.md` | Markdown | Master plan with checkboxes | Cursor (when plan updates) |
| `docs/CURRENT_STATUS.md` | Markdown | Active vs Pending rules | Cursor (when rules change) |
| `docs/GIT_STATUS.json` | JSON | Git status snapshot | Script (pre-build hook) |
| `CONTEXT_DUMP.txt` | Text | Last context dump timestamp | Script (context dump) |
| `CHANGELOG.md` | Markdown | Completed tasks history | Cursor (after tasks) |
| `PROMPTS_LOG.json` | JSON | Prompt queue, conflicts | Dashboard (on submit) |

---

## 2. Home Tab - Master Plan View

### 2.1 Header Snapshot

**Location**: Top of Home tab  
**Purpose**: Quick status at a glance

**Components**:

1. **Current Goal**
   - **Source**: `docs/EXECUTION_LOG.json` â†’ `currentGoal`
   - **Display**: "MVP Brain + Visibility tooling + Protocol Safety"
   - **Update**: Cursor updates after phase completion

2. **Build/Run Status**
   - **Source**: `CONTEXT_DUMP.txt` â†’ First line header
   - **Display**: "Last Context Dump: YYYY-MM-DD HH:MM"
   - **Format**: Parse `## Last Dump: 2025-12-28 10:30:00` from file header

3. **Current Phase**
   - **Source**: `docs/EXECUTION_LOG.json` â†’ `currentPhase`
   - **Display**: "Phase 2 / 3 / 4"
   - **Values**: `"phase2"`, `"phase3"`, `"phase4"`

4. **Blockers**
   - **Source**: `docs/EXECUTION_LOG.json` â†’ `blockers[]`
   - **Display**: "Blockers: N" (count)
   - **Details**: Expandable list showing blocker titles

**Layout**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ Current Goal: MVP Brain + Visibility...     â”‚
â”‚ ğŸ“… Last Context Dump: 2025-12-28 10:30         â”‚
â”‚ ğŸš€ Current Phase: Phase 2                       â”‚
â”‚ âš ï¸  Blockers: 2                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Progress Bars

**Location**: Below header  
**Purpose**: Visual progress indicators

**Components**:

1. **Master Plan Completion**
   - **Source**: `docs/Project-plan.md` + `docs/EXECUTION_LOG.json`
   - **Calculation**: 
     - Total: Count all `- [ ]` and `- [x]` in Project-plan.md
     - Completed: Count `- [x]` + items in EXECUTION_LOG with `status: "done"`
     - Percentage: `(completed / total) * 100`
   - **Display**: Progress bar (0-100%) + percentage text
   - **Visual**: SVG progress ring (donut chart)

2. **Rules Coverage**
   - **Source**: `docs/CURRENT_STATUS.md`
   - **Calculation**:
     - Total: Count all rules (TF-01..TF-14, BL-01..BL-05, etc.)
     - Active: Count rules with `status: "implemented"` in CURRENT_STATUS.md
     - Percentage: `(active / total) * 100`
   - **Display**: Progress bar (0-100%) + percentage text
   - **Visual**: SVG progress ring (donut chart)

**Layout**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Master Plan Completion                          â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 65%                    â”‚
â”‚                                                 â”‚
â”‚ Rules Coverage                                  â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 40%                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Quick Cards (4 Cards)

**Location**: Below progress bars  
**Purpose**: "Taste of each tab" - quick preview

**Card 1: Tasks**
- **Source**: `CHANGELOG.md` (completed) + `docs/EXECUTION_LOG.json` (pending)
- **Display**:
  - 3 last completed (from CHANGELOG.md, latest first)
  - 3 next pending (from EXECUTION_LOG.json, `status: "pending"`, sorted by priority)
- **Click**: Navigate to Tasks tab

**Card 2: Logs**
- **Source**: `docs/EXECUTION_LOG.json` â†’ `logEntries[]`
- **Display**: Last 5 log entries
- **Format**: `[YYYY-MM-DD HH:MM] Message`
- **Click**: Navigate to Logs tab

**Card 3: UI States**
- **Source**: `docs/UI-Map.md`
- **Display**: Summary of UI state machine
  - States: `Idle â†’ Analyzing â†’ Review â†’ Results`
  - Current state (if available from last run)
- **Click**: Navigate to Docs tab â†’ UI-Map section

**Card 4: Git Status**
- **Source**: `docs/GIT_STATUS.json`
- **Display**:
  - Working tree: `clean` / `dirty` (with file count)
  - Branch: Current branch name
  - Status: `ahead N` / `behind N` / `up to date`
  - Last push: Timestamp
- **Click**: Show git commands (copy to clipboard)

**Layout**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tasks      â”‚    Logs      â”‚  UI States   â”‚  Git Status  â”‚
â”‚ 3 completed  â”‚ 5 entries    â”‚ Idleâ†’Analyze â”‚ clean, main  â”‚
â”‚ 3 pending    â”‚ [timestamps]â”‚ â†’Review      â”‚ up to date   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 Master Plan Tree

**Location**: Main content area  
**Purpose**: Hierarchical view of entire project plan

**Structure**: Phase â†’ Epic â†’ Task

**Source**: `docs/Project-plan.md` + `docs/EXECUTION_LOG.json`

**Hierarchy**:

```
Phase 2: Ops & Visibility
â”œâ”€â”€ EXECUTION_LOG.md
â”‚   â”œâ”€â”€ Status: DONE / IN PROGRESS / TODO
â”‚   â”œâ”€â”€ Owner: Cursor / Haim
â”‚   â””â”€â”€ Evidence: "docs/EXECUTION_LOG.json line X"
â”œâ”€â”€ context-dump.mjs
â”‚   â”œâ”€â”€ Status: DONE
â”‚   â”œâ”€â”€ Owner: Cursor
â”‚   â””â”€â”€ Evidence: "scripts/context-dump.mjs exists"
â””â”€â”€ UI-Map.md
    â”œâ”€â”€ Status: DONE
    â”œâ”€â”€ Owner: Cursor
    â””â”€â”€ Evidence: "docs/UI-Map.md exists"

Phase 3: Rules
â”œâ”€â”€ Text Field (TF-01..TF-14)
â”‚   â”œâ”€â”€ TF-01: Status, Owner, Evidence
â”‚   â”œâ”€â”€ TF-02: Status, Owner, Evidence
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Button (BL-01..BL-05)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Checkbox (CB-01..CB-03)
â”‚   â””â”€â”€ ...
â””â”€â”€ Select (SC-01..SC-03)
    â””â”€â”€ ...

Phase 4: Wiring
â”œâ”€â”€ code.ts wiring
â”‚   â”œâ”€â”€ Status: IN PROGRESS
â”‚   â”œâ”€â”€ Owner: Cursor
â”‚   â””â”€â”€ Evidence: "src/code.ts has orchestrator, missing rule hooks"
â””â”€â”€ schema conformance
    â”œâ”€â”€ Status: TODO
    â”œâ”€â”€ Owner: Cursor
    â””â”€â”€ Evidence: "src/protocol.ts needs validation"
```

**Display Format**:

Each row shows:
- **Icon**: âœ… (done) / ğŸ”„ (in-progress) / â³ (todo)
- **Name**: Phase/Epic/Task name
- **Status Badge**: DONE / IN PROGRESS / TODO
- **Owner**: Cursor / Haim
- **Evidence Link**: Clickable link to verify (file path + line/function)

**Interaction**:
- Click on Phase â†’ Expand/collapse children
- Click on Evidence â†’ Show file content (if available via API) or copy path
- Filter by: Status, Owner, Phase

**Data Structure** (from EXECUTION_LOG.json):

```json
{
  "phases": [
    {
      "id": "phase2",
      "name": "Ops & Visibility",
      "epics": [
        {
          "id": "execution-log",
          "name": "EXECUTION_LOG.md",
          "status": "done",
          "owner": "Cursor",
          "evidence": "docs/EXECUTION_LOG.json",
          "tasks": []
        },
        {
          "id": "rules",
          "name": "Rules Implementation",
          "status": "in-progress",
          "owner": "Cursor",
          "evidence": "src/rules/textField.ts",
          "tasks": [
            {
              "id": "tf-01",
              "name": "TF-01: Field Label",
              "status": "done",
              "owner": "Cursor",
              "evidence": "src/rules/textField.ts:45-67"
            }
          ]
        }
      ]
    }
  ]
}
```

### 2.5 Prompt Queue

**Location**: Bottom of Home tab  
**Purpose**: Manage prompts to prevent spaghetti

**Source**: `PROMPTS_LOG.json`

**Display**:

For each prompt in queue:
- **Prompt Text**: First 100 chars + "..."
- **Tags**: `[code.ts, ui.html, protocol, docs]`
- **Phase**: `2/3/4`
- **Locked**: `true/false` (if locked, show lock icon)
- **Conflicts**: List conflicting prompts (by tags)
- **Created**: Timestamp

**Actions**:
- **"Send to Cursor"**: 
  - Shows normalized prompt version
  - Includes "What's already DONE" context (from EXECUTION_LOG)
  - Prevents duplication
  - **Note**: Doesn't actually send (no API integration), just formats for copy

**Data Structure** (PROMPTS_LOG.json):

```json
{
  "prompts": [
    {
      "id": "prompt-001",
      "text": "Create TF-01 rule...",
      "tags": ["code.ts", "rules"],
      "phase": "phase3",
      "locked": false,
      "conflicts": [],
      "created": "2025-12-28T10:30:00Z",
      "touches": ["src/code.ts", "src/rules/textField.ts"]
    }
  ]
}
```

---

## 3. Existing Tabs (Enhanced)

### 3.1 Tasks Tab

**Current**: Reads CHANGELOG.md + Project-plan.md  
**Enhancement**: 
- Add filter (completed/in-progress/pending)
- Add owner column
- Add evidence links
- Add drill-down to Master Plan Tree

### 3.2 Logs Tab

**Current**: Static display  
**Enhancement**:
- Read from `docs/EXECUTION_LOG.json` â†’ `logEntries[]`
- Filter by date, type, phase
- Search functionality

### 3.3 Files Tab

**Current**: Static list  
**Enhancement**:
- Read from `docs/GIT_STATUS.json` â†’ `modifiedFiles[]`
- Show actual file modification times
- Link to GitHub (if repo available)

### 3.4 Docs Tab

**Current**: Basic links  
**Enhancement**:
- Organized by category (Source of Truth, Project Docs, Research)
- Show last modified date
- Quick preview (first 200 chars)

### 3.5 Reasoning Tab

**Current**: Empty  
**Enhancement**:
- Read from `docs/EXECUTION_LOG.json` â†’ `reasoning[]`
- Each entry shows:
  - Action taken
  - Why (reasoning)
  - Related files
  - Timestamp

### 3.6 New Task Tab

**Current**: Saves to localStorage  
**Enhancement**:
- Save to `PROMPTS_LOG.json` (or append to EXECUTION_LOG.json)
- Auto-detect conflicts (by tags)
- Suggest phase based on task content

---

## 4. Data Files Specification

### 4.1 docs/EXECUTION_LOG.json

**Format**: JSON  
**Purpose**: Single source of truth for task status, decisions, blockers

**Schema**:

```json
{
  "metadata": {
    "version": "1.0",
    "lastUpdated": "2025-12-28T10:30:00Z",
    "currentPhase": "phase3",
    "currentGoal": "MVP Brain + Visibility tooling + Protocol Safety"
  },
  "blockers": [
    {
      "id": "blocker-001",
      "title": "Missing TF-01 implementation",
      "description": "TF-01 rule not implemented in src/rules/textField.ts",
      "severity": "high",
      "created": "2025-12-28T10:00:00Z"
    }
  ],
  "phases": [
    {
      "id": "phase2",
      "name": "Ops & Visibility",
      "epics": [
        {
          "id": "execution-log",
          "name": "EXECUTION_LOG.md",
          "status": "done",
          "owner": "Cursor",
          "evidence": "docs/EXECUTION_LOG.json",
          "tasks": []
        }
      ]
    }
  ],
  "logEntries": [
    {
      "timestamp": "2025-12-28T10:30:00Z",
      "type": "task_completed",
      "message": "Created EXECUTION_LOG.json structure",
      "phase": "phase2",
      "files": ["docs/EXECUTION_LOG.json"]
    }
  ],
  "reasoning": [
    {
      "timestamp": "2025-12-28T10:30:00Z",
      "action": "Created EXECUTION_LOG.json",
      "why": "Need single source of truth for task status",
      "relatedFiles": ["docs/EXECUTION_LOG.json"],
      "phase": "phase2"
    }
  ]
}
```

**Updated By**: Cursor (after each task completion)

### 4.2 docs/UI-Map.md

**Format**: Markdown  
**Purpose**: UI state machine documentation

**Structure**:

```markdown
# UI State Machine

## States
- `IDLE` - No selection
- `IDENTIFYING` - Scanning/vision in progress
- `NEEDS_CONFIRMATION` - ASK flow
- `IDENTIFIED` - Confirmed by user
- `PLAN_READY` - Plan shown
- `EXECUTING` - Applying fixes
- `DONE` - Complete

## Transitions
IDLE â†’ IDENTIFYING (on selection + "Accessible it" click)
IDENTIFYING â†’ NEEDS_CONFIRMATION (if confidence < 0.90)
IDENTIFYING â†’ IDENTIFIED (if confidence >= 0.90)
...
```

**Updated By**: Cursor (when UI state machine changes)

### 4.3 docs/CURRENT_STATUS.md

**Format**: Markdown  
**Purpose**: Active vs Pending rules

**Structure**:

```markdown
# Current Rules Status

## Text Field Rules
- TF-01: Field Label - âœ… Implemented (src/rules/textField.ts:45)
- TF-02: Field Required - â³ Pending
- TF-03: Field Validation - âœ… Implemented
...

## Button Rules
- BL-01: Button Roles - âœ… Implemented
- BL-02: Button Labeling - â³ Pending
...
```

**Updated By**: Cursor (when rules are implemented)

### 4.4 docs/GIT_STATUS.json

**Format**: JSON  
**Purpose**: Git status snapshot

**Schema**:

```json
{
  "branch": "main",
  "workingTree": "clean",
  "modifiedFiles": [],
  "ahead": 0,
  "behind": 0,
  "lastPush": "2025-12-27T14:20:00Z",
  "lastCommit": "2025-12-28T10:30:00Z",
  "timestamp": "2025-12-28T10:30:00Z"
}
```

**Updated By**: Script (pre-build hook) - `scripts/git-status.cjs`

### 4.5 CONTEXT_DUMP.txt

**Format**: Text with header  
**Purpose**: Last context dump timestamp

**Structure**:

```
## Last Dump: 2025-12-28 10:30:00
## Generated by: scripts/context-dump.mjs

[Context content...]
```

**Updated By**: Script (context dump script)

### 4.6 PROMPTS_LOG.json

**Format**: JSON  
**Purpose**: Prompt queue management

**Schema**:

```json
{
  "prompts": [
    {
      "id": "prompt-001",
      "text": "Full prompt text...",
      "tags": ["code.ts", "ui.html"],
      "phase": "phase3",
      "locked": false,
      "conflicts": ["prompt-002"],
      "created": "2025-12-28T10:30:00Z",
      "touches": ["src/code.ts", "ui/ui.html"],
      "status": "pending"
    }
  ]
}
```

**Updated By**: Dashboard (on prompt submit)

---

## 5. Implementation Details

### 5.1 File Reading Strategy

**Static HTML Limitation**: Cannot read files directly from filesystem

**Solution**: 
- **Option A**: GitHub Pages + Raw GitHub URLs
  - Read files via: `https://raw.githubusercontent.com/[user]/[repo]/main/docs/EXECUTION_LOG.json`
  - **Pros**: Simple, no server needed
  - **Cons**: Requires public repo, CORS issues

- **Option B**: Vercel/Netlify + API endpoints
  - API endpoint: `/api/files.js` reads files from project
  - **Pros**: Works with private repos, no CORS
  - **Cons**: Requires serverless function

- **Option C**: Build-time generation
  - Script generates `dashboard/data.json` with all data
  - Dashboard reads single JSON file
  - **Pros**: Fast, no API needed
  - **Cons**: Requires rebuild on every change

**Recommendation**: Start with Option C (build-time), migrate to Option B if needed.

### 5.2 Git Status Script

**File**: `scripts/git-status.cjs`

**Purpose**: Generate `docs/GIT_STATUS.json` before build

**Implementation**:

```javascript
const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

function getGitStatus() {
  try {
    const branch = execSync('git rev-parse --abbrev-ref HEAD', { encoding: 'utf8' }).trim();
    const status = execSync('git status --porcelain', { encoding: 'utf8' });
    const modifiedFiles = status.split('\n')
      .filter(line => line.trim())
      .map(line => line.substring(3).trim());
    
    const ahead = execSync('git rev-list --count HEAD..@{upstream} 2>/dev/null || echo 0', { encoding: 'utf8' }).trim();
    const behind = execSync('git rev-list --count @{upstream}..HEAD 2>/dev/null || echo 0', { encoding: 'utf8' }).trim();
    
    const lastCommit = execSync('git log -1 --format=%ci', { encoding: 'utf8' }).trim();
    
    return {
      branch,
      workingTree: modifiedFiles.length > 0 ? 'dirty' : 'clean',
      modifiedFiles,
      ahead: parseInt(ahead) || 0,
      behind: parseInt(behind) || 0,
      lastCommit,
      timestamp: new Date().toISOString()
    };
  } catch (error) {
    return {
      branch: 'unknown',
      workingTree: 'unknown',
      modifiedFiles: [],
      ahead: 0,
      behind: 0,
      error: error.message,
      timestamp: new Date().toISOString()
    };
  }
}

const status = getGitStatus();
const outputPath = path.resolve(__dirname, '..', 'docs', 'GIT_STATUS.json');
fs.writeFileSync(outputPath, JSON.stringify(status, null, 2));
console.log('âœ… GIT_STATUS.json updated');
```

**Hook**: Add to `package.json` â†’ `"prebuild": "node scripts/git-status.cjs"`

### 5.3 Context Dump Script

**File**: `scripts/context-dump.mjs` (or `.cjs`)

**Purpose**: Generate `CONTEXT_DUMP.txt` with timestamp header

**Implementation**:

```javascript
const fs = require('fs');
const path = require('path');

const timestamp = new Date().toISOString().replace('T', ' ').substring(0, 19);
const header = `## Last Dump: ${timestamp}\n## Generated by: scripts/context-dump.mjs\n\n`;

// Generate context (file structure, recent changes, etc.)
const context = generateContext(); // Implementation depends on what context you want

const outputPath = path.resolve(__dirname, '..', 'CONTEXT_DUMP.txt');
fs.writeFileSync(outputPath, header + context);
console.log('âœ… CONTEXT_DUMP.txt updated');
```

---

## 6. Dashboard Features Matrix

| Feature | Tab | Source File | Update Frequency | Updated By |
|---------|-----|-------------|------------------|------------|
| Current Goal | Home | EXECUTION_LOG.json | On phase change | Cursor |
| Last Context Dump | Home | CONTEXT_DUMP.txt | On context dump | Script |
| Current Phase | Home | EXECUTION_LOG.json | On phase change | Cursor |
| Blockers | Home | EXECUTION_LOG.json | On blocker add/remove | Cursor |
| Master Plan Progress | Home | Project-plan.md + EXECUTION_LOG.json | On task completion | Cursor |
| Rules Coverage | Home | CURRENT_STATUS.md | On rule implementation | Cursor |
| Recent Tasks | Home â†’ Tasks | CHANGELOG.md + EXECUTION_LOG.json | On task completion | Cursor |
| Recent Logs | Home â†’ Logs | EXECUTION_LOG.json | On log entry | Cursor |
| UI States | Home â†’ Docs | UI-Map.md | On UI change | Cursor |
| Git Status | Home | GIT_STATUS.json | Pre-build | Script |
| Master Plan Tree | Home | Project-plan.md + EXECUTION_LOG.json | On task/phase change | Cursor |
| Prompt Queue | Home | PROMPTS_LOG.json | On prompt submit | Dashboard |
| All Tasks | Tasks | CHANGELOG.md + EXECUTION_LOG.json | On task completion | Cursor |
| All Logs | Logs | EXECUTION_LOG.json | On log entry | Cursor |
| Recent Files | Files | GIT_STATUS.json | Pre-build | Script |
| Documentation | Docs | File system | On doc update | Cursor |
| Reasoning | Reasoning | EXECUTION_LOG.json | On action | Cursor |
| New Task | New Task | PROMPTS_LOG.json | On submit | Dashboard |

---

## 7. User Flows

### 7.1 View Project Status

1. User opens dashboard
2. Dashboard loads Home tab (default)
3. Dashboard fetches:
   - `docs/EXECUTION_LOG.json` (status, blockers, phases)
   - `docs/Project-plan.md` (master plan)
   - `docs/CURRENT_STATUS.md` (rules)
   - `docs/GIT_STATUS.json` (git status)
   - `CONTEXT_DUMP.txt` (last dump)
4. Dashboard renders:
   - Header snapshot
   - Progress bars
   - Quick cards
   - Master Plan Tree
   - Prompt Queue
5. User can:
   - Click on any item to drill down
   - Navigate to specific tabs
   - Filter/search

### 7.2 Create New Task

1. User navigates to "New Task" tab
2. User fills form:
   - Title
   - Description
   - Status (pending/in-progress/completed)
3. User submits
4. Dashboard:
   - Checks for conflicts (by tags)
   - Shows conflicts if any
   - Saves to `PROMPTS_LOG.json`
   - Updates display
5. User clicks "Send to Cursor"
6. Dashboard shows normalized prompt with:
   - What's already DONE (from EXECUTION_LOG)
   - Context about related files
   - Formatted for copy-paste

### 7.3 View Master Plan Tree

1. User on Home tab
2. User sees hierarchical tree
3. User clicks on Phase â†’ Expands/collapses
4. User clicks on Epic â†’ Shows tasks
5. User clicks on Evidence link â†’ Shows file path (or content if API available)
6. User can filter by:
   - Status (DONE/IN PROGRESS/TODO)
   - Owner (Cursor/Haim)
   - Phase

---

## 8. Technical Implementation

### 8.1 File Reading (Client-Side)

**Challenge**: Browser cannot read local files directly

**Solution A**: GitHub Pages + Raw URLs

```javascript
async function loadExecutionLog() {
  const repo = 'your-username/your-repo'; // From config
  const url = `https://raw.githubusercontent.com/${repo}/main/docs/EXECUTION_LOG.json`;
  const response = await fetch(url);
  return await response.json();
}
```

**Solution B**: Vercel API

```javascript
async function loadExecutionLog() {
  const response = await fetch('/api/files?file=docs/EXECUTION_LOG.json');
  return await response.json();
}
```

**Solution C**: Build-time data bundle

```javascript
// scripts/generate-dashboard-data.cjs
const data = {
  executionLog: require('../docs/EXECUTION_LOG.json'),
  gitStatus: require('../docs/GIT_STATUS.json'),
  // ... other data
};
fs.writeFileSync('dashboard/data.json', JSON.stringify(data));
```

```javascript
// dashboard/index.html
const data = await fetch('data.json').then(r => r.json());
```

### 8.2 Progress Ring (SVG)

**Implementation** (no libraries):

```html
<svg width="120" height="120" viewBox="0 0 120 120">
  <circle cx="60" cy="60" r="50" fill="none" stroke="#2a3f5f" stroke-width="10"/>
  <circle cx="60" cy="60" r="50" fill="none" stroke="#4a9eff" stroke-width="10"
          stroke-dasharray="314" stroke-dashoffset="110" transform="rotate(-90 60 60)"/>
  <text x="60" y="65" text-anchor="middle" fill="#4a9eff" font-size="20" font-weight="bold">65%</text>
</svg>
```

**Calculation**: `stroke-dashoffset = circumference * (1 - percentage/100)`

### 8.3 Master Plan Tree Rendering

**Data Structure**: Nested JSON from EXECUTION_LOG.json

**Rendering**: Recursive component

```javascript
function renderPhase(phase) {
  return `
    <div class="phase">
      <div class="phase-header" onclick="togglePhase('${phase.id}')">
        <span class="icon">${getStatusIcon(phase.status)}</span>
        <span class="name">${phase.name}</span>
        <span class="badge">${phase.status}</span>
      </div>
      <div class="phase-children" id="phase-${phase.id}">
        ${phase.epics.map(epic => renderEpic(epic)).join('')}
      </div>
    </div>
  `;
}
```

---

## 9. Future Enhancements

### 9.1 Real-time Updates

**Current**: Manual refresh  
**Future**: WebSocket or Server-Sent Events for live updates

### 9.2 Cursor Integration

**Current**: Manual copy-paste  
**Future**: API endpoint that Cursor can call to update EXECUTION_LOG.json

### 9.3 Task Dependencies

**Future**: Show task dependencies in Master Plan Tree

### 9.4 Time Tracking

**Future**: Track time spent on tasks

### 9.5 Automated Testing

**Future**: Show test results in dashboard

### 9.6 Performance Metrics

**Future**: Build time, bundle size, etc.

---

## 10. Deployment Checklist

- [ ] Create `docs/EXECUTION_LOG.json` with initial structure
- [ ] Create `docs/UI-Map.md` with UI state machine
- [ ] Create `docs/CURRENT_STATUS.md` with rules status
- [ ] Create `scripts/git-status.cjs` for Git status
- [ ] Create `scripts/context-dump.mjs` for context dumps
- [ ] Update `package.json` with pre-build hook
- [ ] Implement Home tab with all sections
- [ ] Implement file reading (choose strategy)
- [ ] Test with real data
- [ ] Deploy to GitHub Pages / Vercel
- [ ] Document usage in `dashboard/README.md`

---

## 11. Success Metrics

- **Single Source of Truth**: All data comes from truth files, not dashboard
- **Drill-down**: User can go from Home â†’ specific tab â†’ specific item
- **Real-time**: Data reflects current project state
- **No Duplication**: Prompt queue prevents duplicate work
- **Evidence-based**: Every task has evidence link for verification

---

## 12. Enhancement Proposals (Beyond Current Plan)

### 12.1 AI-Powered Insights

**Idea**: Use AI to analyze project state and suggest next actions

**Features**:
- **Bottleneck Detection**: Identify phases/tasks that are blocking progress
- **Resource Allocation**: Suggest which tasks should be prioritized based on dependencies
- **Risk Assessment**: Flag potential blockers before they become critical
- **Completion Prediction**: Estimate time to completion based on historical data

**Implementation**:
- Analyze EXECUTION_LOG.json patterns
- Use OpenAI API (if available) or local LLM
- Generate insights daily/weekly

**Value**: Proactive project management, not just reactive tracking

---

### 12.2 Visual Timeline

**Idea**: Gantt chart or timeline view of project phases

**Features**:
- **Phase Timeline**: Visual representation of Phase 2/3/4 with dependencies
- **Milestone Tracking**: Mark major milestones (MVP, Beta, Release)
- **Burndown Chart**: Track progress over time
- **Velocity Metrics**: Tasks completed per week/month

**Implementation**:
- Use SVG or Canvas for rendering
- Data from EXECUTION_LOG.json timestamps
- Interactive: Click to zoom, filter by phase

**Value**: Better understanding of project timeline and progress

---

### 12.3 Code Coverage Dashboard

**Idea**: Show code coverage for rules implementation

**Features**:
- **Rule Coverage Map**: Visual map showing which rules are implemented
- **File Coverage**: Which files have tests, which don't
- **Test Results**: Pass/fail status for each rule test
- **Coverage Trends**: How coverage changes over time

**Implementation**:
- Parse test files (`src/rules/**/*.test.ts`)
- Track coverage from test runners
- Visual heatmap of coverage

**Value**: Ensure all rules are tested and working

---

### 12.4 Dependency Graph

**Idea**: Visual graph of task/rule dependencies

**Features**:
- **Task Dependencies**: Show which tasks depend on others
- **Rule Dependencies**: Show which rules depend on other rules
- **Critical Path**: Highlight tasks that block others
- **Impact Analysis**: Show what breaks if a task is delayed

**Implementation**:
- Build dependency graph from EXECUTION_LOG.json
- Use D3.js or similar for visualization
- Interactive: Click to see dependencies

**Value**: Better planning, avoid blocking tasks

---

### 12.5 Automated Status Reports

**Idea**: Generate weekly/monthly status reports automatically

**Features**:
- **Weekly Summary**: What was completed, what's in progress, blockers
- **Monthly Review**: Phase progress, velocity, trends
- **Stakeholder Report**: High-level summary for non-technical stakeholders
- **Export Options**: PDF, Markdown, Email

**Implementation**:
- Template-based report generation
- Data from EXECUTION_LOG.json
- Scheduled generation (cron job or GitHub Actions)

**Value**: Save time on status updates, consistent reporting

---

### 12.6 Integration with External Tools

**Idea**: Connect dashboard with external project management tools

**Features**:
- **GitHub Issues Sync**: Sync tasks with GitHub Issues
- **Notion Integration**: Export to Notion database
- **Slack Notifications**: Send updates to Slack channel
- **Calendar Integration**: Add milestones to calendar

**Implementation**:
- API integrations
- Webhook support
- OAuth for authentication

**Value**: Single dashboard, multiple tools

---

### 12.7 Search & Filtering

**Idea**: Advanced search and filtering capabilities

**Features**:
- **Full-text Search**: Search across all tasks, logs, docs
- **Advanced Filters**: Filter by date, owner, phase, status, tags
- **Saved Filters**: Save common filter combinations
- **Search History**: Remember recent searches

**Implementation**:
- Client-side search (for small datasets)
- Server-side search (for large datasets)
- Indexing for performance

**Value**: Find information quickly

---

### 12.8 Mobile Responsive

**Idea**: Optimize dashboard for mobile devices

**Features**:
- **Responsive Layout**: Works on phone/tablet
- **Touch-friendly**: Large buttons, swipe gestures
- **Offline Mode**: Cache data for offline viewing
- **Push Notifications**: Get notified of important updates

**Implementation**:
- CSS media queries
- Progressive Web App (PWA)
- Service worker for offline

**Value**: Check status on the go

---

### 12.9 Collaborative Features

**Idea**: Enable collaboration between team members

**Features**:
- **Comments**: Add comments to tasks/logs
- **Assignments**: Assign tasks to team members
- **Activity Feed**: See what others are working on
- **Notifications**: Get notified of changes

**Implementation**:
- Backend API for comments/assignments
- Real-time updates (WebSocket)
- User authentication

**Value**: Better team coordination

---

### 12.10 Analytics & Metrics

**Idea**: Deep analytics on project progress

**Features**:
- **Velocity Tracking**: Tasks completed per sprint/week
- **Cycle Time**: Time from task creation to completion
- **Blocker Frequency**: How often blockers occur
- **Phase Duration**: How long each phase takes
- **Predictive Analytics**: Predict completion dates

**Implementation**:
- Data analysis from EXECUTION_LOG.json
- Charts/graphs for visualization
- Statistical analysis

**Value**: Data-driven project management

---

### 12.11 Automated Testing Integration

**Idea**: Show test results in dashboard

**Features**:
- **Test Status**: Pass/fail for each rule test
- **Coverage Metrics**: Code coverage per rule
- **Test History**: Historical test results
- **Failure Analysis**: Why tests are failing

**Implementation**:
- Parse test output
- Integrate with test runners
- Visual test results

**Value**: Ensure quality, catch regressions early

---

### 12.12 Documentation Generator

**Idea**: Auto-generate documentation from project state

**Features**:
- **API Documentation**: Generate from code comments
- **Architecture Diagrams**: Generate from code structure
- **Change Log**: Auto-generate from EXECUTION_LOG.json
- **User Guides**: Generate from UI-Map.md

**Implementation**:
- Parse code comments
- Generate Markdown/HTML
- Template-based generation

**Value**: Always up-to-date documentation

---

### 12.13 Performance Monitoring

**Idea**: Track plugin performance metrics

**Features**:
- **Build Time**: How long builds take
- **Bundle Size**: Plugin bundle size over time
- **Runtime Performance**: Plugin execution time
- **Memory Usage**: Memory consumption

**Implementation**:
- Collect metrics during build
- Store in metrics file
- Visualize in dashboard

**Value**: Optimize performance, catch regressions

---

### 12.14 Export & Backup

**Idea**: Export dashboard data for backup/analysis

**Features**:
- **Export JSON**: Export all data as JSON
- **Export PDF**: Generate PDF report
- **Backup**: Automatic backups to cloud storage
- **Version History**: Track changes to truth files

**Implementation**:
- Export functionality
- Cloud storage integration (S3, Google Drive)
- Version control for truth files

**Value**: Data safety, historical analysis

---

### 12.15 Customizable Dashboard

**Idea**: Let users customize dashboard layout

**Features**:
- **Widgets**: Add/remove/reorder widgets
- **Themes**: Dark/light mode, custom colors
- **Layouts**: Choose layout (grid, list, etc.)
- **Preferences**: Save user preferences

**Implementation**:
- LocalStorage for preferences
- Drag-and-drop for widgets
- Theme system

**Value**: Personalized experience

---

## 13. Priority Ranking

**High Priority** (Implement First):
1. âœ… Home tab with Master Plan Tree (current plan)
2. âœ… Truth files structure (EXECUTION_LOG.json, etc.)
3. âœ… Git status integration
4. âœ… Prompt queue

**Medium Priority** (Next Phase):
1. Visual Timeline
2. Code Coverage Dashboard
3. Search & Filtering
4. Automated Status Reports

**Low Priority** (Future):
1. AI-Powered Insights
2. Integration with External Tools
3. Mobile Responsive
4. Collaborative Features

---

**End of PRD**



==================================================
FILE_PATH: index.html
==================================================
<!doctype html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Figma Plugin - Project Dashboard</title>
</head>

<body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
</body>

</html>

==================================================
FILE_PATH: README_GITHUB_PAGES.md
==================================================
# GitHub Pages Setup

## ××•×˜×•××˜×™ (××•××œ×¥)

×”×“×©×‘×•×¨×“ ××•×’×“×¨ ×œ-deploy ××•×˜×•××˜×™ ×œ-GitHub Pages ×“×¨×š GitHub Actions.

**××” ×§×•×¨×”:**
1. ×›×œ push ×œ-`main` branch ×¢× ×©×™× ×•×™×™× ×‘-`dashboard/` ××• ×‘-truth files
2. GitHub Actions ×‘×•× ×” ××ª ×”×“×©×‘×•×¨×“
3. ××¢×œ×” ×œ-GitHub Pages
4. ×”×“×©×‘×•×¨×“ ×–××™×Ÿ ×‘: `https://[username].github.io/[repo-name]/dashboard/`

**×”×’×“×¨×” ×¨××©×•× ×™×ª:**
1. ×‘-GitHub: Settings â†’ Pages
2. Source: "GitHub Actions" (×œ× "Deploy from a branch")
3. ×–×”×•! ×›×œ push ×™×‘× ×” ×•×™×¢×œ×” ××•×˜×•××˜×™×ª

## ×™×“× ×™

×× ××ª×” ×¨×•×¦×” ×œ×”×¢×œ×•×ª ×™×“× ×™×ª:

```bash
cd dashboard
npm run build
# ×”×¢×œ×” ××ª ×ª×™×§×™×™×ª dist/ ×œ-gh-pages branch
```

## ×‘×“×™×§×” ××§×•××™×ª

```bash
cd dashboard
npm run build
npm run preview
# ×¤×ª×—: http://localhost:4173
```



==================================================
FILE_PATH: INSTALL.md
==================================================
# ×”×•×¨××•×ª ×”×ª×§× ×” - Dashboard React

## ×©×œ×‘ 1: ×”×ª×§× ×ª Dependencies

```bash
cd dashboard
npm install
```

## ×©×œ×‘ 2: ×”×¢×ª×§×ª ×”×§×•×“ ×”××œ×

×”×§×•×“ ×”××œ× × ××¦× ×‘-`src/App_FULL.tsx`. ×”×¢×ª×§ ××•×ª×•:

```bash
cp src/App_FULL.tsx src/App.tsx
```

××• ×¤×ª×— `src/App.tsx` ×•×”×¢×ª×§ ××ª ×”×ª×•×›×Ÿ ×-`App_FULL.tsx`.

## ×©×œ×‘ 3: ×‘×“×™×§×”

```bash
npm run dev
```

×¤×ª×— `http://localhost:5173` - ×”×“×©×‘×•×¨×“ ×××•×¨ ×œ×”×•×¤×™×¢.

## ×©×œ×‘ 4: Build

```bash
npm run build
```

×”×¤×œ×˜ ×™×”×™×” ×‘-`dashboard/dist/`.

## ×”×¢×¨×•×ª

- ×”×§×•×“ ××©×ª××© ×‘-components ×¤×©×•×˜×™× ×©×™×¦×¨×ª×™ (×œ× shadcn)
- ×”× ×ª×•× ×™× × ×˜×¢× ×™× ×-`loadProjectData()` ×©××—×¤×© `data.json`
- ×›×“×™ ×œ×™×¦×•×¨ `data.json`, ×¦×¨×™×š ×œ×™×¦×•×¨ script `scripts/generate-dashboard-data.cjs`

## ××” ×¢×•×“ ×—×¡×¨?

1. **Home Tab ×¢× Master Plan Tree** - ×¦×¨×™×š ×œ×”×•×¡×™×£ ×˜××‘ ×—×“×© ×¢× ×”×™×¨×¨×›×™×” Phase â†’ Epic â†’ Task
2. **×§×¨×™××ª Truth Files** - ×¦×¨×™×š ×œ×¢×“×›×Ÿ `loadData.ts` ×œ×§×¨×•× ×-EXECUTION_LOG.json, Project-plan.md, ×•×›×•'
3. **Script ×œ×™×¦×™×¨×ª data.json** - ×¦×¨×™×š script ×©×™×•×¦×¨ `dashboard/data.json` ×-truth files

## ×‘×¢×™×•×ª × ×¤×•×¦×•×ª

**"Cannot find module '@/components/ui'"**
â†’ ×•×“× ×©-`tsconfig.json` ××›×™×œ `"paths": { "@/*": ["./src/*"] }`

**"recharts not found"**
â†’ `npm install recharts`

**"Tailwind classes not working"**
â†’ ×•×“× ×©-`tailwind.config.js` × ×›×•×Ÿ ×•-`index.css` ××›×™×œ `@tailwind` directives



==================================================
FILE_PATH: data.json
==================================================
{
  "meta": {
    "name": "OZ â€“ Design-Time Accessibility Assistant",
    "updated": "2025-12-28",
    "mvp": "Text Field â€“ E2E",
    "repo": "github.com/1haim/figma-oz"
  },
  "executionLog": {
    "metadata": {
      "version": "1.0",
      "lastUpdated": "2025-12-28T10:30:00Z",
      "currentPhase": "phase3",
      "currentGoal": "MVP Brain + Visibility tooling + Protocol Safety"
    },
    "blockers": [],
    "phases": [
      {
        "id": "phase2",
        "name": "Ops & Visibility",
        "epics": [
          {
            "id": "execution-log",
            "name": "EXECUTION_LOG.json",
            "status": "done",
            "owner": "Cursor",
            "evidence": "docs/EXECUTION_LOG.json",
            "tasks": []
          },
          {
            "id": "ui-map",
            "name": "UI-Map.md",
            "status": "in-progress",
            "owner": "Cursor",
            "evidence": "docs/UI-Map.md",
            "tasks": []
          },
          {
            "id": "dashboard",
            "name": "Project Dashboard",
            "status": "in-progress",
            "owner": "Cursor",
            "evidence": "dashboard/index.html",
            "tasks": [
              {
                "id": "dashboard-react",
                "name": "React Dashboard Setup",
                "status": "done",
                "owner": "Cursor",
                "evidence": "dashboard/src/App_FULL.tsx"
              },
              {
                "id": "dashboard-home-tab",
                "name": "Home Tab with Master Plan",
                "status": "in-progress",
                "owner": "Cursor",
                "evidence": "dashboard/src/App.tsx"
              }
            ]
          }
        ]
      },
      {
        "id": "phase3",
        "name": "Rules",
        "epics": [
          {
            "id": "text-field-rules",
            "name": "Text Field Rules (TF-01..TF-14)",
            "status": "pending",
            "owner": "Cursor",
            "evidence": "src/code.ts (placeholder)",
            "tasks": []
          },
          {
            "id": "button-rules",
            "name": "Button Rules (BL-01..BL-05)",
            "status": "pending",
            "owner": "Cursor",
            "evidence": "src/code.ts (placeholder)",
            "tasks": []
          },
          {
            "id": "checkbox-rules",
            "name": "Checkbox Rules (CB-01..CB-03)",
            "status": "pending",
            "owner": "Cursor",
            "evidence": "src/code.ts (placeholder)",
            "tasks": []
          },
          {
            "id": "select-rules",
            "name": "Select/Dropdown Rules (SC-01..SC-03)",
            "status": "pending",
            "owner": "Cursor",
            "evidence": "src/code.ts (placeholder)",
            "tasks": []
          }
        ]
      },
      {
        "id": "phase4",
        "name": "Wiring",
        "epics": [
          {
            "id": "code-wiring",
            "name": "code.ts wiring",
            "status": "in-progress",
            "owner": "Cursor",
            "evidence": "src/code.ts",
            "tasks": [
              {
                "id": "orchestrator",
                "name": "Multi-component orchestrator",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/code.ts:classifyComponent"
              },
              {
                "id": "vision-integration",
                "name": "AI Vision integration",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/code.ts:classifyFromImageVision"
              },
              {
                "id": "rule-hooks",
                "name": "Rule hooks into orchestrator",
                "status": "pending",
                "owner": "Cursor",
                "evidence": "src/code.ts (TODO)"
              }
            ]
          },
          {
            "id": "schema-conformance",
            "name": "schema conformance",
            "status": "pending",
            "owner": "Cursor",
            "evidence": "src/protocol.ts",
            "tasks": []
          }
        ]
      }
    ],
    "logEntries": [
      {
        "timestamp": "2025-12-28T10:30:00Z",
        "type": "task_completed",
        "message": "Created EXECUTION_LOG.json structure",
        "phase": "phase2",
        "files": [
          "docs/EXECUTION_LOG.json"
        ]
      },
      {
        "timestamp": "2025-12-25T14:00:00Z",
        "type": "task_completed",
        "message": "Component detection engine with multi-signal scoring",
        "phase": "phase4",
        "files": [
          "src/code.ts"
        ]
      },
      {
        "timestamp": "2025-12-24T09:00:00Z",
        "type": "task_completed",
        "message": "Preview export + PREVIEW_READY protocol message",
        "phase": "phase4",
        "files": [
          "src/code.ts",
          "ui/ui.html"
        ]
      },
      {
        "timestamp": "2025-12-23T16:00:00Z",
        "type": "task_completed",
        "message": "verify-changelog script + commit gating",
        "phase": "phase2",
        "files": [
          "scripts/verify-changelog.cjs"
        ]
      }
    ],
    "reasoning": [
      {
        "timestamp": "2025-12-28T10:30:00Z",
        "action": "Created EXECUTION_LOG.json",
        "why": "Need single source of truth for task status, decisions, and blockers. Enables dashboard to show real-time project state.",
        "relatedFiles": [
          "docs/EXECUTION_LOG.json"
        ],
        "phase": "phase2"
      },
      {
        "timestamp": "2025-12-25T14:00:00Z",
        "action": "Implemented multi-signal component detection",
        "why": "Need reliable component type identification using structure, layout, and semantic signals. Strict gate (0.85 confidence + 0.35 structural) ensures quality.",
        "relatedFiles": [
          "src/code.ts"
        ],
        "phase": "phase4"
      }
    ]
  },
  "gitStatus": {
    "branch": "main",
    "workingTree": "dirty",
    "modifiedFiles": [
      "ARCHITECTURE.md",
      "BUILDLOG.md",
      "CHANGELOG.md",
      "DEPLOYLOG.md",
      "Definition_Of_Done.md",
      "PROJECT_TREE.txt",
      "README.md",
      "SYSTEM_CONTEXT.md",
      "api/chat-proxy.ts",
      "api/fetch-and-map.ts",
      "api/health.ts",
      "api/populate-embedding.ts",
      "api/providers.ts",
      "docs/00-meta/research-log.md",
      "docs/01-foundations/foundations-engine-logic.docx",
      "docs/01-foundations/foundations-engine-logic_v2_hybrid-vision-first.docx",
      "docs/01-foundations/research-guard-rails.docx",
      "docs/02-research/ai-engine-spec-phase-1.docx",
      "docs/02-research/wcag-coverage-map.docx",
      "docs/03-components/mvp-rule-pack-v1.docx",
      "docs/03-components/mvp-rule-pack-v1_v2_hybrid-vision-first.docx",
      "docs/04-engine/component-responsibility-matrix.xlsx",
      "docs/04-engine/mvp-top-20-components.docx",
      "docs/05-handoff/figma-handoff-assets.docx",
      "App-structure.md -> docs/archive/App-structure.md",
      "Project-plan.md -> docs/archive/Project-plan.md",
      "a11y_assistant.md -> docs/archive/a11y_assistant.md",
      "a11y_assistant_impementation_plan.md -> docs/archive/a11y_assistant_impementation_plan.md",
      "package.json",
      "public/.gitkeep",
      "scripts/build-ui.cjs",
      "src/code.ts",
      "src/ui-inline.ts",
      "ui/ui.html",
      "PROJECT_TREE.md",
      "dashboard/",
      "docs/CURRENT_STATUS.md",
      "docs/EXECUTION_LOG.json",
      "docs/NotebookLM-Onboarding.md",
      "docs/Project-plan.md",
      "docs/Runtime-Accessibility-Intent-Catalog-LOCKED.md",
      "docs/UI-Map.md",
      "docs/archive/02-project/",
      "docs/archive/04-research/",
      "docs/archive/ai-engine-spec-phase-1.docx",
      "docs/archive/ai/",
      "docs/archive/component-responsibility-matrix.xlsx",
      "docs/archive/figma-handoff-assets.docx",
      "docs/archive/foundations-engine-logic-legacy.docx",
      "docs/archive/mvp-top-20-components.docx",
      "docs/archive/research-guard-rails.docx",
      "docs/archive/research-log.md",
      "docs/archive/wcag-coverage-map.docx",
      "\"docs/engine outline-LOCKED.docx\"",
      "docs/foundations-engine-logic-LOCKED.docx",
      "docs/mvp-rule-pack-LOCKED.docx",
      "\"docs/pre locked/\"",
      "docs/test-scenarios-LOCKED.md",
      "\"legacy old/\"",
      "scripts/add-latest-header.py",
      "scripts/detailed-table-check.py",
      "scripts/fix-docx-header.py",
      "scripts/git-status.cjs",
      "scripts/update-project-tree.cjs",
      "scripts/verify-docx-structure.py",
      "src/assets/check.svg",
      "src/assets/chevron.svg",
      "\"src/assets/layers icons/\"",
      "src/assets/ui/",
      "src/protocol.ts"
    ],
    "ahead": 0,
    "behind": 0,
    "lastCommit": "2025-12-24 18:47:27 +0200",
    "lastPush": "2025-12-24 18:47:27 +0200",
    "timestamp": "2025-12-28T02:31:04.006Z"
  },
  "progress": {
    "masterPlan": {
      "total": 3,
      "completed": 0,
      "percentage": 0
    },
    "rules": {
      "total": 25,
      "implemented": 0,
      "percentage": 0
    }
  },
  "recent": [
    {
      "date": "2025-12-25",
      "items": [
        "Component detection engine with multi-signal scoring (structure + layout + semantic), strict gate (confidence >= 0.85 AND structural >= 0.35), auto-resolve parent tree climbing (up to 3 levels)"
      ]
    },
    {
      "date": "2025-12-24",
      "items": [
        "Preview export (natural size, transparent background) + PREVIEW_READY protocol message"
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Added `scripts/verify-changelog.cjs` and npm scripts to gate commits on CHANGELOG updates when code changes."
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Quarantined legacy sources (`src/accessibility.ts`, `src/tool-library.ts`) to `quarantine/legacy-2025-12-23/` since the runtime now uses inlined equivalents."
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Removed stray `.DS_Store` files and ignored them via `.gitignore`."
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Documented the current architecture and entry points in `ARCHITECTURE.md`."
      ]
    }
  ],
  "uiMap": "# UI State Machine\n\n**Last Updated**: 2025-12-28  \n**Purpose**: Document UI state machine and transitions\n\n---\n\n## States\n\n### IDLE\n- **Description**: No selection, empty state\n- **UI**: Shows \"Select a node to preview\" message\n- **Actions**: User selects a node in Figma\n\n### IDENTIFYING\n- **Description**: Scanning/vision classification in progress\n- **UI**: Shows \"AI scanning selection...\" or \"Detecting component type...\"\n- **Actions**: Auto-transitions based on classification result\n\n### NEEDS_CONFIRMATION\n- **Description**: Classification confidence below gate (0.90), requires user confirmation\n- **UI**: Shows chips (sorted by confidence) + manual input + \"Start over\"\n- **Actions**: User selects component type or enters custom name\n\n### IDENTIFIED\n- **Description**: Component type confirmed (either auto-passed or user-selected)\n- **UI**: Shows component type chip, \"Correct\" button, intent display\n- **Actions**: User can click \"Correct\" to change type, or proceed to scan\n\n### PLAN_READY\n- **Description**: Scan complete, plan shown with Designer Changes + Developer Handoff\n- **UI**: Shows \"Designer Changes\" and \"Developer Handoff\" sections, \"Accessible it\" button\n- **Actions**: User can review plan, apply fixes, or export handoff\n\n### EXECUTING\n- **Description**: Applying autofixes in progress\n- **UI**: Shows progress indicator\n- **Actions**: Auto-transitions to DONE when complete\n\n### DONE\n- **Description**: All fixes applied, handoff ready\n- **UI**: Shows completion message, export options\n- **Actions**: User can export handoff or start over\n\n---\n\n## Transitions\n\n```\nIDLE â†’ IDENTIFYING\n  Trigger: User selects node + clicks \"Accessible it\"\n  \nIDENTIFYING â†’ NEEDS_CONFIRMATION\n  Trigger: Classification confidence < 0.90 OR gate fails\n  \nIDENTIFYING â†’ IDENTIFIED\n  Trigger: Classification confidence >= 0.90 AND gate passes\n  \nNEEDS_CONFIRMATION â†’ IDENTIFIED\n  Trigger: User selects component type (chip or manual input)\n  \nIDENTIFIED â†’ PLAN_READY\n  Trigger: Scan complete, plan generated\n  \nPLAN_READY â†’ EXECUTING\n  Trigger: User clicks \"Accessible it\" (apply fixes)\n  \nEXECUTING â†’ DONE\n  Trigger: All fixes applied\n  \nAny state â†’ IDLE\n  Trigger: Selection cleared (nodes = 0)\n```\n\n---\n\n## State Variables\n\n### selectionState\n- `none`: No selection\n- `hasSelection`: Node selected\n\n### classifyState\n- `idle`: Not classifying\n- `processing`: Classification in progress\n- `done`: Classification complete\n\n### certaintyState\n- `certain`: Confidence >= 0.90, gate passed\n- `uncertain`: Confidence < 0.90 or gate failed\n\n### reasoningState\n- `collapsed`: Reasoning panel hidden\n- `expanded`: Reasoning panel visible\n\n---\n\n## UI Components by State\n\n### IDLE\n- Empty state message\n- No preview\n- No actions\n\n### IDENTIFYING\n- Preview (immutable, from selection)\n- Status text: \"AI scanning selection...\"\n- Loading indicator (optional)\n\n### NEEDS_CONFIRMATION\n- Preview (immutable)\n- Component type chips (sorted by confidence)\n- Manual input field\n- \"Start over\" button\n\n### IDENTIFIED\n- Preview (immutable)\n- Component type chip\n- \"Correct\" button\n- Intent display\n- \"Show Reasoning\" toggle\n- \"Accessible it\" button (if scan ready)\n\n### PLAN_READY\n- Preview (collapsed to header thumbnail)\n- \"Designer Changes\" section\n- \"Developer Handoff\" section\n- \"Accessible it\" button\n\n### EXECUTING\n- Progress indicator\n- Status text: \"Applying fixes...\"\n\n### DONE\n- Completion message\n- Export options\n- \"Start over\" button\n\n---\n\n## Notes\n\n- **Preview Immutability**: Preview image only changes when selection changes, not when classification certainty changes\n- **Single UI Shell**: All states use the same layout structure. Uncertainty adds suggestions section, doesn't replace entire UI\n- **State Reset**: When selection cleared, all states reset to IDLE, preview cleared\n\n",
  "projectPlan": "# NotebookLM Onboarding - Design-Time Accessibility Plugin\n\n**Purpose**: This document serves as the single onboarding source for NotebookLM (\"Noty\") to understand and navigate the Figma Design-Time Accessibility Plugin project.\n\n**Last Updated**: 2024-12-19  \n**Source of Truth**: `docs/02-project/Project-plan.md` (master plan)\n\n---\n\n## 1. Project in One Page\n\n### Goal\nBuild a Figma plugin that identifies components during design-time, runs accessibility checks, suggests safe fixes, and generates developer handoff. **Shift-left accessibility** - catch issues before code is written.\n\n### MVP Scope\n**Components**: Text Field, Button, Checkbox, Dropdown/Select only  \n**Severity**: WARN only (no FAIL/BLOCKER)  \n**Output**: Design guidance + UX patterns + Code snippets (HTML/ARIA)\n\n### Core Principle\n**AI Visual First (default)**: Vision classification is the primary method. Local tree-based analysis is fallback when AI unavailable or uncertain.\n\n### Locked Decisions\n- **AI Visual First**: Vision default, signals backup\n- **Confidence Gate**: 0.90 threshold for PASS (strict)\n- **Severity Policy**: PASS/ASK/WARN only (no FAIL)\n- **UI Shell**: Static layout, uncertainty adds suggestions only (no layout change)\n- **Output Schema**: Unified JSON contract for classifier/orchestrator\n\n---\n\n## 2. Current Status Snapshot\n\n### What's Implemented\n\n#### UI (`ui/ui.html`)\n- âœ… **Single UI Shell**: State machine with `selectionState`, `classifyState`, `certaintyState`, `reasoningState`\n- âœ… **Header Row**: Node icon, name, preview thumbnail\n- âœ… **Identification Card**: Component type chip, \"Correct\" button, intent display\n- âœ… **Reasoning Panel**: Collapsible, shows \"Why {componentType}\" and \"Why Intent\"\n- âœ… **Correction Flow**: Chips (sorted by confidence) + manual input + \"Start over\"\n- âœ… **Preview**: Natural size export, zoom (100-500%), panning, theme toggle (preview bg only)\n- âœ… **Asset Loading**: All icons embedded as inline SVG\n- âœ… **State Reset**: Clears preview when no selection\n\n#### Engine (`src/code.ts`)\n- âœ… **Multi-Component Orchestrator**: `classifyComponent()` runs detectors for TextField, Button, Checkbox, Dropdown\n- âœ… **AI Vision Integration**: `classifyFromImageVision()` using OpenAI GPT-4o (if API key provided)\n- âœ… **Local Classifiers**: Tree-based detectors with structure/layout/semantic scoring\n- âœ… **Design System Context**: `detectDesignSystemContext()` reads file/page names, applies bias rules\n- âœ… **Hard-Gating**: DS context excludes incompatible component types (e.g., checkbox on \"buttons\" page)\n- âœ… **Auto-Resolve**: Climbs parent tree (up to 3 levels) if initial classification fails\n- âœ… **Decision Fusion**: AI Vision (if `confidence >= 0.80`) else local classifier\n- âœ… **Confidence Gate**: 0.90 threshold for PASS (strict)\n- âœ… **Session Persistence**: Stores chosen component type per nodeId\n\n#### Routing (`src/protocol.ts`)\n- âœ… **Message Types**: `VISION_CLASSIFY_REQUEST`, `VISION_CLASSIFY_RESULT`, `CLASSIFICATION_UPDATED`\n- âœ… **Schema**: `VisionClassifyResultMessage` with `componentType`, `componentTypeConfidence`, `intent`, `intentConfidence`, `reasoning[]`, `gate`, `method`\n- âœ… **User Actions**: `USER_SET_COMPONENT_TYPE`, `USER_SET_COMPONENT_NAME`, `USER_RESTART`\n\n### What's NOT Implemented (MVP Gaps)\n\n#### Missing Features\n- âŒ **Scan Rules**: TF-01..TF-14 checks not implemented (placeholder only)\n- âŒ **Autofix Engine**: Safe autofix (layer renaming, focus states, annotations) not implemented\n- âŒ **Handoff Generator**: Design/UX/Code output not implemented\n- âŒ **ASK Flow Full**: Partial (component type confirmation works, but scan-level ASK not implemented)\n\n#### Known Limitations\n- AI Vision requires OpenAI API key in `figma.clientStorage` (falls back to local if missing)\n- Checkbox and Dropdown detectors are basic (need refinement)\n- No streaming scan results (all-at-once only)\n\n---\n\n## 3. Architecture Map\n\n### Folder Structure\n\n```\nFigma plugin/\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ code.ts              # Main thread (Figma API, classification, message handling)\nâ”‚   â”œâ”€â”€ protocol.ts          # Message types and guards (UI â†” Main contract)\nâ”‚   â””â”€â”€ assets/\nâ”‚       â”œâ”€â”€ ui/              # UI icons (logo, buttons, chevron, etc.)\nâ”‚       â””â”€â”€ layers icons/    # Figma node type icons (frame, component, text, etc.)\nâ”œâ”€â”€ ui/\nâ”‚   â””â”€â”€ ui.html              # UI thread (HTML/CSS/JS, state machine, rendering)\nâ”œâ”€â”€ dist/                    # Build output (generated)\nâ”‚   â”œâ”€â”€ src/code.js          # Compiled main thread\nâ”‚   â”œâ”€â”€ ui.html              # Inline HTML (via build-ui.cjs)\nâ”‚   â””â”€â”€ assets/              # Copied assets\nâ”œâ”€â”€ docs/\nâ”‚   â”œâ”€â”€ 01-foundations/      # Source of truth: foundations-engine-logic.docx\nâ”‚   â”œâ”€â”€ 02-project/         # Project plan, test scenarios, this doc\nâ”‚   â”œâ”€â”€ 03-components/      # Source of truth: mvp-rule-pack.docx\nâ”‚   â””â”€â”€ 04-research/         # Supporting docs (classifier research, runtime catalog)\nâ””â”€â”€ scripts/\n    â””â”€â”€ build-ui.cjs         # Build script (copies ui.html, generates ui-inline.ts)\n```\n\n### Entry Points\n\n- **Main Thread**: `src/code.ts` â†’ compiled to `dist/src/code.js` (loaded by Figma)\n- **UI Thread**: `ui/ui.html` â†’ copied to `dist/ui.html` (loaded by `figma.showUI()`)\n- **Build**: `npm run build` â†’ runs `build-ui` + `build-main` + `typecheck`\n\n### Runtime Flow\n\n```\n1. User selects node in Figma\n   â†“\n2. Main thread: handleSelectionChange()\n   â†’ Export PNG preview (natural size, transparent)\n   â†’ Send SELECTION_PREVIEW_READY to UI\n   â†“\n3. UI: renderShell() updates preview, shows identification card\n   â†“\n4. User clicks \"Accessible it\"\n   â†“\n5. UI: sends ACCESSIBLE_IT_RUN\n   â†“\n6. Main: handleAccessibilityRun()\n   â†’ Export preview (if not already)\n   â†’ Send PREVIEW_READY\n   â†“\n7. UI: sends VISION_CLASSIFY_REQUEST\n   â†“\n8. Main: handleVisionClassify()\n   â†’ detectDesignSystemContext()\n   â†’ classifyFromImageVision() [if ENABLE_AI_VISION && API key]\n   â†’ classifyComponent() [orchestrator: runs all detectors]\n   â†’ Decision fusion (AI vs local)\n   â†’ Auto-resolve (if FAIL, climb parent tree)\n   â†’ Send VISION_CLASSIFY_RESULT\n   â†“\n9. UI: handleVisionClassifyResult()\n   â†’ If gate PASS: show Summary Mode, emit ASK_START\n   â†’ If gate FAIL: show Chat Mode (suggestions), wait for user\n   â†“\n10. User confirms/overrides component type\n    â†“\n11. Main: handleUserSetComponentType()\n    â†’ Update finalComponentType\n    â†’ Send CLASSIFICATION_UPDATED\n    â†“\n12. UI: handleClassificationUpdated()\n    â†’ Update reasoning to match finalComponentType\n    â†’ Switch to Summary Mode\n    â†’ Show \"Accessible it\" button\n```\n\n### Key Functions\n\n**Main Thread (`src/code.ts`)**:\n- `classifyComponent(node, dsContext)`: Orchestrator - runs all detectors, applies context bias, selects best candidate\n- `classifyTextFieldFromNodeTree(node)`: Text Field detector (structure + layout + semantic scoring)\n- `classifyButtonFromNodeTree(node)`: Button detector\n- `classifyCheckboxFromNodeTree(node)`: Checkbox detector (with negative gates)\n- `classifyFromImageVision(bytesBase64, nodeContext, dsContext)`: AI Vision classifier\n- `detectDesignSystemContext()`: Reads file/page names, returns `{ isDS, pageDomain, reasons }`\n- `handleVisionClassify()`: Main classification handler (AI + local fusion)\n\n**UI Thread (`ui/ui.html`)**:\n- `renderShell()`: Single UI shell renderer (manages all states)\n- `handleVisionClassifyResult()`: Updates UI based on classification result\n- `handleClassificationUpdated()`: Updates UI after user override\n\n---\n\n## 4. State Machine & UI Shell Rule\n\n### State Machine\n\nThe UI uses a single state machine (no \"two screens\"):\n\n```typescript\nconst state = {\n  // Selection state\n  selectionState: \"none\" | \"hasSelection\",\n  selectedNode: SceneNode | null,\n  selectionFingerprint: string | null,\n\n  // Classification state\n  classifyState: \"idle\" | \"processing\" | \"done\",\n\n  // Certainty state\n  certaintyState: \"certain\" | \"uncertain\",\n\n  // Reasoning state\n  reasoningState: \"collapsed\" | \"expanded\",\n\n  // Component type (separate suggested vs final)\n  suggestedComponentType: string | null,\n  finalComponentType: string | null, // After user override\n};\n```\n\n### UI Shell Rule\n\n**Always the same layout**:\n- Top bar (header with logo, buttons)\n- Identification card (component name, preview, type chip)\n- Validation section (intent, confidence)\n- Details section (reasoning toggle + panel)\n- Actions (Accessible it, Annotate buttons)\n\n**Uncertainty behavior**:\n- If `certaintyState === \"uncertain\"`: Add \"Suggestions / Correction Flow\" section at bottom\n- Do NOT replace entire screen with chat\n- Do NOT hide Summary Mode\n- Suggestions section contains: chips (sorted by confidence) + manual input + \"Start over\"\n\n**Reasoning correctness**:\n- Always use `finalComponentType` (after user override) for reasoning title/content\n- Never show \"Why Button\" if user selected \"Text Field\"\n\n---\n\n## 5. Classifier/Engine Output Contract\n\n### JSON Schema\n\n**`VISION_CLASSIFY_RESULT` message**:\n\n```typescript\n{\n  type: \"VISION_CLASSIFY_RESULT\",\n  nodeId: string,\n  suggestedComponentType: \"textField\" | \"dropdown\" | \"button\" | \"checkbox\" | \"unknown\",\n  componentTypeConfidence: number, // 0..1\n  intent?: \"password\" | \"email\" | \"phone\" | \"search\" | \"name\" | \"address\" | \"zip\" | \"url\" | \"username\" | \"description\" | \"other\" | \"unknown\",\n  intentConfidence?: number, // 0..1\n  suggestedLabel?: string,\n  reasoning: string[], // Bullet strings for \"Why {componentType}\"\n  intentReasoning?: string[], // Bullet strings for \"Why Intent\"\n  gate: \"PASS\" | \"FAIL\",\n  thresholds: { pass: number }, // Echo threshold used (0.90)\n  method?: \"local\" | \"ai_vision\" | \"fallback\",\n  nodeName?: string,\n  reasoningDataContext?: string, // File/page context\n}\n```\n\n### Gate Rules\n\n**PASS** (auto-proceed):\n- `componentTypeConfidence >= 0.90` AND\n- `componentType !== \"unknown\"` AND\n- (For Text Field) `structureScore >= 0.35`\n\n**FAIL** (ask user):\n- `componentTypeConfidence < 0.90` OR\n- `componentType === \"unknown\"` OR\n- (For Text Field) `structureScore < 0.35`\n\n### Decision Fusion Logic\n\n1. **AI Vision** (if enabled and API key available):\n   - Call `classifyFromImageVision()`\n   - If `componentType !== \"unknown\"` AND `componentTypeConfidence >= 0.80` â†’ use AI\n   - If AI intent: `intentConfidence >= 0.75` â†’ use AI intent\n\n2. **Local Classifier** (fallback or if AI fails):\n   - Call `classifyComponent()` (orchestrator)\n   - Runs all detectors, applies context bias, selects best candidate\n   - Returns `componentType`, `confidence`, `reasoning[]`\n\n3. **Auto-Resolve** (if FAIL):\n   - Climb parent tree (up to 3 levels)\n   - Re-run classification on parent\n   - If parent PASS â†’ return parent result with \"Auto-resolved\" in reasoning\n\n### Example Outputs\n\n**PASS Example**:\n```json\n{\n  \"type\": \"VISION_CLASSIFY_RESULT\",\n  \"nodeId\": \"123:456\",\n  \"suggestedComponentType\": \"textField\",\n  \"componentTypeConfidence\": 0.92,\n  \"intent\": \"search\",\n  \"intentConfidence\": 0.78,\n  \"reasoning\": [\n    \"Container with visible fill/stroke\",\n    \"Text node inside container bounds\",\n    \"Left padding >= 8px\",\n    \"Single-line text structure\"\n  ],\n  \"intentReasoning\": [\n    \"Search icon detected\",\n    \"Nearby text: '×—×™×¤×•×©'\"\n  ],\n  \"gate\": \"PASS\",\n  \"thresholds\": { \"pass\": 0.90 },\n  \"method\": \"ai_vision\",\n  \"nodeName\": \"Search Input\"\n}\n```\n\n**FAIL Example**:\n```json\n{\n  \"type\": \"VISION_CLASSIFY_RESULT\",\n  \"nodeId\": \"123:456\",\n  \"suggestedComponentType\": \"unknown\",\n  \"componentTypeConfidence\": 0.65,\n  \"reasoning\": [\n    \"Ambiguous structure\",\n    \"No clear input container pattern\"\n  ],\n  \"gate\": \"FAIL\",\n  \"thresholds\": { \"pass\": 0.90 },\n  \"method\": \"local\",\n  \"nodeName\": \"Component 1\"\n}\n```\n\n---\n\n## 6. How to Run / Build / Deploy\n\n### Build\n\n```bash\nnpm run build\n```\n\nThis runs:\n1. `build-ui`: Copies `ui/ui.html` to `dist/ui.html`, generates `src/ui-inline.ts`\n2. `build-main`: Compiles `src/code.ts` to `dist/src/code.js` (esbuild)\n3. `typecheck`: TypeScript type checking (no emit)\n\n### Development\n\n```bash\n# Watch UI changes\nnpm run dev:ui\n\n# Build only\nnpm run build-ui\nnpm run build-main\n```\n\n### Testing in Figma\n\n1. Open Figma Desktop\n2. Plugins â†’ Development â†’ Import plugin from manifest\n3. Select `manifest.json` from project root\n4. Plugin appears in Plugins menu\n5. Run plugin, select a node, click \"Accessible it\"\n\n### Deployment\n\n**Not yet implemented** - MVP is local development only.\n\n**Future**: Deploy to Figma Community (requires plugin approval process).\n\n---\n\n## 7. Definition of Done Summary\n\n**Source**: `Definition_Of_Done.md`\n\n### Build & Runtime\n- âœ… `npm run build` completes successfully\n- âœ… Plugin loads in Figma Desktop without errors\n- âœ… No unsupported JavaScript features in compiled output\n- âœ… `figma.showUI` receives valid HTML\n\n### MVP: Text Field E2E (Current Focus)\n\n**Selection â†’ Preview**:\n- âœ… Preview exports as PNG at natural size (no upscale)\n- âœ… Transparent background\n- âœ… Preview renders correctly in UI\n\n**Component Detection**:\n- âœ… Multi-signal classification runs\n- âœ… Confidence gate: `confidence >= 0.90 AND structureScore >= 0.35`\n- âœ… Auto-resolve: climb parent tree up to 3 levels if FAIL\n- âœ… Returns `componentType: \"textField\"` or `\"unknown\"`\n\n**ASK Flow**:\n- âœ… If PASS: auto-filled, user can review/adjust\n- âœ… If FAIL: manual chips + input\n- âœ… `ASK_START` message sent with `source: \"auto\"` or `\"manual\"`\n\n**Scan Rules** (TF-01..TF-14):\n- âŒ **NOT IMPLEMENTED** - Placeholder only\n\n**Autofix**:\n- âŒ **NOT IMPLEMENTED** - Placeholder only\n\n**Handoff**:\n- âŒ **NOT IMPLEMENTED** - Placeholder only\n\n### Error Handling\n- âœ… Runtime errors surfaced to UI\n- âœ… User always gets feedback\n- âœ… No silent failures\n\n### UI Accessibility\n- âœ… Status updates via `aria-live`\n- âœ… Icon-only buttons have accessible names\n- âœ… Keyboard navigation works\n\n### Designer Experience\n- âœ… Plugin doesn't modify layout unexpectedly\n- âœ… Risky fixes are suggestions only\n- âœ… User understands what changed and why\n\n---\n\n## 8. Open TODOs (Finish MVP)\n\n### Critical (Block MVP Completion)\n\n1. **Scan Rules Implementation** (`src/code.ts`)\n   - Implement TF-01..TF-14 checks for Text Field\n   - All checks return WARN (no FAIL)\n   - Stream results to UI (`SCAN_PROGRESS` messages)\n   - Reference: `docs/03-components/mvp-rule-pack.docx`\n\n2. **Autofix Engine v1** (`src/code.ts`)\n   - Safe autofix (default ON):\n     - Rename layers (Input / Label / Helper / Icon / Container)\n     - Enforce min font sizes (body min 14, headings/labels 16) - WARN + suggestion only\n     - Create Focus state variant when missing\n     - Add annotation metadata (plugin data)\n   - Reference: `docs/01-foundations/foundations-engine-logic.docx`\n\n3. **Handoff Generator** (`src/code.ts`)\n   - Design guidance (what to change in design)\n   - UX patterns (states, focus, error patterns)\n   - Code snippets (HTML/ARIA)\n   - Reference: `docs/03-components/mvp-rule-pack.docx`\n\n4. **ASK Flow Completion** (`src/code.ts`, `ui/ui.html`)\n   - Scan-level ASK (not just component type)\n   - Template-based questions\n   - User responses stored and applied\n\n### High Priority (Before Launch)\n\n5. **Button/Checkbox/Dropdown Detectors Refinement**\n   - Improve confidence scoring\n   - Add negative gates (like checkbox has)\n   - Test on Design System pages\n\n6. **Test Scenarios Execution**\n   - Run all tests in `docs/02-project/test-scenarios.md`\n   - Document results\n   - Fix any failures\n\n7. **UI Polish**\n   - Preview zoom/pan bounds clamping (408x408)\n   - Theme toggle persistence\n   - Animation smoothness\n\n### Medium Priority (Post-MVP)\n\n8. **Post-MVP Components**\n   - Radio, Toggle/Switch, Link, Icon Button, Textarea, Search, Password, Date picker, Modal/Dialog, Toast/Alert\n   - Reference: `docs/02-project/Project-plan.md` section 10.2\n\n9. **Deployment**\n   - Figma Community submission\n   - Plugin store listing\n   - Documentation site\n\n---\n\n## 9. Key Documents Reference\n\n### Source of Truth (Locked)\n- `docs/01-foundations/foundations-engine-logic.docx`: Engine logic, AI Visual First, gates, schema\n- `docs/03-components/mvp-rule-pack.docx`: MVP component rules, checks, autofix boundaries, handoff\n\n### Master Plan\n- `docs/02-project/Project-plan.md`: Complete project plan, locked decisions, workstreams\n\n### Supporting Docs\n- `docs/02-project/test-scenarios.md`: Acceptance tests (15 test cases)\n- `docs/04-research/classifier-orchestrator-research.md`: Classifier architecture details\n- `docs/04-research/Runtime Accessibility Intent Catalog.md`: Runtime intents (filtered to MVP)\n- `docs/04-research/Design-Time Signals â€“ Raw Extraction.md`: Signal extraction details\n\n### Code\n- `src/code.ts`: Main thread (classification, message handling)\n- `src/protocol.ts`: Message types and guards\n- `ui/ui.html`: UI thread (state machine, rendering)\n\n---\n\n## 10. Quick Reference: Locked Decisions\n\n| Decision | Value | Source |\n|----------|-------|--------|\n| AI Visual First | Default ON | Project-plan.md Â§5.1 |\n| Confidence Gate | 0.90 (strict) | Project-plan.md Â§5.3 |\n| Severity Policy | PASS/ASK/WARN only (no FAIL) | Project-plan.md Â§7 |\n| UI Shell | Static layout, uncertainty adds suggestions | Project-plan.md Â§10.4.1 |\n| Output Schema | Unified JSON contract | Project-plan.md Â§11.1 |\n| MVP Components | Text Field, Button, Checkbox, Dropdown | Project-plan.md Â§10.1 |\n\n---\n\n## 11. Common Questions\n\n**Q: Why is AI Vision default ON but sometimes uses local classifier?**  \nA: AI Vision requires OpenAI API key. If missing or API call fails, falls back to local classifier automatically.\n\n**Q: What's the difference between `suggestedComponentType` and `finalComponentType`?**  \nA: `suggestedComponentType` is what the classifier detected. `finalComponentType` is after user override (if any). Reasoning always uses `finalComponentType`.\n\n**Q: Why does DS context exclude certain component types?**  \nA: Design System pages have strong context signals. A \"Buttons\" page should never classify as Checkbox, even with weak icon signals. Hard-gating prevents misclassification.\n\n**Q: What happens if classification fails on selected node?**  \nA: Auto-resolve climbs parent tree (up to 3 levels) and re-runs classification. If parent passes gate, returns parent result with \"Auto-resolved\" in reasoning.\n\n**Q: How do I add a new component type?**  \nA: 1) Add detector function (e.g., `classifyRadioFromNodeTree()`), 2) Add to orchestrator in `classifyComponent()`, 3) Update protocol types, 4) Add to MVP rule pack.\n\n---\n\n## Immediate Execution Phase\n\n- [ ] Create Logic Rules for Text Field (TF-01 to TF-14).\n- [ ] Create Logic Rules for Button (BL-01 to BL-05).\n- [ ] Hook Logic into Orchestrator (src/code.ts).\n",
  "currentStatus": "# Current Rules Status\n\n**Last Updated**: 2025-12-28  \n**Purpose**: Track which rules are implemented vs pending\n\n---\n\n## Text Field Rules\n\n- TF-01: Field Label - â³ Pending\n- TF-02: Field Required - â³ Pending\n- TF-03: Field Validation - â³ Pending\n- TF-04: Field Validation Focus - â³ Pending\n- TF-05: Field Validations - â³ Pending\n- TF-06: Field Context - â³ Pending\n- TF-07: Field Placeholder - â³ Pending\n- TF-08: Field Error Messages - â³ Pending\n- TF-09: Field Help Text - â³ Pending\n- TF-10: Field Keyboard Navigation - â³ Pending\n- TF-11: Field Auto-complete - â³ Pending\n- TF-12: Field Input Types - â³ Pending\n- TF-13: Field Size Constraints - â³ Pending\n- TF-14: Field Color Contrast - â³ Pending\n\n**Total**: 0/14 implemented (0%)\n\n---\n\n## Button Rules\n\n- BL-01: Button Roles - â³ Pending\n- BL-02: Button Labeling - â³ Pending\n- BL-03: Button States - â³ Pending\n- BL-04: Button Keyboard Navigation - â³ Pending\n- BL-05: Button Focus Indicators - â³ Pending\n\n**Total**: 0/5 implemented (0%)\n\n---\n\n## Checkbox Rules\n\n- CB-01: Checkbox Roles - â³ Pending\n- CB-02: Checkbox Labeling - â³ Pending\n- CB-03: Checkbox States - â³ Pending\n\n**Total**: 0/3 implemented (0%)\n\n---\n\n## Select/Dropdown Rules\n\n- SC-01: Select Roles - â³ Pending\n- SC-02: Select Labeling - â³ Pending\n- SC-03: Select Keyboard Navigation - â³ Pending\n\n**Total**: 0/3 implemented (0%)\n\n---\n\n## Overall Status\n\n**Total Rules**: 25  \n**Implemented**: 0  \n**Pending**: 25  \n**Coverage**: 0%\n\n---\n\n## Notes\n\n- All rules are currently placeholders in `src/code.ts`\n- Rules will be implemented in Phase 3\n- Evidence links will point to specific functions in `src/code.ts` once implemented\n\n",
  "truth": {
    "note": "Source of truth: Foundations + MVP rule pack. ×©××¨ ×”××¡××›×™× ×ª×•××›×™× ×‘×œ×‘×“.",
    "docs": [
      {
        "label": "Foundations â€“ engine logic",
        "path": "docs/foundations-engine-logic-LOCKED.docx"
      },
      {
        "label": "MVP rule pack",
        "path": "docs/mvp-rule-pack-LOCKED.docx"
      }
    ]
  },
  "pipeline": [
    {
      "id": "select",
      "title": "×‘×—×™×¨×”",
      "detail": "×”××¢×¦×‘ ×‘×•×—×¨ × ×•×“ ×‘-Figma"
    },
    {
      "id": "preview",
      "title": "×ª×¦×•×’×” ××§×“×™××”",
      "detail": "PNG ×‘×’×•×“×œ ×˜×‘×¢×™ ×¢× ×¨×§×¢ ×©×§×•×£"
    },
    {
      "id": "type",
      "title": "×–×™×”×•×™ ×¡×•×’ ×§×•××¤×•× × ×˜×”",
      "detail": "×—×•×§×™× ××§×•××™×™× ×¢× Gate ×§×©×™×—"
    },
    {
      "id": "intent",
      "title": "Intent/Label",
      "detail": "×‘×¨×™×¨×ª ××—×“×œ: Unknown. Auto-resolve ×¢×“ 3 ×”×•×¨×™×"
    },
    {
      "id": "checks",
      "title": "×‘×“×™×§×•×ª",
      "detail": "TF-01â€¦TF-14 (WARN ×‘×œ×‘×“ ×‘-MVP)"
    },
    {
      "id": "fix",
      "title": "××•×˜×•-×¤×™×§×¡",
      "detail": "×¨×§ Safe autofixes ×œ×¤×™ ×§×¨×™×˜×¨×™×•× ×™×"
    },
    {
      "id": "handoff",
      "title": "Handoff",
      "detail": "×¤×œ×˜ ××•×‘× ×” ×œ×“×™×–×™×™×Ÿ + Dev"
    }
  ],
  "gates": {
    "local": {
      "confidence": 0.85,
      "structural": 0.35
    },
    "vision": {
      "enabledByDefault": false,
      "role": "Boost + sanity check (×œ× dependency)"
    }
  },
  "build": {
    "command": "npm run build",
    "artifacts": [
      {
        "path": "dist/src/code.js",
        "note": "Main plugin bundle"
      },
      {
        "path": "dist/ui.html",
        "note": "UI bundle"
      },
      {
        "path": "src/ui-inline.ts",
        "note": "Generated â€“ ×œ× ×œ×¢×¨×•×š"
      }
    ]
  },
  "storage": [
    {
      "key": "aims.log",
      "type": "Array<JobLog>",
      "purpose": "×”×™×¡×˜×•×¨×™×™×ª ×”×¨×¦×•×ª (UNDO)"
    },
    {
      "key": "ams-settings",
      "type": "Settings",
      "purpose": "×”×¢×“×¤×•×ª ××©×ª××© (provider/model/keys)"
    },
    {
      "key": "OPENAI_API_KEY",
      "type": "string",
      "purpose": "××¤×ª×— AI Vision"
    }
  ],
  "files": {
    "mustEdit": [
      {
        "path": "src/code.ts",
        "why": "×œ×•×’×™×§×”: orchestrator + detectors + gates"
      },
      {
        "path": "ui/ui.html",
        "why": "UI + state machine"
      },
      {
        "path": "src/protocol.ts",
        "why": "×¤×¨×•×˜×•×§×•×œ ×”×•×“×¢×•×ª"
      }
    ],
    "dontEdit": [
      {
        "path": "src/ui-inline.ts",
        "why": "Generated"
      },
      {
        "path": "dist/*",
        "why": "Build output"
      }
    ]
  },
  "projectTree": {
    "groups": [
      {
        "title": "Must-edit (MVP)",
        "nodes": [
          {
            "path": "src/code.ts",
            "tags": [
              "logic",
              "orchestrator",
              "detectors"
            ]
          },
          {
            "path": "ui/ui.html",
            "tags": [
              "ui",
              "state-machine"
            ]
          },
          {
            "path": "src/protocol.ts",
            "tags": [
              "protocol"
            ]
          }
        ]
      },
      {
        "title": "Generated (do not edit)",
        "nodes": [
          {
            "path": "src/ui-inline.ts",
            "tags": [
              "generated"
            ]
          },
          {
            "path": "dist/src/code.js",
            "tags": [
              "compiled"
            ]
          },
          {
            "path": "dist/ui.html",
            "tags": [
              "copied"
            ]
          }
        ]
      },
      {
        "title": "Docs",
        "nodes": [
          {
            "path": "docs/foundations-engine-logic-LOCKED.docx",
            "tags": [
              "authoritative"
            ]
          },
          {
            "path": "docs/mvp-rule-pack-LOCKED.docx",
            "tags": [
              "authoritative"
            ]
          },
          {
            "path": "README.md",
            "tags": [
              "supporting"
            ]
          },
          {
            "path": "ARCHITECTURE.md",
            "tags": [
              "supporting"
            ]
          }
        ]
      }
    ]
  },
  "ideas": {
    "src/code.ts": [
      "DS-context hard block: ×‘×¢××•×“ Buttons ×œ× ×œ×¡×•×•×’ ×›-Text Field ×‘×œ×™ ×¨××™×•×ª ×—×–×§×•×ª.",
      "Cross-check ×‘×™×Ÿ Vision ×œ×‘×™×Ÿ local: ×× Vision ×‘×˜×•×— ××‘×œ structural × ××•×š â€“ ×œ×¢×‘×•×¨ ×œ-Ask.",
      "Reasoning trace ×˜×™×¤×•×¡×™ ×œ×›×œ ×¡×™×•×•×’ (debug drawer ×‘-UI)."
    ],
    "ui/ui.html": [
      "Ambiguity resolution: ×‘××§×•× dropdown â€“ 2â€“4 ×›×¤×ª×•×¨×™ ×‘×—×™×¨×” inline.",
      "×ª×¦×•×’×” ××§×“×™××” ×’×“×•×œ×” ×¢×“ ××—×¨×™ ××™×©×•×¨ (×œ× ×œ×›×•×•×¥ ×œ×¤× ×™).",
      "Status timeline ×§×•××¤×§×˜×™: ×¡×¨×™×§×” â†’ ×¡×™×’× ×œ×™× â†’ Gate â†’ ×‘×“×™×§×•×ª â†’ handoff."
    ],
    "src/protocol.ts": [
      "JOB_UPDATE ××—×™×“ ×¢× payload ××•×‘× ×” (stage/progress/trace/preview).",
      "Protocol versioning ×›×“×™ ×œ×× ×•×¢ ××™-×ª××™××•×ª UI/Main ×‘×–××Ÿ ××™×˜×¨×¦×™×•×ª."
    ],
    "Build/Deploy": [
      "build:watch ×©××“×¤×™×¡ ××” ×”×©×ª× ×” (UI/Main).",
      "deploy sanity: ××™××•×ª path ×©×œ manifest ×œ-dist/."
    ]
  }
}

==================================================
FILE_PATH: README.md
==================================================
# xp-map Dashboard

Dashboard ×œ×¤×¨×•×™×§×˜ **figma-oz** - ××¦×™×’ ×¡×˜×˜×•×¡, ×”×ª×§×“××•×ª, ×•×›×œ ×”××™×“×¢ ×”×¨×œ×•×•× ×˜×™.

## Quick Start

```bash
npm install
npm run dev
```

×¤×ª×—: http://localhost:5173/dashboard/

## Build & Deploy

```bash
npm run build
npm run preview  # ×œ×‘×“×™×§×” ××§×•××™×ª
```

×œ-GitHub Pages: ×¨××” `CURSOR-ONBOARDING.md`

## ××™×š ×–×” ×¢×•×‘×“

×”×“×©×‘×•×¨×“ ×§×•×¨× × ×ª×•× ×™× ×-figma-oz ×“×¨×š GitHub API:
- `dashboard-sync/dashboard-sync.json` - metadata ××¢×•×“×›×Ÿ
- `dashboard/data.json` - ×›×œ ×”× ×ª×•× ×™× ×”××œ××™×

×¨××” `CURSOR-ONBOARDING.md` ×œ×¤×¨×˜×™× ××œ××™×.

## ×§×™×©×•×¨×™×

- **figma-oz:** https://github.com/haimXseb/figma-oz
- **Dashboard:** https://haimXseb.github.io/xp-map/dashboard/ (××—×¨×™ deploy)


==================================================
FILE_PATH: DEPLOY.md
==================================================
# Dashboard Deployment Guide

## ××™×¤×” ×œ××—×¡×Ÿ ×•×œ×”×¦×™×’ ××ª ×”×“×©×‘×•×¨×“

### ğŸ¯ ××•××œ×¥: GitHub Pages (×—×™× ×, ×¤×©×•×˜)

**×™×ª×¨×•× ×•×ª:**
- âœ… ×—×™× ×
- âœ… ××•×˜×•××˜×™ (×¢× ×›×œ push)
- âœ… HTTPS ××•×˜×•××˜×™
- âœ… ×§×œ ×œ×”×’×“×¨×”

**××™×š:**
1. ×•×“× ×©×™×© ×œ×š GitHub repository
2. ×”×¢×œ×” ××ª ×ª×™×§×™×™×ª `dashboard/` ×œ-repo
3. Settings â†’ Pages â†’ Source: `dashboard/` folder
4. ×”×“×©×‘×•×¨×“ ×™×”×™×” ×‘: `https://[username].github.io/[repo-name]/dashboard/`

**×”×’×‘×œ×”:** ×œ× ×™×›×•×œ ×œ×§×¨×•× ×§×‘×¦×™× ×™×©×™×¨×•×ª (×¦×¨×™×š API)

---

### ğŸš€ Vercel (××•××œ×¥ ×œ×¤×¨×•×™×§×˜×™× ×¢× API)

**×™×ª×¨×•× ×•×ª:**
- âœ… ×—×™× ×
- âœ… ×ª××™×›×” ×‘-serverless functions (API)
- âœ… HTTPS ××•×˜×•××˜×™
- âœ… CDN ××”×™×¨

**××™×š:**
1. ×”×ª×§×Ÿ Vercel CLI: `npm i -g vercel`
2. ×‘×ª×™×§×™×™×ª `dashboard/`: `vercel`
3. ×¢×§×•×‘ ××—×¨ ×”×”×•×¨××•×ª
4. ×”×“×©×‘×•×¨×“ ×™×”×™×” ×‘: `https://[project-name].vercel.app`

**×™×ª×¨×•×Ÿ × ×•×¡×£:** ×™×›×•×œ ×œ×§×¨×•× ×§×‘×¦×™× ×“×¨×š API (`/api/files.js`)

---

### ğŸ“¦ Netlify (××œ×˜×¨× ×˜×™×‘×”)

**×™×ª×¨×•× ×•×ª:**
- âœ… ×—×™× ×
- âœ… ×¤×©×•×˜
- âœ… Forms support

**××™×š:**
1. ×”×ª×§×Ÿ Netlify CLI: `npm i -g netlify-cli`
2. ×‘×ª×™×§×™×™×ª `dashboard/`: `netlify deploy --prod`
3. ×”×“×©×‘×•×¨×“ ×™×”×™×” ×‘: `https://[project-name].netlify.app`

---

## ×©×œ×™×—×ª ××©×™××•×ª ××”×“×©×‘×•×¨×“

### ××•×¤×¦×™×” 1: GitHub Issues API (××•××œ×¥)

**×™×ª×¨×•× ×•×ª:**
- âœ… ××©×™××•×ª × ×©××¨×•×ª ×‘-GitHub
- âœ… × ×™×ª×Ÿ ×œ×¢×§×•×‘, ×œ×¡××Ÿ, ×œ×¡×’×•×¨
- âœ… ×”×™×¡×˜×•×¨×™×” ××œ××”

**××™×š ×œ×”×•×¡×™×£:**
1. ×¦×•×¨ GitHub Personal Access Token
2. ×”×•×¡×£ API endpoint ×‘-Vercel/Netlify
3. ×”×“×©×‘×•×¨×“ ×©×•×œ×— POST ×œ-GitHub Issues API

### ××•×¤×¦×™×” 2: Supabase/DB

**×™×ª×¨×•× ×•×ª:**
- âœ… ×’××™×©
- âœ… ×™×›×•×œ ×œ×©××•×¨ ×”×™×¡×˜×•×¨×™×”, ×¨×™×–×•× ×™× ×’, ×•×›×•'

**××™×š:**
1. ×¦×•×¨ Supabase project
2. ×¦×•×¨ ×˜×‘×œ×ª `tasks`
3. ×”×•×¡×£ API endpoint ×©××—×‘×¨ ×œ-Supabase

### ××•×¤×¦×™×” 3: Email (×¤×©×•×˜)

**×™×ª×¨×•× ×•×ª:**
- âœ… ×¤×©×•×˜ ×××•×“
- âœ… ×œ× ×¦×¨×™×š DB

**××™×š:**
- ×”×“×©×‘×•×¨×“ ×©×•×œ×— email ×¢× ×¤×¨×˜×™ ×”××©×™××”
- ××ª×” ××§×‘×œ ××ª ×”××©×™××” ×‘-email ×•××¢×“×›×Ÿ ×™×“× ×™×ª

---

## ×”××œ×¦×”

**×œ×¤×¨×•×™×§×˜ ×”×–×”:**
1. **GitHub Pages** - ×œ×”×¦×’×” ×¤×©×•×˜×”
2. **Vercel** - ×× ×¦×¨×™×š API ×œ×§×¨×™××ª ×§×‘×¦×™×
3. **GitHub Issues API** - ×œ×©×œ×™×—×ª ××©×™××•×ª

**×©×™×œ×•×‘ ××•××œ×¥:**
- Dashboard ×‘-GitHub Pages (×¤×©×•×˜, ×—×™× ×)
- API ×‘-Vercel (×œ×§×¨×™××ª ×§×‘×¦×™×)
- ××©×™××•×ª â†’ GitHub Issues (××•×˜×•××˜×™)

---

## ×”×’×“×¨×” ××”×™×¨×”

### GitHub Pages:
```bash
# 1. ×•×“× ×©×™×© repo
git remote -v

# 2. ×”×¢×œ×” dashboard
git add dashboard/
git commit -m "Add dashboard"
git push

# 3. ×‘-GitHub: Settings â†’ Pages â†’ Source: dashboard/
```

### Vercel:
```bash
cd dashboard
vercel
# ×¢×§×•×‘ ××—×¨ ×”×”×•×¨××•×ª
```



==================================================
FILE_PATH: REACT_SETUP.md
==================================================
# Dashboard React Setup

## Overview
×”×“×©×‘×•×¨×“ ×”×—×“×© ××©×ª××© ×‘-React + Vite ×¢× ×¢×™×¦×•×‘ iOS26 (glass morphism).

## Setup

### 1. ×™×¦×™×¨×ª React App ×—×“×©
```bash
cd dashboard
npm create vite@latest . -- --template react-ts
npm install
```

### 2. ×”×ª×§× ×ª Dependencies
```bash
npm install recharts
npm install @radix-ui/react-tabs @radix-ui/react-checkbox @radix-ui/react-separator
npm install tailwindcss postcss autoprefixer
npx tailwindcss init -p
```

### 3. shadcn/ui (××•×¤×¦×™×•× ×œ×™ - ××¤×©×¨ ×œ×”××™×¨ ×œ-components ×¤×©×•×˜×™×)
```bash
npx shadcn-ui@latest init
```

## Structure
```
dashboard/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx (×”×§×•×“ ×©×§×™×‘×œ×ª)
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ ui/ (shadcn components)
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ loadData.ts (×§×¨×™××ª truth files)
â”‚   â””â”€â”€ main.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.ts
â””â”€â”€ package.json
```

## Data Loading
×”×§×•×“ ×”× ×•×›×—×™ ××©×ª××© ×‘-hardcoded data. ×¦×¨×™×š ×œ×¢×“×›×Ÿ ×œ:
- ×§×¨×™××ª `docs/EXECUTION_LOG.json`
- ×§×¨×™××ª `docs/Project-plan.md`
- ×§×¨×™××ª `CHANGELOG.md`
- ×§×¨×™××ª `docs/CURRENT_STATUS.md`

## Build
```bash
npm run build
# Output: dashboard/dist/
```

## Deploy
- GitHub Pages: ×”×¢×œ×” `dist/` ×œ-gh-pages branch
- Vercel: `vercel` (××•×˜×•××˜×™)



==================================================
FILE_PATH: DEPLOY_INSTRUCTIONS.md
==================================================
# ×”×•×¨××•×ª Deploy ×œ-GitHub Pages

## âœ… ××” ×›×‘×¨ ××•×›×Ÿ

1. âœ… Build script - `npm run build` ×¢×•×‘×“
2. âœ… GitHub Actions workflow - `.github/workflows/deploy.yml`
3. âœ… Data generation - `scripts/generate-dashboard-data.cjs`
4. âœ… Git status script - `scripts/git-status.cjs`

## ×©×œ×‘×™× ×œ-Deploy

### 1. ×”×’×“×¨×ª GitHub Pages

1. ×œ×š ×œ-GitHub repository: https://github.com/haimXseb/figma-oz
2. Settings â†’ Pages
3. Source: ×‘×—×¨ **"GitHub Actions"** (×œ× "Deploy from a branch")
4. ×©××•×¨

### 2. Push ×œ-GitHub

```bash
cd "/Users/haim/Figma plugin"
git add dashboard/ docs/EXECUTION_LOG.json docs/UI-Map.md docs/CURRENT_STATUS.md scripts/git-status.cjs scripts/generate-dashboard-data.cjs package.json
git commit -m "Add dashboard with Home tab and truth files"
git push origin main
```

### 3. ×‘×“×™×§×ª Deployment

1. ×œ×š ×œ-GitHub repository â†’ Actions tab
2. ×ª×¨××” workflow ×‘×©× "Deploy Dashboard to GitHub Pages"
3. ×œ×—×¥ ×¢×œ×™×• ×›×“×™ ×œ×¨××•×ª ××ª ×”-progress
4. ××—×¨×™ ×©×”×¡×ª×™×™×, ×”×“×©×‘×•×¨×“ ×™×”×™×” ×–××™×Ÿ ×‘:
   **https://haimXseb.github.io/figma-oz/dashboard/**

## ×‘×“×™×§×” ××§×•××™×ª

```bash
cd dashboard
npm run build
npm run preview
# ×¤×ª×—: http://localhost:4173
```

## ×¢×“×›×•×Ÿ ××•×˜×•××˜×™

×›×œ push ×œ-`main` ×¢× ×©×™× ×•×™×™× ×‘:
- `dashboard/`
- `docs/EXECUTION_LOG.json`
- `docs/GIT_STATUS.json`
- `CHANGELOG.md`

×™×’×¨×•× ×œ-rebuild ×•-deploy ××•×˜×•××˜×™.

## ×”×¢×¨×•×ª

- ×”-workflow ××¨×™×¥ `npm ci` (clean install)
- ××¨×™×¥ `scripts/generate-dashboard-data.cjs` ×œ×¤× ×™ build
- ××¢×œ×” ××ª `dashboard/dist/` ×œ-GitHub Pages
- ×”×“×©×‘×•×¨×“ ×§×•×¨× ×-`data.json` ×©× ×•×¦×¨ ×‘-build time



==================================================
FILE_PATH: package.json
==================================================
{
  "name": "figma-plugin-dashboard",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "recharts": "^2.10.3",
    "clsx": "^2.0.0",
    "tailwind-merge": "^2.0.0",
    "lucide-react": "^0.294.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@vitejs/plugin-react": "^4.2.1",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.32",
    "tailwindcss": "^3.3.6",
    "typescript": "^5.2.2",
    "vite": "^5.0.8"
  }
}



==================================================
FILE_PATH: dashboard-sync.json
==================================================
{
  "metadata": {
    "version": "1.0",
    "lastUpdated": "2025-12-29T23:57:31.089Z",
    "description": "×§×•×‘×¥ ××¨×›×–×™ ×œ×¡×™× ×›×¨×•×Ÿ ×‘×™×Ÿ ×”×¤×¨×•×™×§×˜ ×œ×“×©×‘×•×¨×“. Cursor ××¢×“×›×Ÿ ××ª ×”×§×•×‘×¥ ×”×–×”, script ×“×•×—×£ ×œ×“×©×‘×•×¨×“.",
    "syncScript": "node dashboard-sync/sync-to-dashboard.cjs"
  },
  "project": {
    "name": "OZ â€“ Design-Time Accessibility Assistant",
    "mvp": "Text Field â€“ E2E",
    "repo": "github.com/haimXseb/figma-oz",
    "currentPhase": "phase4",
    "currentGoal": "Wiring - Rule checks integrated into orchestrator, classification engine tuned, handoff UI complete, ready for verification",
    "buildCommand": "npm run build",
    "scope": "Text Field ×‘×œ×‘×“"
  },
  "status": {
    "blockers": [],
    "lastContextDump": "2025-12-29T23:33:47.892Z",
    "buildStatus": "success",
    "lastBuild": "2025-12-29T23:57:31.090Z",
    "workingTree": "dirty",
    "branch": "main",
    "ahead": 0,
    "behind": 0
  },
  "progress": {
    "masterPlan": {
      "total": 3,
      "completed": 0,
      "percentage": 0
    },
    "rules": {
      "total": 26,
      "implemented": 25,
      "percentage": 0.9615384615384616
    },
    "pipeline": {
      "total": 0,
      "completed": 0,
      "percentage": 0
    }
  },
  "gates": {
    "local": {
      "confidence": 0.85,
      "structural": 0.35
    },
    "vision": {
      "enabledByDefault": false,
      "role": "Optional"
    }
  },
  "recentUpdates": [
    {
      "timestamp": "2025-12-29T23:45:00Z",
      "type": "fix",
      "message": "Classification Engine Tuning: Adjusted weights to prevent false-positive Buttons. Fixed UI rendering bug (detailsList scope).",
      "files": [
        "src/code.ts",
        "ui/ui.html"
      ]
    },
    {
      "timestamp": "2025-12-28T10:30:00Z",
      "type": "dashboard_merged",
      "message": "HomeTab ×•-DashboardScreen ××•×–×’×• ×œ×¢××•×“ ××—×“ ×¢× padding, hover states, ×× ×™××¦×™×•×ª ×•× ×•×˜×™×¤×™×§×¦×™×•×ª",
      "files": [
        "dashboard/src/components/HomeTab.tsx",
        "dashboard/src/components/Toast.tsx",
        "dashboard/src/hooks/useToast.ts"
      ]
    }
  ],
  "notifications": [
    {
      "id": "notif-001",
      "type": "info",
      "title": "×“×©×‘×•×¨×“ ××•×›×Ÿ",
      "message": "×”×“×©×‘×•×¨×“ ×–××™×Ÿ ×‘-GitHub Pages ×¢× ×›×œ ×”×ª×›×•× ×•×ª ×”×—×“×©×•×ª",
      "timestamp": "2025-12-28T10:30:00Z",
      "read": false
    }
  ],
  "uiStates": {
    "idle": "IDLE",
    "identifying": "IDENTIFYING",
    "needsConfirmation": "NEEDS_CONFIRMATION",
    "identified": "IDENTIFIED",
    "planReady": "PLAN_READY",
    "executing": "EXECUTING",
    "done": "DONE"
  }
}

==================================================
FILE_PATH: README_REACT.md
==================================================
# Dashboard React Setup - ×”×•×¨××•×ª ×”×ª×§× ×”

## ×©×œ×‘ 1: ×”×ª×§× ×ª Dependencies

```bash
cd dashboard
npm install
```

## ×©×œ×‘ 2: ×”×¢×ª×§×ª ×”×§×•×“ ×-React ×©×§×™×‘×œ×ª

×”×§×•×“ ×©×§×™×‘×œ×ª ×-"×‘×•× ×” ×”××¤×œ×™×§×¦×™×•×ª" ×¦×¨×™×š ×œ×”×™×•×ª ×‘-`src/App.tsx`.

**××” ×œ×¢×©×•×ª:**
1. ×”×¢×ª×§ ××ª ×›×œ ×”×§×•×“ ×-React ×©×§×™×‘×œ×ª
2. ×©××•×¨ ××•×ª×• ×‘-`dashboard/src/App.tsx` (×ª×—×œ×™×£ ××ª ×”×§×•×‘×¥ ×”× ×•×›×—×™)
3. ×•×“× ×©×™×© import ×©×œ `loadProjectData` ×-`./data/loadData`

## ×©×œ×‘ 3: ×™×¦×™×¨×ª Components (shadcn/ui)

×”×§×•×“ ××©×ª××© ×‘-shadcn/ui components. ×™×© ×©×ª×™ ××¤×©×¨×•×™×•×ª:

### ××•×¤×¦×™×” A: ×”×ª×§× ×ª shadcn/ui (××•××œ×¥)
```bash
npx shadcn-ui@latest init
npx shadcn-ui@latest add card button input badge tabs scroll-area separator checkbox
```

### ××•×¤×¦×™×” B: ×™×¦×™×¨×ª components ×¤×©×•×˜×™× (×œ×œ× shadcn)
××¤×©×¨ ×œ×™×¦×•×¨ components ×¤×©×•×˜×™× ×‘-`src/components/ui/` ×©××—×§×™× ××ª ×”-API ×©×œ shadcn.

## ×©×œ×‘ 4: ×¢×“×›×•×Ÿ ×”×§×•×“ ×œ×§×¨×™××ª Truth Files

×”×§×•×“ ×”× ×•×›×—×™ ××©×ª××© ×‘-hardcoded data. ×¦×¨×™×š:

1. **×¢×“×›×Ÿ `src/data/loadData.ts`**:
   - ×§×¨× ×-`docs/EXECUTION_LOG.json`
   - ×§×¨× ×-`docs/Project-plan.md`
   - ×§×¨× ×-`CHANGELOG.md`
   - ×§×¨× ×-`docs/CURRENT_STATUS.md`

2. **×¦×•×¨ script `scripts/generate-dashboard-data.cjs`**:
   - ×§×¨× ××ª ×›×œ ×”-truth files
   - ×¦×•×¨ `dashboard/data.json` ×¢× ×›×œ ×”× ×ª×•× ×™×
   - ×”×•×¡×£ ×œ-`package.json` â†’ `"build": "... && node scripts/generate-dashboard-data.cjs"`

## ×©×œ×‘ 5: ×”×¨×¦×”

```bash
# Development
npm run dev

# Build
npm run build

# Preview
npm run preview
```

## ×©×œ×‘ 6: Deploy

### GitHub Pages:
```bash
npm run build
# ×”×¢×œ×” dist/ ×œ-gh-pages branch
```

### Vercel:
```bash
vercel
```

## ×”×¢×¨×•×ª

- ×”×§×•×“ ××©×ª××© ×‘-Tailwind CSS - ×•×“× ×©-`tailwind.config.js` ××•×’×“×¨ × ×›×•×Ÿ
- ×”×§×•×“ ××©×ª××© ×‘-recharts ×œ×’×¨×¤×™× - ×•×“× ×©-`recharts` ××•×ª×§×Ÿ
- ×”×§×•×“ ××©×ª××© ×‘-Radix UI (×“×¨×š shadcn) - ×•×“× ×©-components ××•×ª×§× ×™×

## ×‘×¢×™×•×ª × ×¤×•×¦×•×ª

**"Cannot find module '@/components/ui/card'"**
â†’ ×”×ª×§×Ÿ shadcn/ui ××• ×¦×•×¨ components ×¤×©×•×˜×™×

**"recharts not found"**
â†’ `npm install recharts`

**"Tailwind classes not working"**
â†’ ×•×“× ×©-`tailwind.config.js` ××›×™×œ ××ª ×”-paths ×”× ×›×•× ×™×



==================================================
FILE_PATH: tsconfig.json
==================================================
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,

    /* Path aliases */
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



==================================================
FILE_PATH: vite.config.ts
==================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  // Base path for GitHub Pages: /xp-map/
  // For local dev/preview, Vite handles this automatically
  base: '/xp-map/',
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
  },
  preview: {
    port: 4173,
    strictPort: false,
  },
  server: {
    port: 5173,
    strictPort: false,
  },
})


==================================================
FILE_PATH: CURSOR-ONBOARDING.md
==================================================
# Onboarding: xp-map Dashboard - ×”×•×¨××•×ª ×œ-Cursor

## ××˜×¨×”

×”×“×©×‘×•×¨×“ ×”×–×” ××¦×™×’ ××ª ×”×¡×˜×˜×•×¡ ×•×”×”×ª×§×“××•×ª ×©×œ ×¤×¨×•×™×§×˜ **figma-oz** (Figma Plugin). ×”× ×ª×•× ×™× ××ª×¢×“×›× ×™× ××•×˜×•××˜×™×ª ×-figma-oz ×“×¨×š GitHub API.

## ××™×š ×”× ×ª×•× ×™× ××’×™×¢×™×

×”×“×©×‘×•×¨×“ ×§×•×¨× × ×ª×•× ×™× ×-figma-oz repo ×‘×©×ª×™ ×“×¨×›×™×:

1. **GitHub API** (×‘×¨×™×¨×ª ××—×“×œ) - ×ª××™×“ ××¢×•×“×›×Ÿ
   - `https://raw.githubusercontent.com/haimXseb/figma-oz/main/dashboard-sync/dashboard-sync.json`
   - `https://raw.githubusercontent.com/haimXseb/figma-oz/main/dashboard/data.json`

2. **×§×‘×¦×™× ××§×•××™×™×** (fallback) - ×× GitHub API ×œ× ×–××™×Ÿ
   - `dashboard-sync.json` (×‘×©×•×¨×©)
   - `data/data.json`

## ××‘× ×” ×”×¤×¨×•×™×§×˜

```
xp-map/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ loadData.ts          â† ×›××Ÿ ×§×•×¨××™× ××ª ×”× ×ª×•× ×™×
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ HomeTab.tsx          â† ×”××¡×š ×”×¨××©×™
â”‚   â”‚   â”œâ”€â”€ TasksTab.tsx
â”‚   â”‚   â”œâ”€â”€ LogsTab.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ App.tsx                  â† × ×§×•×“×ª ×”×›× ×™×¡×”
â”œâ”€â”€ dashboard-sync.json          â† ×§×•×‘×¥ sync (×× × ×“×—×£)
â”œâ”€â”€ data/
â”‚   â””â”€â”€ data.json               â† × ×ª×•× ×™× ××œ××™× (×× × ×“×—×£)
â””â”€â”€ package.json
```

## ××™×š ×œ×”×¨×™×¥

### Development

```bash
npm install
npm run dev
```

×¤×ª×—: http://localhost:5173/dashboard/

### Build

```bash
npm run build
```

×”×§×•×‘×¥ × ×‘× ×” ×œ-`dist/`

### Preview

```bash
npm run preview
```

×¤×ª×—: http://localhost:4173/dashboard/

## ××™×š ×œ×¤×¨×¡× ×œ-GitHub Pages

### ×“×¨×š 1: GitHub Actions (××•×˜×•××˜×™)

1. ×•×“× ×©×™×© ×§×•×‘×¥ `.github/workflows/deploy.yml`
2. ×•×“× ×©-GitHub Pages ××•×¤×¢×œ ×‘-repo settings
3. ×›×œ push ×œ-`main` ×™×‘× ×” ×•×™×¤×¨×¡× ××•×˜×•××˜×™×ª

### ×“×¨×š 2: ×™×“× ×™

```bash
npm run build
# ×”×¢×ª×§ ××ª dist/ ×œ-gh-pages branch ××• ×”×©×ª××© ×‘-gh-pages package
```

## ×¢×“×›×•×Ÿ × ×ª×•× ×™×

×”× ×ª×•× ×™× ××ª×¢×“×›× ×™× ××•×˜×•××˜×™×ª ×-figma-oz. ××™×Ÿ ×¦×•×¨×š ×œ×¢×“×›×Ÿ ×™×“× ×™×ª.

×× ×¦×¨×™×š ×œ×¢×“×›×Ÿ ×™×“× ×™×ª:
1. ×‘-figma-oz: `npm run sync:dashboard`
2. ×–×” ×™×“×—×•×£ ××ª ×”×§×‘×¦×™× ×œ-xp-map
3. ×”×“×©×‘×•×¨×“ ×™×§×¨× ××•×ª× ×‘×¤×¢× ×”×‘××”

## ×§×‘×¦×™× ×—×©×•×‘×™× ×œ×¢×¨×™×›×”

### `src/data/loadData.ts`

×–×” ×”×§×•×‘×¥ ×©×§×•×¨× ××ª ×”× ×ª×•× ×™×. ×”×•× ×× ×¡×”:
1. GitHub API (×ª××™×“ ××¢×•×“×›×Ÿ)
2. ×§×‘×¦×™× ××§×•××™×™× (fallback)
3. × ×ª×•× ×™× ×‘×¨×™×¨×ª ××—×“×œ (×× ×”×›×œ × ×›×©×œ)

**××œ ×ª×©× ×” ××ª ×”×œ×•×’×™×§×” ×”×–×•** - ×”×™× ×¢×•×‘×“×ª ×˜×•×‘.

### `src/components/HomeTab.tsx`

×”××¡×š ×”×¨××©×™. ×›××Ÿ ××¤×©×¨ ×œ×”×•×¡×™×£/×œ×©× ×•×ª UI.

### `vite.config.ts`

×”×’×“×¨×•×ª build. ×× ×¦×¨×™×š ×œ×©× ×•×ª base path ×œ-GitHub Pages.

## ×©××œ×•×ª × ×¤×•×¦×•×ª

### Q: ×”× ×ª×•× ×™× ×œ× ××ª×¢×“×›× ×™×

**A:** 
1. ×‘×“×•×§ ××ª ×”×§×•× ×¡×•×œ - ××•×œ×™ ×™×© ×©×’×™××ª fetch
2. ×‘×“×•×§ ×©-figma-oz ×“×—×£ ×¢×“×›×•× ×™×: https://github.com/haimXseb/figma-oz/blob/main/dashboard-sync/dashboard-sync.json
3. × ×¡×” refresh (Ctrl+R / Cmd+R)

### Q: ××™×š ×× ×™ ×™×•×“×¢ ××ª×™ ×™×© ×¢×“×›×•×Ÿ ×—×“×©?

**A:** 
- ×‘×“×•×§ ××ª `metadata.lastUpdated` ×‘-`dashboard-sync.json`
- ××¤×©×¨ ×œ×”×•×¡×™×£ notification ×‘×“×©×‘×•×¨×“ ×›×©×™×© ×¢×“×›×•×Ÿ

### Q: ×”×× ××¤×©×¨ ×œ×¢×“×›×Ÿ ××ª figma-oz ×-xp-map?

**A:** ×œ×. ×”×¡×™× ×›×¨×•×Ÿ ×”×•× ×—×“-×›×™×•×•× ×™: figma-oz â†’ xp-map.

### Q: ××™×š ×× ×™ ××•×¡×™×£ ×ª×›×•× ×” ×—×“×©×”?

**A:**
1. ×¢×¨×•×š ××ª ×”-components ×‘-`src/components/`
2. ×”×•×¡×£ ××ª ×”× ×ª×•× ×™× ×‘-`loadData.ts` ×× ×¦×¨×™×š
3. Build ×•-test

## ×§×™×©×•×¨×™×

- **figma-oz repo:** https://github.com/haimXseb/figma-oz
- **xp-map repo:** https://github.com/haimXseb/xp-map
- **Dashboard (××—×¨×™ deploy):** https://haimXseb.github.io/xp-map/dashboard/

## ×”×¢×¨×•×ª ×—×©×•×‘×•×ª

âš ï¸ **××œ ×ª××—×§ ××ª ×”×ª×™×§×™×™×” xp-map ××”×¤×œ××’×™×Ÿ!**

×”×ª×™×§×™×™×” ×”×–×• ×”×™× ×¢×•×ª×§ ××§×•××™ ×œ×‘×“×™×§×”. ×”×™× ×œ× ××©×¤×™×¢×” ×¢×œ ×”×¤×œ××’×™×Ÿ, ××‘×œ:
- ×× ×ª××—×§ ××•×ª×”, ×”×“×©×‘×•×¨×“ ×™××©×™×š ×œ×¢×‘×•×“ (×§×•×¨× ×-GitHub API)
- ××‘×œ ×œ× ×ª×•×›×œ ×œ×‘×“×•×§ ××§×•××™×ª

**×”×“×©×‘×•×¨×“ ×¢×¦×××™ ×œ×—×œ×•×˜×™×Ÿ** - ×”×•× ×œ× ×ª×œ×•×™ ×‘×§×‘×¦×™× ××”×¤×œ××’×™×Ÿ ×‘×–××Ÿ ×¨×™×¦×”.

---

**×¢×•×“×›×Ÿ:** 2025-12-28  
**×’×¨×¡×”:** 1.0



==================================================
FILE_PATH: docs/EXECUTION_LOG.json
==================================================
{
  "metadata": {
    "version": "1.0",
    "lastUpdated": "2026-01-06T01:49:26.300Z",
    "currentPhase": "Phase 2 Complete",
    "currentGoal": "Phase 3: Ambiguity Handling + Selection Normalization + Rollout to 10 Components"
  },
  "blockers": [],
  "phases": [
    {
      "id": "phase2",
      "name": "Ops & Visibility",
      "epics": [
        {
          "id": "execution-log",
          "name": "EXECUTION_LOG.json",
          "status": "done",
          "owner": "Cursor",
          "evidence": "docs/EXECUTION_LOG.json",
          "tasks": []
        }
      ]
    }
  ],
  "logEntries": [
    {
      "timestamp": "2026-01-06T01:49:26.300Z",
      "type": "verification",
      "message": "Phase 2 Complete â€” Button: centered text wins",
      "phase": "Phase 2 Complete",
      "files": ["src/code.ts"]
    },
    {
      "timestamp": "2026-01-06T01:49:26.300Z",
      "type": "verification",
      "message": "Phase 2 Complete â€” Input vs Button tie-breaker works",
      "phase": "Phase 2 Complete",
      "files": ["src/code.ts"]
    },
    {
      "timestamp": "2026-01-06T01:49:26.300Z",
      "type": "verification",
      "message": "Phase 2 Complete â€” Checkbox square vs circle",
      "phase": "Phase 2 Complete",
      "files": ["src/code.ts"]
    },
    {
      "timestamp": "2026-01-06T01:49:26.300Z",
      "type": "verification",
      "message": "Phase 2 Complete â€” Dropdown requires icon",
      "phase": "Phase 2 Complete",
      "files": ["src/code.ts"]
    },
    {
      "timestamp": "2025-12-29T23:50:00Z",
      "type": "task_completed",
      "message": "Completed full engine wiring and rule implementation for MVP components. All Phase 3 rules (TF-01..TF-14, BL-01..BL-05, CB-01..CB-03, SC-01..SC-03) implemented and wired into Phase 4 orchestrator. Handoff UI state completed.",
      "phase": "phase4",
      "files": [
        "src/rules/textField.ts",
        "src/rules/button.ts",
        "src/rules/checkbox.ts",
        "src/rules/dropdown.ts",
        "src/code.ts",
        "ui/ui.html"
      ]
    }
  ],
  "reasoning": [
    {
      "timestamp": "2026-01-06T01:49:26.300Z",
      "action": "Phase 2 Complete â€” Architecture tasks updated",
      "why": "All core components standardized on NodeSignals. Architecture tasks completed with bounded traversal v1 and Fusion v1 (local-first AI skip).",
      "relatedFiles": ["src/code.ts"],
      "phase": "Phase 2 Complete"
    }
  ],
  "architectureTasks": [
    {
      "id": "arch-01",
      "name": "Bounded traversal with collectNodeSignals",
      "status": "done",
      "note": "Done as bounded traversal v1 (maxDepth=2). Selection normalization deferred."
    },
    {
      "id": "arch-02",
      "name": "Detector contract standardization",
      "status": "done",
      "note": "Done for all components"
    },
    {
      "id": "arch-04",
      "name": "AI Skip Gate / Fusion",
      "status": "done",
      "note": "Done as Fusion v1 (local-first AI skip, threshold 0.85). Not global arbitration."
    }
  ]
}


==================================================
FILE_PATH: public/dashboard-sync.json
==================================================
{
  "metadata": {
    "version": "1.0",
    "lastUpdated": "2025-12-28T04:20:30.629Z",
    "description": "×§×•×‘×¥ ××¨×›×–×™ ×œ×¡×™× ×›×¨×•×Ÿ ×‘×™×Ÿ ×”×¤×¨×•×™×§×˜ ×œ×“×©×‘×•×¨×“. Cursor ××¢×“×›×Ÿ ××ª ×”×§×•×‘×¥ ×”×–×”, script ×“×•×—×£ ×œ×“×©×‘×•×¨×“.",
    "syncScript": "node dashboard-sync/sync-to-dashboard.cjs"
  },
  "project": {
    "name": "OZ â€“ Design-Time Accessibility Assistant",
    "mvp": "Text Field â€“ E2E",
    "repo": "github.com/haimXseb/figma-oz",
    "currentPhase": "phase3",
    "currentGoal": "MVP Brain + Visibility tooling + Protocol Safety",
    "buildCommand": "npm run build",
    "scope": "Text Field ×‘×œ×‘×“"
  },
  "status": {
    "blockers": [],
    "lastContextDump": "2025-12-28T02:31:04.006Z",
    "buildStatus": "success",
    "lastBuild": "2025-12-28T04:20:30.631Z",
    "workingTree": "dirty",
    "branch": "main",
    "ahead": 0,
    "behind": 0
  },
  "progress": {
    "masterPlan": {
      "total": 3,
      "completed": 0,
      "percentage": 0
    },
    "rules": {
      "total": 25,
      "implemented": 0,
      "percentage": 0
    },
    "pipeline": {
      "total": 0,
      "completed": 0,
      "percentage": 0
    }
  },
  "gates": {
    "local": {
      "confidence": 0.85,
      "structural": 0.35
    },
    "vision": {
      "enabledByDefault": false,
      "role": "Optional"
    }
  },
  "recentUpdates": [
    {
      "timestamp": "2025-12-28T10:30:00Z",
      "type": "dashboard_merged",
      "message": "HomeTab ×•-DashboardScreen ××•×–×’×• ×œ×¢××•×“ ××—×“ ×¢× padding, hover states, ×× ×™××¦×™×•×ª ×•× ×•×˜×™×¤×™×§×¦×™×•×ª",
      "files": [
        "dashboard/src/components/HomeTab.tsx",
        "dashboard/src/components/Toast.tsx",
        "dashboard/src/hooks/useToast.ts"
      ]
    }
  ],
  "notifications": [
    {
      "id": "notif-001",
      "type": "info",
      "title": "×“×©×‘×•×¨×“ ××•×›×Ÿ",
      "message": "×”×“×©×‘×•×¨×“ ×–××™×Ÿ ×‘-GitHub Pages ×¢× ×›×œ ×”×ª×›×•× ×•×ª ×”×—×“×©×•×ª",
      "timestamp": "2025-12-28T10:30:00Z",
      "read": false
    }
  ],
  "uiStates": {
    "idle": "IDLE",
    "identifying": "IDENTIFYING",
    "needsConfirmation": "NEEDS_CONFIRMATION",
    "identified": "IDENTIFIED",
    "planReady": "PLAN_READY",
    "executing": "EXECUTING",
    "done": "DONE"
  }
}

==================================================
FILE_PATH: public/data/data.json
==================================================
{
  "meta": {
    "name": "OZ â€“ Design-Time Accessibility Assistant",
    "updated": "2025-12-28",
    "mvp": "Text Field â€“ E2E",
    "repo": "github.com/1haim/figma-oz"
  },
  "executionLog": {
    "metadata": {
      "version": "1.0",
      "lastUpdated": "2025-12-28T10:30:00Z",
      "currentPhase": "phase3",
      "currentGoal": "MVP Brain + Visibility tooling + Protocol Safety"
    },
    "blockers": [],
    "phases": [
      {
        "id": "phase2",
        "name": "Ops & Visibility",
        "epics": [
          {
            "id": "execution-log",
            "name": "EXECUTION_LOG.json",
            "status": "done",
            "owner": "Cursor",
            "evidence": "docs/EXECUTION_LOG.json",
            "tasks": []
          },
          {
            "id": "ui-map",
            "name": "UI-Map.md",
            "status": "in-progress",
            "owner": "Cursor",
            "evidence": "docs/UI-Map.md",
            "tasks": []
          },
          {
            "id": "dashboard",
            "name": "Project Dashboard",
            "status": "in-progress",
            "owner": "Cursor",
            "evidence": "dashboard/index.html",
            "tasks": [
              {
                "id": "dashboard-react",
                "name": "React Dashboard Setup",
                "status": "done",
                "owner": "Cursor",
                "evidence": "dashboard/src/App_FULL.tsx"
              },
              {
                "id": "dashboard-home-tab",
                "name": "Home Tab with Master Plan",
                "status": "in-progress",
                "owner": "Cursor",
                "evidence": "dashboard/src/App.tsx"
              }
            ]
          }
        ]
      },
      {
        "id": "phase3",
        "name": "Rules",
        "epics": [
          {
            "id": "text-field-rules",
            "name": "Text Field Rules (TF-01..TF-14)",
            "status": "pending",
            "owner": "Cursor",
            "evidence": "src/code.ts (placeholder)",
            "tasks": []
          },
          {
            "id": "button-rules",
            "name": "Button Rules (BL-01..BL-05)",
            "status": "pending",
            "owner": "Cursor",
            "evidence": "src/code.ts (placeholder)",
            "tasks": []
          },
          {
            "id": "checkbox-rules",
            "name": "Checkbox Rules (CB-01..CB-03)",
            "status": "pending",
            "owner": "Cursor",
            "evidence": "src/code.ts (placeholder)",
            "tasks": []
          },
          {
            "id": "select-rules",
            "name": "Select/Dropdown Rules (SC-01..SC-03)",
            "status": "pending",
            "owner": "Cursor",
            "evidence": "src/code.ts (placeholder)",
            "tasks": []
          }
        ]
      },
      {
        "id": "phase4",
        "name": "Wiring",
        "epics": [
          {
            "id": "code-wiring",
            "name": "code.ts wiring",
            "status": "in-progress",
            "owner": "Cursor",
            "evidence": "src/code.ts",
            "tasks": [
              {
                "id": "orchestrator",
                "name": "Multi-component orchestrator",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/code.ts:classifyComponent"
              },
              {
                "id": "vision-integration",
                "name": "AI Vision integration",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/code.ts:classifyFromImageVision"
              },
              {
                "id": "rule-hooks",
                "name": "Rule hooks into orchestrator",
                "status": "pending",
                "owner": "Cursor",
                "evidence": "src/code.ts (TODO)"
              }
            ]
          },
          {
            "id": "schema-conformance",
            "name": "schema conformance",
            "status": "pending",
            "owner": "Cursor",
            "evidence": "src/protocol.ts",
            "tasks": []
          }
        ]
      }
    ],
    "logEntries": [
      {
        "timestamp": "2025-12-28T10:30:00Z",
        "type": "task_completed",
        "message": "Created EXECUTION_LOG.json structure",
        "phase": "phase2",
        "files": [
          "docs/EXECUTION_LOG.json"
        ]
      },
      {
        "timestamp": "2025-12-25T14:00:00Z",
        "type": "task_completed",
        "message": "Component detection engine with multi-signal scoring",
        "phase": "phase4",
        "files": [
          "src/code.ts"
        ]
      },
      {
        "timestamp": "2025-12-24T09:00:00Z",
        "type": "task_completed",
        "message": "Preview export + PREVIEW_READY protocol message",
        "phase": "phase4",
        "files": [
          "src/code.ts",
          "ui/ui.html"
        ]
      },
      {
        "timestamp": "2025-12-23T16:00:00Z",
        "type": "task_completed",
        "message": "verify-changelog script + commit gating",
        "phase": "phase2",
        "files": [
          "scripts/verify-changelog.cjs"
        ]
      }
    ],
    "reasoning": [
      {
        "timestamp": "2025-12-28T10:30:00Z",
        "action": "Created EXECUTION_LOG.json",
        "why": "Need single source of truth for task status, decisions, and blockers. Enables dashboard to show real-time project state.",
        "relatedFiles": [
          "docs/EXECUTION_LOG.json"
        ],
        "phase": "phase2"
      },
      {
        "timestamp": "2025-12-25T14:00:00Z",
        "action": "Implemented multi-signal component detection",
        "why": "Need reliable component type identification using structure, layout, and semantic signals. Strict gate (0.85 confidence + 0.35 structural) ensures quality.",
        "relatedFiles": [
          "src/code.ts"
        ],
        "phase": "phase4"
      }
    ]
  },
  "gitStatus": {
    "branch": "main",
    "workingTree": "dirty",
    "modifiedFiles": [
      "ARCHITECTURE.md",
      "BUILDLOG.md",
      "CHANGELOG.md",
      "DEPLOYLOG.md",
      "Definition_Of_Done.md",
      "PROJECT_TREE.txt",
      "README.md",
      "SYSTEM_CONTEXT.md",
      "api/chat-proxy.ts",
      "api/fetch-and-map.ts",
      "api/health.ts",
      "api/populate-embedding.ts",
      "api/providers.ts",
      "docs/00-meta/research-log.md",
      "docs/01-foundations/foundations-engine-logic.docx",
      "docs/01-foundations/foundations-engine-logic_v2_hybrid-vision-first.docx",
      "docs/01-foundations/research-guard-rails.docx",
      "docs/02-research/ai-engine-spec-phase-1.docx",
      "docs/02-research/wcag-coverage-map.docx",
      "docs/03-components/mvp-rule-pack-v1.docx",
      "docs/03-components/mvp-rule-pack-v1_v2_hybrid-vision-first.docx",
      "docs/04-engine/component-responsibility-matrix.xlsx",
      "docs/04-engine/mvp-top-20-components.docx",
      "docs/05-handoff/figma-handoff-assets.docx",
      "App-structure.md -> docs/archive/App-structure.md",
      "Project-plan.md -> docs/archive/Project-plan.md",
      "a11y_assistant.md -> docs/archive/a11y_assistant.md",
      "a11y_assistant_impementation_plan.md -> docs/archive/a11y_assistant_impementation_plan.md",
      "package.json",
      "public/.gitkeep",
      "scripts/build-ui.cjs",
      "src/code.ts",
      "src/ui-inline.ts",
      "ui/ui.html",
      "PROJECT_TREE.md",
      "dashboard/",
      "docs/CURRENT_STATUS.md",
      "docs/EXECUTION_LOG.json",
      "docs/NotebookLM-Onboarding.md",
      "docs/Project-plan.md",
      "docs/Runtime-Accessibility-Intent-Catalog-LOCKED.md",
      "docs/UI-Map.md",
      "docs/archive/02-project/",
      "docs/archive/04-research/",
      "docs/archive/ai-engine-spec-phase-1.docx",
      "docs/archive/ai/",
      "docs/archive/component-responsibility-matrix.xlsx",
      "docs/archive/figma-handoff-assets.docx",
      "docs/archive/foundations-engine-logic-legacy.docx",
      "docs/archive/mvp-top-20-components.docx",
      "docs/archive/research-guard-rails.docx",
      "docs/archive/research-log.md",
      "docs/archive/wcag-coverage-map.docx",
      "\"docs/engine outline-LOCKED.docx\"",
      "docs/foundations-engine-logic-LOCKED.docx",
      "docs/mvp-rule-pack-LOCKED.docx",
      "\"docs/pre locked/\"",
      "docs/test-scenarios-LOCKED.md",
      "\"legacy old/\"",
      "scripts/add-latest-header.py",
      "scripts/detailed-table-check.py",
      "scripts/fix-docx-header.py",
      "scripts/git-status.cjs",
      "scripts/update-project-tree.cjs",
      "scripts/verify-docx-structure.py",
      "src/assets/check.svg",
      "src/assets/chevron.svg",
      "\"src/assets/layers icons/\"",
      "src/assets/ui/",
      "src/protocol.ts"
    ],
    "ahead": 0,
    "behind": 0,
    "lastCommit": "2025-12-24 18:47:27 +0200",
    "lastPush": "2025-12-24 18:47:27 +0200",
    "timestamp": "2025-12-28T02:31:04.006Z"
  },
  "progress": {
    "masterPlan": {
      "total": 3,
      "completed": 0,
      "percentage": 0
    },
    "rules": {
      "total": 25,
      "implemented": 0,
      "percentage": 0
    }
  },
  "recent": [
    {
      "date": "2025-12-25",
      "items": [
        "Component detection engine with multi-signal scoring (structure + layout + semantic), strict gate (confidence >= 0.85 AND structural >= 0.35), auto-resolve parent tree climbing (up to 3 levels)"
      ]
    },
    {
      "date": "2025-12-24",
      "items": [
        "Preview export (natural size, transparent background) + PREVIEW_READY protocol message"
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Added `scripts/verify-changelog.cjs` and npm scripts to gate commits on CHANGELOG updates when code changes."
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Quarantined legacy sources (`src/accessibility.ts`, `src/tool-library.ts`) to `quarantine/legacy-2025-12-23/` since the runtime now uses inlined equivalents."
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Removed stray `.DS_Store` files and ignored them via `.gitignore`."
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Documented the current architecture and entry points in `ARCHITECTURE.md`."
      ]
    }
  ],
  "uiMap": "# UI State Machine\n\n**Last Updated**: 2025-12-28  \n**Purpose**: Document UI state machine and transitions\n\n---\n\n## States\n\n### IDLE\n- **Description**: No selection, empty state\n- **UI**: Shows \"Select a node to preview\" message\n- **Actions**: User selects a node in Figma\n\n### IDENTIFYING\n- **Description**: Scanning/vision classification in progress\n- **UI**: Shows \"AI scanning selection...\" or \"Detecting component type...\"\n- **Actions**: Auto-transitions based on classification result\n\n### NEEDS_CONFIRMATION\n- **Description**: Classification confidence below gate (0.90), requires user confirmation\n- **UI**: Shows chips (sorted by confidence) + manual input + \"Start over\"\n- **Actions**: User selects component type or enters custom name\n\n### IDENTIFIED\n- **Description**: Component type confirmed (either auto-passed or user-selected)\n- **UI**: Shows component type chip, \"Correct\" button, intent display\n- **Actions**: User can click \"Correct\" to change type, or proceed to scan\n\n### PLAN_READY\n- **Description**: Scan complete, plan shown with Designer Changes + Developer Handoff\n- **UI**: Shows \"Designer Changes\" and \"Developer Handoff\" sections, \"Accessible it\" button\n- **Actions**: User can review plan, apply fixes, or export handoff\n\n### EXECUTING\n- **Description**: Applying autofixes in progress\n- **UI**: Shows progress indicator\n- **Actions**: Auto-transitions to DONE when complete\n\n### DONE\n- **Description**: All fixes applied, handoff ready\n- **UI**: Shows completion message, export options\n- **Actions**: User can export handoff or start over\n\n---\n\n## Transitions\n\n```\nIDLE â†’ IDENTIFYING\n  Trigger: User selects node + clicks \"Accessible it\"\n  \nIDENTIFYING â†’ NEEDS_CONFIRMATION\n  Trigger: Classification confidence < 0.90 OR gate fails\n  \nIDENTIFYING â†’ IDENTIFIED\n  Trigger: Classification confidence >= 0.90 AND gate passes\n  \nNEEDS_CONFIRMATION â†’ IDENTIFIED\n  Trigger: User selects component type (chip or manual input)\n  \nIDENTIFIED â†’ PLAN_READY\n  Trigger: Scan complete, plan generated\n  \nPLAN_READY â†’ EXECUTING\n  Trigger: User clicks \"Accessible it\" (apply fixes)\n  \nEXECUTING â†’ DONE\n  Trigger: All fixes applied\n  \nAny state â†’ IDLE\n  Trigger: Selection cleared (nodes = 0)\n```\n\n---\n\n## State Variables\n\n### selectionState\n- `none`: No selection\n- `hasSelection`: Node selected\n\n### classifyState\n- `idle`: Not classifying\n- `processing`: Classification in progress\n- `done`: Classification complete\n\n### certaintyState\n- `certain`: Confidence >= 0.90, gate passed\n- `uncertain`: Confidence < 0.90 or gate failed\n\n### reasoningState\n- `collapsed`: Reasoning panel hidden\n- `expanded`: Reasoning panel visible\n\n---\n\n## UI Components by State\n\n### IDLE\n- Empty state message\n- No preview\n- No actions\n\n### IDENTIFYING\n- Preview (immutable, from selection)\n- Status text: \"AI scanning selection...\"\n- Loading indicator (optional)\n\n### NEEDS_CONFIRMATION\n- Preview (immutable)\n- Component type chips (sorted by confidence)\n- Manual input field\n- \"Start over\" button\n\n### IDENTIFIED\n- Preview (immutable)\n- Component type chip\n- \"Correct\" button\n- Intent display\n- \"Show Reasoning\" toggle\n- \"Accessible it\" button (if scan ready)\n\n### PLAN_READY\n- Preview (collapsed to header thumbnail)\n- \"Designer Changes\" section\n- \"Developer Handoff\" section\n- \"Accessible it\" button\n\n### EXECUTING\n- Progress indicator\n- Status text: \"Applying fixes...\"\n\n### DONE\n- Completion message\n- Export options\n- \"Start over\" button\n\n---\n\n## Notes\n\n- **Preview Immutability**: Preview image only changes when selection changes, not when classification certainty changes\n- **Single UI Shell**: All states use the same layout structure. Uncertainty adds suggestions section, doesn't replace entire UI\n- **State Reset**: When selection cleared, all states reset to IDLE, preview cleared\n\n",
  "projectPlan": "# NotebookLM Onboarding - Design-Time Accessibility Plugin\n\n**Purpose**: This document serves as the single onboarding source for NotebookLM (\"Noty\") to understand and navigate the Figma Design-Time Accessibility Plugin project.\n\n**Last Updated**: 2024-12-19  \n**Source of Truth**: `docs/02-project/Project-plan.md` (master plan)\n\n---\n\n## 1. Project in One Page\n\n### Goal\nBuild a Figma plugin that identifies components during design-time, runs accessibility checks, suggests safe fixes, and generates developer handoff. **Shift-left accessibility** - catch issues before code is written.\n\n### MVP Scope\n**Components**: Text Field, Button, Checkbox, Dropdown/Select only  \n**Severity**: WARN only (no FAIL/BLOCKER)  \n**Output**: Design guidance + UX patterns + Code snippets (HTML/ARIA)\n\n### Core Principle\n**AI Visual First (default)**: Vision classification is the primary method. Local tree-based analysis is fallback when AI unavailable or uncertain.\n\n### Locked Decisions\n- **AI Visual First**: Vision default, signals backup\n- **Confidence Gate**: 0.90 threshold for PASS (strict)\n- **Severity Policy**: PASS/ASK/WARN only (no FAIL)\n- **UI Shell**: Static layout, uncertainty adds suggestions only (no layout change)\n- **Output Schema**: Unified JSON contract for classifier/orchestrator\n\n---\n\n## 2. Current Status Snapshot\n\n### What's Implemented\n\n#### UI (`ui/ui.html`)\n- âœ… **Single UI Shell**: State machine with `selectionState`, `classifyState`, `certaintyState`, `reasoningState`\n- âœ… **Header Row**: Node icon, name, preview thumbnail\n- âœ… **Identification Card**: Component type chip, \"Correct\" button, intent display\n- âœ… **Reasoning Panel**: Collapsible, shows \"Why {componentType}\" and \"Why Intent\"\n- âœ… **Correction Flow**: Chips (sorted by confidence) + manual input + \"Start over\"\n- âœ… **Preview**: Natural size export, zoom (100-500%), panning, theme toggle (preview bg only)\n- âœ… **Asset Loading**: All icons embedded as inline SVG\n- âœ… **State Reset**: Clears preview when no selection\n\n#### Engine (`src/code.ts`)\n- âœ… **Multi-Component Orchestrator**: `classifyComponent()` runs detectors for TextField, Button, Checkbox, Dropdown\n- âœ… **AI Vision Integration**: `classifyFromImageVision()` using OpenAI GPT-4o (if API key provided)\n- âœ… **Local Classifiers**: Tree-based detectors with structure/layout/semantic scoring\n- âœ… **Design System Context**: `detectDesignSystemContext()` reads file/page names, applies bias rules\n- âœ… **Hard-Gating**: DS context excludes incompatible component types (e.g., checkbox on \"buttons\" page)\n- âœ… **Auto-Resolve**: Climbs parent tree (up to 3 levels) if initial classification fails\n- âœ… **Decision Fusion**: AI Vision (if `confidence >= 0.80`) else local classifier\n- âœ… **Confidence Gate**: 0.90 threshold for PASS (strict)\n- âœ… **Session Persistence**: Stores chosen component type per nodeId\n\n#### Routing (`src/protocol.ts`)\n- âœ… **Message Types**: `VISION_CLASSIFY_REQUEST`, `VISION_CLASSIFY_RESULT`, `CLASSIFICATION_UPDATED`\n- âœ… **Schema**: `VisionClassifyResultMessage` with `componentType`, `componentTypeConfidence`, `intent`, `intentConfidence`, `reasoning[]`, `gate`, `method`\n- âœ… **User Actions**: `USER_SET_COMPONENT_TYPE`, `USER_SET_COMPONENT_NAME`, `USER_RESTART`\n\n### What's NOT Implemented (MVP Gaps)\n\n#### Missing Features\n- âŒ **Scan Rules**: TF-01..TF-14 checks not implemented (placeholder only)\n- âŒ **Autofix Engine**: Safe autofix (layer renaming, focus states, annotations) not implemented\n- âŒ **Handoff Generator**: Design/UX/Code output not implemented\n- âŒ **ASK Flow Full**: Partial (component type confirmation works, but scan-level ASK not implemented)\n\n#### Known Limitations\n- AI Vision requires OpenAI API key in `figma.clientStorage` (falls back to local if missing)\n- Checkbox and Dropdown detectors are basic (need refinement)\n- No streaming scan results (all-at-once only)\n\n---\n\n## 3. Architecture Map\n\n### Folder Structure\n\n```\nFigma plugin/\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ code.ts              # Main thread (Figma API, classification, message handling)\nâ”‚   â”œâ”€â”€ protocol.ts          # Message types and guards (UI â†” Main contract)\nâ”‚   â””â”€â”€ assets/\nâ”‚       â”œâ”€â”€ ui/              # UI icons (logo, buttons, chevron, etc.)\nâ”‚       â””â”€â”€ layers icons/    # Figma node type icons (frame, component, text, etc.)\nâ”œâ”€â”€ ui/\nâ”‚   â””â”€â”€ ui.html              # UI thread (HTML/CSS/JS, state machine, rendering)\nâ”œâ”€â”€ dist/                    # Build output (generated)\nâ”‚   â”œâ”€â”€ src/code.js          # Compiled main thread\nâ”‚   â”œâ”€â”€ ui.html              # Inline HTML (via build-ui.cjs)\nâ”‚   â””â”€â”€ assets/              # Copied assets\nâ”œâ”€â”€ docs/\nâ”‚   â”œâ”€â”€ 01-foundations/      # Source of truth: foundations-engine-logic.docx\nâ”‚   â”œâ”€â”€ 02-project/         # Project plan, test scenarios, this doc\nâ”‚   â”œâ”€â”€ 03-components/      # Source of truth: mvp-rule-pack.docx\nâ”‚   â””â”€â”€ 04-research/         # Supporting docs (classifier research, runtime catalog)\nâ””â”€â”€ scripts/\n    â””â”€â”€ build-ui.cjs         # Build script (copies ui.html, generates ui-inline.ts)\n```\n\n### Entry Points\n\n- **Main Thread**: `src/code.ts` â†’ compiled to `dist/src/code.js` (loaded by Figma)\n- **UI Thread**: `ui/ui.html` â†’ copied to `dist/ui.html` (loaded by `figma.showUI()`)\n- **Build**: `npm run build` â†’ runs `build-ui` + `build-main` + `typecheck`\n\n### Runtime Flow\n\n```\n1. User selects node in Figma\n   â†“\n2. Main thread: handleSelectionChange()\n   â†’ Export PNG preview (natural size, transparent)\n   â†’ Send SELECTION_PREVIEW_READY to UI\n   â†“\n3. UI: renderShell() updates preview, shows identification card\n   â†“\n4. User clicks \"Accessible it\"\n   â†“\n5. UI: sends ACCESSIBLE_IT_RUN\n   â†“\n6. Main: handleAccessibilityRun()\n   â†’ Export preview (if not already)\n   â†’ Send PREVIEW_READY\n   â†“\n7. UI: sends VISION_CLASSIFY_REQUEST\n   â†“\n8. Main: handleVisionClassify()\n   â†’ detectDesignSystemContext()\n   â†’ classifyFromImageVision() [if ENABLE_AI_VISION && API key]\n   â†’ classifyComponent() [orchestrator: runs all detectors]\n   â†’ Decision fusion (AI vs local)\n   â†’ Auto-resolve (if FAIL, climb parent tree)\n   â†’ Send VISION_CLASSIFY_RESULT\n   â†“\n9. UI: handleVisionClassifyResult()\n   â†’ If gate PASS: show Summary Mode, emit ASK_START\n   â†’ If gate FAIL: show Chat Mode (suggestions), wait for user\n   â†“\n10. User confirms/overrides component type\n    â†“\n11. Main: handleUserSetComponentType()\n    â†’ Update finalComponentType\n    â†’ Send CLASSIFICATION_UPDATED\n    â†“\n12. UI: handleClassificationUpdated()\n    â†’ Update reasoning to match finalComponentType\n    â†’ Switch to Summary Mode\n    â†’ Show \"Accessible it\" button\n```\n\n### Key Functions\n\n**Main Thread (`src/code.ts`)**:\n- `classifyComponent(node, dsContext)`: Orchestrator - runs all detectors, applies context bias, selects best candidate\n- `classifyTextFieldFromNodeTree(node)`: Text Field detector (structure + layout + semantic scoring)\n- `classifyButtonFromNodeTree(node)`: Button detector\n- `classifyCheckboxFromNodeTree(node)`: Checkbox detector (with negative gates)\n- `classifyFromImageVision(bytesBase64, nodeContext, dsContext)`: AI Vision classifier\n- `detectDesignSystemContext()`: Reads file/page names, returns `{ isDS, pageDomain, reasons }`\n- `handleVisionClassify()`: Main classification handler (AI + local fusion)\n\n**UI Thread (`ui/ui.html`)**:\n- `renderShell()`: Single UI shell renderer (manages all states)\n- `handleVisionClassifyResult()`: Updates UI based on classification result\n- `handleClassificationUpdated()`: Updates UI after user override\n\n---\n\n## 4. State Machine & UI Shell Rule\n\n### State Machine\n\nThe UI uses a single state machine (no \"two screens\"):\n\n```typescript\nconst state = {\n  // Selection state\n  selectionState: \"none\" | \"hasSelection\",\n  selectedNode: SceneNode | null,\n  selectionFingerprint: string | null,\n\n  // Classification state\n  classifyState: \"idle\" | \"processing\" | \"done\",\n\n  // Certainty state\n  certaintyState: \"certain\" | \"uncertain\",\n\n  // Reasoning state\n  reasoningState: \"collapsed\" | \"expanded\",\n\n  // Component type (separate suggested vs final)\n  suggestedComponentType: string | null,\n  finalComponentType: string | null, // After user override\n};\n```\n\n### UI Shell Rule\n\n**Always the same layout**:\n- Top bar (header with logo, buttons)\n- Identification card (component name, preview, type chip)\n- Validation section (intent, confidence)\n- Details section (reasoning toggle + panel)\n- Actions (Accessible it, Annotate buttons)\n\n**Uncertainty behavior**:\n- If `certaintyState === \"uncertain\"`: Add \"Suggestions / Correction Flow\" section at bottom\n- Do NOT replace entire screen with chat\n- Do NOT hide Summary Mode\n- Suggestions section contains: chips (sorted by confidence) + manual input + \"Start over\"\n\n**Reasoning correctness**:\n- Always use `finalComponentType` (after user override) for reasoning title/content\n- Never show \"Why Button\" if user selected \"Text Field\"\n\n---\n\n## 5. Classifier/Engine Output Contract\n\n### JSON Schema\n\n**`VISION_CLASSIFY_RESULT` message**:\n\n```typescript\n{\n  type: \"VISION_CLASSIFY_RESULT\",\n  nodeId: string,\n  suggestedComponentType: \"textField\" | \"dropdown\" | \"button\" | \"checkbox\" | \"unknown\",\n  componentTypeConfidence: number, // 0..1\n  intent?: \"password\" | \"email\" | \"phone\" | \"search\" | \"name\" | \"address\" | \"zip\" | \"url\" | \"username\" | \"description\" | \"other\" | \"unknown\",\n  intentConfidence?: number, // 0..1\n  suggestedLabel?: string,\n  reasoning: string[], // Bullet strings for \"Why {componentType}\"\n  intentReasoning?: string[], // Bullet strings for \"Why Intent\"\n  gate: \"PASS\" | \"FAIL\",\n  thresholds: { pass: number }, // Echo threshold used (0.90)\n  method?: \"local\" | \"ai_vision\" | \"fallback\",\n  nodeName?: string,\n  reasoningDataContext?: string, // File/page context\n}\n```\n\n### Gate Rules\n\n**PASS** (auto-proceed):\n- `componentTypeConfidence >= 0.90` AND\n- `componentType !== \"unknown\"` AND\n- (For Text Field) `structureScore >= 0.35`\n\n**FAIL** (ask user):\n- `componentTypeConfidence < 0.90` OR\n- `componentType === \"unknown\"` OR\n- (For Text Field) `structureScore < 0.35`\n\n### Decision Fusion Logic\n\n1. **AI Vision** (if enabled and API key available):\n   - Call `classifyFromImageVision()`\n   - If `componentType !== \"unknown\"` AND `componentTypeConfidence >= 0.80` â†’ use AI\n   - If AI intent: `intentConfidence >= 0.75` â†’ use AI intent\n\n2. **Local Classifier** (fallback or if AI fails):\n   - Call `classifyComponent()` (orchestrator)\n   - Runs all detectors, applies context bias, selects best candidate\n   - Returns `componentType`, `confidence`, `reasoning[]`\n\n3. **Auto-Resolve** (if FAIL):\n   - Climb parent tree (up to 3 levels)\n   - Re-run classification on parent\n   - If parent PASS â†’ return parent result with \"Auto-resolved\" in reasoning\n\n### Example Outputs\n\n**PASS Example**:\n```json\n{\n  \"type\": \"VISION_CLASSIFY_RESULT\",\n  \"nodeId\": \"123:456\",\n  \"suggestedComponentType\": \"textField\",\n  \"componentTypeConfidence\": 0.92,\n  \"intent\": \"search\",\n  \"intentConfidence\": 0.78,\n  \"reasoning\": [\n    \"Container with visible fill/stroke\",\n    \"Text node inside container bounds\",\n    \"Left padding >= 8px\",\n    \"Single-line text structure\"\n  ],\n  \"intentReasoning\": [\n    \"Search icon detected\",\n    \"Nearby text: '×—×™×¤×•×©'\"\n  ],\n  \"gate\": \"PASS\",\n  \"thresholds\": { \"pass\": 0.90 },\n  \"method\": \"ai_vision\",\n  \"nodeName\": \"Search Input\"\n}\n```\n\n**FAIL Example**:\n```json\n{\n  \"type\": \"VISION_CLASSIFY_RESULT\",\n  \"nodeId\": \"123:456\",\n  \"suggestedComponentType\": \"unknown\",\n  \"componentTypeConfidence\": 0.65,\n  \"reasoning\": [\n    \"Ambiguous structure\",\n    \"No clear input container pattern\"\n  ],\n  \"gate\": \"FAIL\",\n  \"thresholds\": { \"pass\": 0.90 },\n  \"method\": \"local\",\n  \"nodeName\": \"Component 1\"\n}\n```\n\n---\n\n## 6. How to Run / Build / Deploy\n\n### Build\n\n```bash\nnpm run build\n```\n\nThis runs:\n1. `build-ui`: Copies `ui/ui.html` to `dist/ui.html`, generates `src/ui-inline.ts`\n2. `build-main`: Compiles `src/code.ts` to `dist/src/code.js` (esbuild)\n3. `typecheck`: TypeScript type checking (no emit)\n\n### Development\n\n```bash\n# Watch UI changes\nnpm run dev:ui\n\n# Build only\nnpm run build-ui\nnpm run build-main\n```\n\n### Testing in Figma\n\n1. Open Figma Desktop\n2. Plugins â†’ Development â†’ Import plugin from manifest\n3. Select `manifest.json` from project root\n4. Plugin appears in Plugins menu\n5. Run plugin, select a node, click \"Accessible it\"\n\n### Deployment\n\n**Not yet implemented** - MVP is local development only.\n\n**Future**: Deploy to Figma Community (requires plugin approval process).\n\n---\n\n## 7. Definition of Done Summary\n\n**Source**: `Definition_Of_Done.md`\n\n### Build & Runtime\n- âœ… `npm run build` completes successfully\n- âœ… Plugin loads in Figma Desktop without errors\n- âœ… No unsupported JavaScript features in compiled output\n- âœ… `figma.showUI` receives valid HTML\n\n### MVP: Text Field E2E (Current Focus)\n\n**Selection â†’ Preview**:\n- âœ… Preview exports as PNG at natural size (no upscale)\n- âœ… Transparent background\n- âœ… Preview renders correctly in UI\n\n**Component Detection**:\n- âœ… Multi-signal classification runs\n- âœ… Confidence gate: `confidence >= 0.90 AND structureScore >= 0.35`\n- âœ… Auto-resolve: climb parent tree up to 3 levels if FAIL\n- âœ… Returns `componentType: \"textField\"` or `\"unknown\"`\n\n**ASK Flow**:\n- âœ… If PASS: auto-filled, user can review/adjust\n- âœ… If FAIL: manual chips + input\n- âœ… `ASK_START` message sent with `source: \"auto\"` or `\"manual\"`\n\n**Scan Rules** (TF-01..TF-14):\n- âŒ **NOT IMPLEMENTED** - Placeholder only\n\n**Autofix**:\n- âŒ **NOT IMPLEMENTED** - Placeholder only\n\n**Handoff**:\n- âŒ **NOT IMPLEMENTED** - Placeholder only\n\n### Error Handling\n- âœ… Runtime errors surfaced to UI\n- âœ… User always gets feedback\n- âœ… No silent failures\n\n### UI Accessibility\n- âœ… Status updates via `aria-live`\n- âœ… Icon-only buttons have accessible names\n- âœ… Keyboard navigation works\n\n### Designer Experience\n- âœ… Plugin doesn't modify layout unexpectedly\n- âœ… Risky fixes are suggestions only\n- âœ… User understands what changed and why\n\n---\n\n## 8. Open TODOs (Finish MVP)\n\n### Critical (Block MVP Completion)\n\n1. **Scan Rules Implementation** (`src/code.ts`)\n   - Implement TF-01..TF-14 checks for Text Field\n   - All checks return WARN (no FAIL)\n   - Stream results to UI (`SCAN_PROGRESS` messages)\n   - Reference: `docs/03-components/mvp-rule-pack.docx`\n\n2. **Autofix Engine v1** (`src/code.ts`)\n   - Safe autofix (default ON):\n     - Rename layers (Input / Label / Helper / Icon / Container)\n     - Enforce min font sizes (body min 14, headings/labels 16) - WARN + suggestion only\n     - Create Focus state variant when missing\n     - Add annotation metadata (plugin data)\n   - Reference: `docs/01-foundations/foundations-engine-logic.docx`\n\n3. **Handoff Generator** (`src/code.ts`)\n   - Design guidance (what to change in design)\n   - UX patterns (states, focus, error patterns)\n   - Code snippets (HTML/ARIA)\n   - Reference: `docs/03-components/mvp-rule-pack.docx`\n\n4. **ASK Flow Completion** (`src/code.ts`, `ui/ui.html`)\n   - Scan-level ASK (not just component type)\n   - Template-based questions\n   - User responses stored and applied\n\n### High Priority (Before Launch)\n\n5. **Button/Checkbox/Dropdown Detectors Refinement**\n   - Improve confidence scoring\n   - Add negative gates (like checkbox has)\n   - Test on Design System pages\n\n6. **Test Scenarios Execution**\n   - Run all tests in `docs/02-project/test-scenarios.md`\n   - Document results\n   - Fix any failures\n\n7. **UI Polish**\n   - Preview zoom/pan bounds clamping (408x408)\n   - Theme toggle persistence\n   - Animation smoothness\n\n### Medium Priority (Post-MVP)\n\n8. **Post-MVP Components**\n   - Radio, Toggle/Switch, Link, Icon Button, Textarea, Search, Password, Date picker, Modal/Dialog, Toast/Alert\n   - Reference: `docs/02-project/Project-plan.md` section 10.2\n\n9. **Deployment**\n   - Figma Community submission\n   - Plugin store listing\n   - Documentation site\n\n---\n\n## 9. Key Documents Reference\n\n### Source of Truth (Locked)\n- `docs/01-foundations/foundations-engine-logic.docx`: Engine logic, AI Visual First, gates, schema\n- `docs/03-components/mvp-rule-pack.docx`: MVP component rules, checks, autofix boundaries, handoff\n\n### Master Plan\n- `docs/02-project/Project-plan.md`: Complete project plan, locked decisions, workstreams\n\n### Supporting Docs\n- `docs/02-project/test-scenarios.md`: Acceptance tests (15 test cases)\n- `docs/04-research/classifier-orchestrator-research.md`: Classifier architecture details\n- `docs/04-research/Runtime Accessibility Intent Catalog.md`: Runtime intents (filtered to MVP)\n- `docs/04-research/Design-Time Signals â€“ Raw Extraction.md`: Signal extraction details\n\n### Code\n- `src/code.ts`: Main thread (classification, message handling)\n- `src/protocol.ts`: Message types and guards\n- `ui/ui.html`: UI thread (state machine, rendering)\n\n---\n\n## 10. Quick Reference: Locked Decisions\n\n| Decision | Value | Source |\n|----------|-------|--------|\n| AI Visual First | Default ON | Project-plan.md Â§5.1 |\n| Confidence Gate | 0.90 (strict) | Project-plan.md Â§5.3 |\n| Severity Policy | PASS/ASK/WARN only (no FAIL) | Project-plan.md Â§7 |\n| UI Shell | Static layout, uncertainty adds suggestions | Project-plan.md Â§10.4.1 |\n| Output Schema | Unified JSON contract | Project-plan.md Â§11.1 |\n| MVP Components | Text Field, Button, Checkbox, Dropdown | Project-plan.md Â§10.1 |\n\n---\n\n## 11. Common Questions\n\n**Q: Why is AI Vision default ON but sometimes uses local classifier?**  \nA: AI Vision requires OpenAI API key. If missing or API call fails, falls back to local classifier automatically.\n\n**Q: What's the difference between `suggestedComponentType` and `finalComponentType`?**  \nA: `suggestedComponentType` is what the classifier detected. `finalComponentType` is after user override (if any). Reasoning always uses `finalComponentType`.\n\n**Q: Why does DS context exclude certain component types?**  \nA: Design System pages have strong context signals. A \"Buttons\" page should never classify as Checkbox, even with weak icon signals. Hard-gating prevents misclassification.\n\n**Q: What happens if classification fails on selected node?**  \nA: Auto-resolve climbs parent tree (up to 3 levels) and re-runs classification. If parent passes gate, returns parent result with \"Auto-resolved\" in reasoning.\n\n**Q: How do I add a new component type?**  \nA: 1) Add detector function (e.g., `classifyRadioFromNodeTree()`), 2) Add to orchestrator in `classifyComponent()`, 3) Update protocol types, 4) Add to MVP rule pack.\n\n---\n\n## Immediate Execution Phase\n\n- [ ] Create Logic Rules for Text Field (TF-01 to TF-14).\n- [ ] Create Logic Rules for Button (BL-01 to BL-05).\n- [ ] Hook Logic into Orchestrator (src/code.ts).\n",
  "currentStatus": "# Current Rules Status\n\n**Last Updated**: 2025-12-28  \n**Purpose**: Track which rules are implemented vs pending\n\n---\n\n## Text Field Rules\n\n- TF-01: Field Label - â³ Pending\n- TF-02: Field Required - â³ Pending\n- TF-03: Field Validation - â³ Pending\n- TF-04: Field Validation Focus - â³ Pending\n- TF-05: Field Validations - â³ Pending\n- TF-06: Field Context - â³ Pending\n- TF-07: Field Placeholder - â³ Pending\n- TF-08: Field Error Messages - â³ Pending\n- TF-09: Field Help Text - â³ Pending\n- TF-10: Field Keyboard Navigation - â³ Pending\n- TF-11: Field Auto-complete - â³ Pending\n- TF-12: Field Input Types - â³ Pending\n- TF-13: Field Size Constraints - â³ Pending\n- TF-14: Field Color Contrast - â³ Pending\n\n**Total**: 0/14 implemented (0%)\n\n---\n\n## Button Rules\n\n- BL-01: Button Roles - â³ Pending\n- BL-02: Button Labeling - â³ Pending\n- BL-03: Button States - â³ Pending\n- BL-04: Button Keyboard Navigation - â³ Pending\n- BL-05: Button Focus Indicators - â³ Pending\n\n**Total**: 0/5 implemented (0%)\n\n---\n\n## Checkbox Rules\n\n- CB-01: Checkbox Roles - â³ Pending\n- CB-02: Checkbox Labeling - â³ Pending\n- CB-03: Checkbox States - â³ Pending\n\n**Total**: 0/3 implemented (0%)\n\n---\n\n## Select/Dropdown Rules\n\n- SC-01: Select Roles - â³ Pending\n- SC-02: Select Labeling - â³ Pending\n- SC-03: Select Keyboard Navigation - â³ Pending\n\n**Total**: 0/3 implemented (0%)\n\n---\n\n## Overall Status\n\n**Total Rules**: 25  \n**Implemented**: 0  \n**Pending**: 25  \n**Coverage**: 0%\n\n---\n\n## Notes\n\n- All rules are currently placeholders in `src/code.ts`\n- Rules will be implemented in Phase 3\n- Evidence links will point to specific functions in `src/code.ts` once implemented\n\n",
  "truth": {
    "note": "Source of truth: Foundations + MVP rule pack. ×©××¨ ×”××¡××›×™× ×ª×•××›×™× ×‘×œ×‘×“.",
    "docs": [
      {
        "label": "Foundations â€“ engine logic",
        "path": "docs/foundations-engine-logic-LOCKED.docx"
      },
      {
        "label": "MVP rule pack",
        "path": "docs/mvp-rule-pack-LOCKED.docx"
      }
    ]
  },
  "pipeline": [
    {
      "id": "select",
      "title": "×‘×—×™×¨×”",
      "detail": "×”××¢×¦×‘ ×‘×•×—×¨ × ×•×“ ×‘-Figma"
    },
    {
      "id": "preview",
      "title": "×ª×¦×•×’×” ××§×“×™××”",
      "detail": "PNG ×‘×’×•×“×œ ×˜×‘×¢×™ ×¢× ×¨×§×¢ ×©×§×•×£"
    },
    {
      "id": "type",
      "title": "×–×™×”×•×™ ×¡×•×’ ×§×•××¤×•× × ×˜×”",
      "detail": "×—×•×§×™× ××§×•××™×™× ×¢× Gate ×§×©×™×—"
    },
    {
      "id": "intent",
      "title": "Intent/Label",
      "detail": "×‘×¨×™×¨×ª ××—×“×œ: Unknown. Auto-resolve ×¢×“ 3 ×”×•×¨×™×"
    },
    {
      "id": "checks",
      "title": "×‘×“×™×§×•×ª",
      "detail": "TF-01â€¦TF-14 (WARN ×‘×œ×‘×“ ×‘-MVP)"
    },
    {
      "id": "fix",
      "title": "××•×˜×•-×¤×™×§×¡",
      "detail": "×¨×§ Safe autofixes ×œ×¤×™ ×§×¨×™×˜×¨×™×•× ×™×"
    },
    {
      "id": "handoff",
      "title": "Handoff",
      "detail": "×¤×œ×˜ ××•×‘× ×” ×œ×“×™×–×™×™×Ÿ + Dev"
    }
  ],
  "gates": {
    "local": {
      "confidence": 0.85,
      "structural": 0.35
    },
    "vision": {
      "enabledByDefault": false,
      "role": "Boost + sanity check (×œ× dependency)"
    }
  },
  "build": {
    "command": "npm run build",
    "artifacts": [
      {
        "path": "dist/src/code.js",
        "note": "Main plugin bundle"
      },
      {
        "path": "dist/ui.html",
        "note": "UI bundle"
      },
      {
        "path": "src/ui-inline.ts",
        "note": "Generated â€“ ×œ× ×œ×¢×¨×•×š"
      }
    ]
  },
  "storage": [
    {
      "key": "aims.log",
      "type": "Array<JobLog>",
      "purpose": "×”×™×¡×˜×•×¨×™×™×ª ×”×¨×¦×•×ª (UNDO)"
    },
    {
      "key": "ams-settings",
      "type": "Settings",
      "purpose": "×”×¢×“×¤×•×ª ××©×ª××© (provider/model/keys)"
    },
    {
      "key": "OPENAI_API_KEY",
      "type": "string",
      "purpose": "××¤×ª×— AI Vision"
    }
  ],
  "files": {
    "mustEdit": [
      {
        "path": "src/code.ts",
        "why": "×œ×•×’×™×§×”: orchestrator + detectors + gates"
      },
      {
        "path": "ui/ui.html",
        "why": "UI + state machine"
      },
      {
        "path": "src/protocol.ts",
        "why": "×¤×¨×•×˜×•×§×•×œ ×”×•×“×¢×•×ª"
      }
    ],
    "dontEdit": [
      {
        "path": "src/ui-inline.ts",
        "why": "Generated"
      },
      {
        "path": "dist/*",
        "why": "Build output"
      }
    ]
  },
  "projectTree": {
    "groups": [
      {
        "title": "Must-edit (MVP)",
        "nodes": [
          {
            "path": "src/code.ts",
            "tags": [
              "logic",
              "orchestrator",
              "detectors"
            ]
          },
          {
            "path": "ui/ui.html",
            "tags": [
              "ui",
              "state-machine"
            ]
          },
          {
            "path": "src/protocol.ts",
            "tags": [
              "protocol"
            ]
          }
        ]
      },
      {
        "title": "Generated (do not edit)",
        "nodes": [
          {
            "path": "src/ui-inline.ts",
            "tags": [
              "generated"
            ]
          },
          {
            "path": "dist/src/code.js",
            "tags": [
              "compiled"
            ]
          },
          {
            "path": "dist/ui.html",
            "tags": [
              "copied"
            ]
          }
        ]
      },
      {
        "title": "Docs",
        "nodes": [
          {
            "path": "docs/foundations-engine-logic-LOCKED.docx",
            "tags": [
              "authoritative"
            ]
          },
          {
            "path": "docs/mvp-rule-pack-LOCKED.docx",
            "tags": [
              "authoritative"
            ]
          },
          {
            "path": "README.md",
            "tags": [
              "supporting"
            ]
          },
          {
            "path": "ARCHITECTURE.md",
            "tags": [
              "supporting"
            ]
          }
        ]
      }
    ]
  },
  "ideas": {
    "src/code.ts": [
      "DS-context hard block: ×‘×¢××•×“ Buttons ×œ× ×œ×¡×•×•×’ ×›-Text Field ×‘×œ×™ ×¨××™×•×ª ×—×–×§×•×ª.",
      "Cross-check ×‘×™×Ÿ Vision ×œ×‘×™×Ÿ local: ×× Vision ×‘×˜×•×— ××‘×œ structural × ××•×š â€“ ×œ×¢×‘×•×¨ ×œ-Ask.",
      "Reasoning trace ×˜×™×¤×•×¡×™ ×œ×›×œ ×¡×™×•×•×’ (debug drawer ×‘-UI)."
    ],
    "ui/ui.html": [
      "Ambiguity resolution: ×‘××§×•× dropdown â€“ 2â€“4 ×›×¤×ª×•×¨×™ ×‘×—×™×¨×” inline.",
      "×ª×¦×•×’×” ××§×“×™××” ×’×“×•×œ×” ×¢×“ ××—×¨×™ ××™×©×•×¨ (×œ× ×œ×›×•×•×¥ ×œ×¤× ×™).",
      "Status timeline ×§×•××¤×§×˜×™: ×¡×¨×™×§×” â†’ ×¡×™×’× ×œ×™× â†’ Gate â†’ ×‘×“×™×§×•×ª â†’ handoff."
    ],
    "src/protocol.ts": [
      "JOB_UPDATE ××—×™×“ ×¢× payload ××•×‘× ×” (stage/progress/trace/preview).",
      "Protocol versioning ×›×“×™ ×œ×× ×•×¢ ××™-×ª××™××•×ª UI/Main ×‘×–××Ÿ ××™×˜×¨×¦×™×•×ª."
    ],
    "Build/Deploy": [
      "build:watch ×©××“×¤×™×¡ ××” ×”×©×ª× ×” (UI/Main).",
      "deploy sanity: ××™××•×ª path ×©×œ manifest ×œ-dist/."
    ]
  }
}

==================================================
FILE_PATH: dashboard-sync/dashboard-sync.json
==================================================
{
  "metadata": {
    "version": "1.0",
    "lastUpdated": "2026-01-06T01:48:46.300Z",
    "description": "×§×•×‘×¥ ××¨×›×–×™ ×œ×¡×™× ×›×¨×•×Ÿ ×‘×™×Ÿ ×”×¤×¨×•×™×§×˜ ×œ×“×©×‘×•×¨×“. Cursor ××¢×“×›×Ÿ ××ª ×”×§×•×‘×¥ ×”×–×”, script ×“×•×—×£ ×œ×“×©×‘×•×¨×“.",
    "syncScript": "node dashboard-sync/sync-to-dashboard.cjs"
  },
  "project": {
    "name": "OZ â€“ Design-Time Accessibility Assistant",
    "mvp": "Text Field â€“ E2E",
    "repo": "github.com/haimXseb/figma-oz",
    "currentPhase": "Phase 2 Complete",
    "currentGoal": "Phase 3: Ambiguity Handling + Selection Normalization + Rollout to 10 Components",
    "buildCommand": "npm run build",
    "scope": "Text Field ×‘×œ×‘×“"
  },
  "status": {
    "blockers": [],
    "lastContextDump": "2025-12-29T23:33:47.892Z",
    "buildStatus": "success",
    "lastBuild": "2025-12-29T23:57:31.090Z",
    "workingTree": "dirty",
    "branch": "main",
    "ahead": 0,
    "behind": 0
  },
  "progress": {
    "masterPlan": {
      "total": 3,
      "completed": 0,
      "percentage": 0
    },
    "rules": {
      "total": 26,
      "implemented": 25,
      "percentage": 0.9615384615384616
    },
    "pipeline": {
      "total": 0,
      "completed": 0,
      "percentage": 0
    }
  },
  "gates": {
    "local": {
      "confidence": 0.85,
      "structural": 0.35
    },
    "vision": {
      "enabledByDefault": false,
      "role": "Optional"
    }
  },
  "recentUpdates": [
    {
      "timestamp": "2026-01-06T01:48:46.300Z",
      "type": "milestone",
      "message": "Phase 2 Complete â€” All core components (TextField, Button, Checkbox, Dropdown) standardized on NodeSignals"
    },
    {
      "timestamp": "2026-01-06T01:48:46.300Z",
      "type": "feature",
      "message": "AI Skip Gate â€” Fusion v1 active (local-first, threshold 0.85)"
    },
    {
      "timestamp": "2026-01-06T01:48:46.300Z",
      "type": "planning",
      "message": "Next Phase â€” Ambiguity handling, tie-breakers, selection normalization"
    },
    {
      "timestamp": "2025-12-29T23:45:00Z",
      "type": "fix",
      "message": "Classification Engine Tuning: Adjusted weights to prevent false-positive Buttons. Fixed UI rendering bug (detailsList scope).",
      "files": [
        "src/code.ts",
        "ui/ui.html"
      ]
    },
    {
      "timestamp": "2025-12-28T10:30:00Z",
      "type": "dashboard_merged",
      "message": "HomeTab ×•-DashboardScreen ××•×–×’×• ×œ×¢××•×“ ××—×“ ×¢× padding, hover states, ×× ×™××¦×™×•×ª ×•× ×•×˜×™×¤×™×§×¦×™×•×ª",
      "files": [
        "dashboard/src/components/HomeTab.tsx",
        "dashboard/src/components/Toast.tsx",
        "dashboard/src/hooks/useToast.ts"
      ]
    }
  ],
  "notifications": [
    {
      "id": "notif-001",
      "type": "info",
      "title": "×“×©×‘×•×¨×“ ××•×›×Ÿ",
      "message": "×”×“×©×‘×•×¨×“ ×–××™×Ÿ ×‘-GitHub Pages ×¢× ×›×œ ×”×ª×›×•× ×•×ª ×”×—×“×©×•×ª",
      "timestamp": "2025-12-28T10:30:00Z",
      "read": false
    }
  ],
  "uiStates": {
    "idle": "IDLE",
    "identifying": "IDENTIFYING",
    "needsConfirmation": "NEEDS_CONFIRMATION",
    "identified": "IDENTIFIED",
    "planReady": "PLAN_READY",
    "executing": "EXECUTING",
    "done": "DONE"
  },
  "architecture": {
    "detectorContract": "All detectors accept (node, signals) and return { confidence, reasoning, breakdown }",
    "aiSkipGate": {
      "threshold": 0.85,
      "note": "Fusion v1 (local-first). Not global fusion."
    },
    "traversal": {
      "method": "collectNodeSignals bounded traversal",
      "maxDepth": 2,
      "note": "Selection normalization planned for Phase 3"
    }
  }
}


==================================================
FILE_PATH: data/data.json
==================================================
{
  "meta": {
    "name": "OZ â€“ Design-Time Accessibility Assistant",
    "updated": "2025-12-29",
    "mvp": "Text Field â€“ E2E",
    "repo": "github.com/1haim/figma-oz"
  },
  "executionLog": {
    "metadata": {
      "version": "1.0",
      "lastUpdated": "2026-01-06T01:49:26.300Z",
      "currentPhase": "Phase 2 Complete",
      "currentGoal": "Phase 3: Ambiguity Handling + Selection Normalization + Rollout to 10 Components"
    },
    "blockers": [],
    "phases": [
      {
        "id": "phase2",
        "name": "Ops & Visibility",
        "epics": [
          {
            "id": "execution-log",
            "name": "EXECUTION_LOG.json",
            "status": "done",
            "owner": "Cursor",
            "evidence": "docs/EXECUTION_LOG.json",
            "tasks": []
          },
          {
            "id": "ui-map",
            "name": "UI-Map.md",
            "status": "done",
            "owner": "Cursor",
            "evidence": "docs/UI-Map.md",
            "tasks": []
          },
          {
            "id": "context-dump",
            "name": "context-dump.mjs",
            "status": "done",
            "owner": "Cursor",
            "evidence": "scripts/context-dump.mjs, CONTEXT_DUMP.txt",
            "tasks": [
              {
                "id": "context-dump-script",
                "name": "Create context-dump.mjs script",
                "status": "done",
                "owner": "Cursor",
                "evidence": "scripts/context-dump.mjs"
              }
            ]
          },
          {
            "id": "xp-protocol",
            "name": "XP Protocol (generate-xp-status.mjs)",
            "status": "done",
            "owner": "Cursor",
            "evidence": "scripts/generate-xp-status.mjs, xp-data.json",
            "tasks": [
              {
                "id": "xp-status-script",
                "name": "Create generate-xp-status.mjs",
                "status": "done",
                "owner": "Cursor",
                "evidence": "scripts/generate-xp-status.mjs"
              }
            ]
          },
          {
            "id": "product-journey-map",
            "name": "Product Journey Map",
            "status": "done",
            "owner": "Cursor",
            "evidence": "docs/Product-Journey-Map.md",
            "tasks": [
              {
                "id": "journey-map-doc",
                "name": "Create Product-Journey-Map.md with Block System analysis",
                "status": "done",
                "owner": "Cursor",
                "evidence": "docs/Product-Journey-Map.md"
              }
            ]
          },
          {
            "id": "dashboard",
            "name": "Project Dashboard",
            "status": "in-progress",
            "owner": "Cursor",
            "evidence": "dashboard/index.html",
            "tasks": [
              {
                "id": "dashboard-react",
                "name": "React Dashboard Setup",
                "status": "done",
                "owner": "Cursor",
                "evidence": "dashboard/src/App_FULL.tsx"
              },
              {
                "id": "dashboard-home-tab",
                "name": "Home Tab with Master Plan",
                "status": "in-progress",
                "owner": "Cursor",
                "evidence": "dashboard/src/App.tsx"
              }
            ]
          }
        ]
      },
      {
        "id": "phase3",
        "name": "Rules",
        "epics": [
          {
            "id": "text-field-rules",
            "name": "Text Field Rules (TF-01..TF-14)",
            "status": "done",
            "owner": "Cursor",
            "evidence": "src/rules/textField.ts, src/rules/utils.ts",
            "tasks": [
              {
                "id": "rules-foundation",
                "name": "Create src/rules/utils.ts with WCAG math",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/rules/utils.ts"
              },
              {
                "id": "text-field-checks",
                "name": "Implement TF-01 through TF-14 checks",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/rules/textField.ts"
              }
            ]
          },
          {
            "id": "button-rules",
            "name": "Button Rules (BL-01..BL-05)",
            "status": "done",
            "owner": "Cursor",
            "evidence": "src/rules/button.ts",
            "tasks": [
              {
                "id": "button-checks",
                "name": "Implement BL-01 through BL-05 checks",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/rules/button.ts"
              }
            ]
          },
          {
            "id": "checkbox-rules",
            "name": "Checkbox Rules (CB-01..CB-03)",
            "status": "done",
            "owner": "Cursor",
            "evidence": "src/rules/checkbox.ts",
            "tasks": [
              {
                "id": "checkbox-checks",
                "name": "Implement CB-01 through CB-03 checks",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/rules/checkbox.ts"
              }
            ]
          },
          {
            "id": "select-rules",
            "name": "Select/Dropdown Rules (SC-01..SC-03)",
            "status": "done",
            "owner": "Cursor",
            "evidence": "src/rules/dropdown.ts",
            "tasks": [
              {
                "id": "dropdown-checks",
                "name": "Implement SC-01 through SC-03 checks",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/rules/dropdown.ts"
              }
            ]
          }
        ]
      },
      {
        "id": "phase4",
        "name": "Wiring",
        "epics": [
          {
            "id": "code-wiring",
            "name": "code.ts wiring",
            "status": "done",
            "owner": "Cursor",
            "evidence": "src/code.ts",
            "tasks": [
              {
                "id": "orchestrator",
                "name": "Multi-component orchestrator",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/code.ts:classifyComponent"
              },
              {
                "id": "vision-integration",
                "name": "AI Vision integration",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/code.ts:classifyFromImageVision"
              },
              {
                "id": "rule-hooks",
                "name": "Rule hooks into orchestrator",
                "status": "done",
                "owner": "Cursor",
                "evidence": "src/code.ts - rule checks integrated in classifyComponent"
              }
            ]
          },
          {
            "id": "schema-conformance",
            "name": "schema conformance",
            "status": "done",
            "owner": "Cursor",
            "evidence": "src/code.ts - rule results merged into reasoning array",
            "tasks": []
          }
        ]
      }
    ],
    "logEntries": [
      {
        "timestamp": "2026-01-06T01:49:26.300Z",
        "type": "verification",
        "message": "Phase 2 Complete â€” Button: centered text wins",
        "phase": "Phase 2 Complete",
        "files": ["src/code.ts"]
      },
      {
        "timestamp": "2026-01-06T01:49:26.300Z",
        "type": "verification",
        "message": "Phase 2 Complete â€” Input vs Button tie-breaker works",
        "phase": "Phase 2 Complete",
        "files": ["src/code.ts"]
      },
      {
        "timestamp": "2026-01-06T01:49:26.300Z",
        "type": "verification",
        "message": "Phase 2 Complete â€” Checkbox square vs circle",
        "phase": "Phase 2 Complete",
        "files": ["src/code.ts"]
      },
      {
        "timestamp": "2026-01-06T01:49:26.300Z",
        "type": "verification",
        "message": "Phase 2 Complete â€” Dropdown requires icon",
        "phase": "Phase 2 Complete",
        "files": ["src/code.ts"]
      },
      {
        "timestamp": "2025-12-29T23:50:00Z",
        "type": "task_completed",
        "message": "Completed full engine wiring and rule implementation for MVP components. All Phase 3 rules (TF-01..TF-14, BL-01..BL-05, CB-01..CB-03, SC-01..SC-03) implemented and wired into Phase 4 orchestrator. Handoff UI state completed.",
        "phase": "phase4",
        "files": [
          "src/rules/textField.ts",
          "src/rules/button.ts",
          "src/rules/checkbox.ts",
          "src/rules/dropdown.ts",
          "src/code.ts",
          "ui/ui.html"
        ]
      },
      {
        "timestamp": "2025-12-29T23:45:00Z",
        "type": "bugfix",
        "message": "Fixed Classification Engine bias (everything identified as Button) and UI runtime crash (detailsList). Adjusted button detector weights, added penalties for textField signals, fixed detailsList scope issue in UI.",
        "phase": "phase4",
        "files": [
          "src/code.ts",
          "ui/ui.html"
        ]
      },
      {
        "timestamp": "2025-12-28T12:40:00Z",
        "type": "task_completed",
        "message": "Phase 4 Batch 4.1 & 4.2: Integrated rule checks into classifyComponent orchestrator",
        "phase": "phase4",
        "files": [
          "src/code.ts"
        ]
      },
      {
        "timestamp": "2025-12-28T12:35:00Z",
        "type": "task_completed",
        "message": "Phase 3 Batch 3.3 & 3.4: Created src/rules/button.ts, checkbox.ts, and dropdown.ts with all remaining rules",
        "phase": "phase3",
        "files": [
          "src/rules/button.ts",
          "src/rules/checkbox.ts",
          "src/rules/dropdown.ts"
        ]
      },
      {
        "timestamp": "2025-12-28T12:30:00Z",
        "type": "task_completed",
        "message": "Phase 3 Batch 3.1 & 3.2: Created src/rules/utils.ts and src/rules/textField.ts with TF-01..TF-14 checks",
        "phase": "phase3",
        "files": [
          "src/rules/utils.ts",
          "src/rules/textField.ts"
        ]
      },
      {
        "timestamp": "2025-12-28T12:25:00Z",
        "type": "task_completed",
        "message": "Batch 2.3: Created Product-Journey-Map.md with Block System analysis",
        "phase": "phase2",
        "files": [
          "docs/Product-Journey-Map.md"
        ]
      },
      {
        "timestamp": "2025-12-28T12:22:00Z",
        "type": "task_completed",
        "message": "Batch 2.1 & 2.2: Created context-dump.mjs and generate-xp-status.mjs",
        "phase": "phase2",
        "files": [
          "scripts/context-dump.mjs",
          "scripts/generate-xp-status.mjs",
          "CONTEXT_DUMP.txt",
          "xp-data.json"
        ]
      },
      {
        "timestamp": "2025-12-28T10:30:00Z",
        "type": "task_completed",
        "message": "Created EXECUTION_LOG.json structure",
        "phase": "phase2",
        "files": [
          "docs/EXECUTION_LOG.json"
        ]
      },
      {
        "timestamp": "2025-12-25T14:00:00Z",
        "type": "task_completed",
        "message": "Component detection engine with multi-signal scoring",
        "phase": "phase4",
        "files": [
          "src/code.ts"
        ]
      },
      {
        "timestamp": "2025-12-24T09:00:00Z",
        "type": "task_completed",
        "message": "Preview export + PREVIEW_READY protocol message",
        "phase": "phase4",
        "files": [
          "src/code.ts",
          "ui/ui.html"
        ]
      },
      {
        "timestamp": "2025-12-23T16:00:00Z",
        "type": "task_completed",
        "message": "verify-changelog script + commit gating",
        "phase": "phase2",
        "files": [
          "scripts/verify-changelog.cjs"
        ]
      }
    ],
    "reasoning": [
      {
        "timestamp": "2026-01-06T01:49:26.300Z",
        "action": "Phase 2 Complete â€” Architecture tasks updated",
        "why": "All core components standardized on NodeSignals. Architecture tasks completed with bounded traversal v1 and Fusion v1 (local-first AI skip).",
        "relatedFiles": ["src/code.ts"],
        "phase": "Phase 2 Complete"
      },
      {
        "timestamp": "2026-01-06T01:49:26.300Z",
        "action": "Phase 2 Complete â€” Architecture tasks updated",
        "why": "All core components standardized on NodeSignals. Architecture tasks completed with bounded traversal v1 and Fusion v1 (local-first AI skip).",
        "relatedFiles": ["src/code.ts"],
        "phase": "Phase 2 Complete"
      },
      {
        "timestamp": "2025-12-28T10:30:00Z",
        "action": "Created EXECUTION_LOG.json",
        "why": "Need single source of truth for task status, decisions, and blockers. Enables dashboard to show real-time project state.",
        "relatedFiles": [
          "docs/EXECUTION_LOG.json"
        ],
        "phase": "phase2"
      },
      {
        "timestamp": "2025-12-25T14:00:00Z",
        "action": "Implemented multi-signal component detection",
        "why": "Need reliable component type identification using structure, layout, and semantic signals. Strict gate (0.85 confidence + 0.35 structural) ensures quality.",
        "relatedFiles": [
          "src/code.ts"
        ],
        "phase": "phase4"
      }
    ]
  },
  "gitStatus": {
    "branch": "main",
    "workingTree": "dirty",
    "modifiedFiles": [
      ".tmp-xp-map",
      "CONTEXT_DUMP.txt",
      "FILES_TREE.md",
      "PROJECT_TREE.md",
      "dashboard-sync/dashboard-sync.json",
      "dashboard/data.json",
      "docs/GIT_STATUS.json",
      "docs/mvp-rule-pack-LOCKED-local.docx",
      "docs/mvp-rule-pack-LOCKED-local.docx.backup",
      "docs/mvp-rule-pack-LOCKED.docx",
      "package.json",
      "src/code.ts",
      "src/ui-inline.ts",
      "ui/ui.html",
      ".tmp.driveupload/",
      "FULL_CODEBASE.txt",
      "Users/",
      "docs/mvp-rule-pack-LOCKED.docx.backup",
      "dump_project.py"
    ],
    "ahead": 0,
    "behind": 0,
    "lastCommit": "2025-12-29 00:37:38 +0200",
    "lastPush": "2025-12-29 00:37:38 +0200",
    "timestamp": "2025-12-29T23:33:47.892Z"
  },
  "progress": {
    "masterPlan": {
      "total": 3,
      "completed": 0,
      "percentage": 0
    },
    "rules": {
      "total": 26,
      "implemented": 25,
      "percentage": 0.9615384615384616
    }
  },
  "recent": [
    {
      "date": "2025-12-25",
      "items": [
        "Component detection engine with multi-signal scoring (structure + layout + semantic), strict gate (confidence >= 0.85 AND structural >= 0.35), auto-resolve parent tree climbing (up to 3 levels)"
      ]
    },
    {
      "date": "2025-12-24",
      "items": [
        "Preview export (natural size, transparent background) + PREVIEW_READY protocol message"
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Added `scripts/verify-changelog.cjs` and npm scripts to gate commits on CHANGELOG updates when code changes."
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Quarantined legacy sources (`src/accessibility.ts`, `src/tool-library.ts`) to `quarantine/legacy-2025-12-23/` since the runtime now uses inlined equivalents."
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Removed stray `.DS_Store` files and ignored them via `.gitignore`."
      ]
    },
    {
      "date": "2025-12-23",
      "items": [
        "Documented the current architecture and entry points in `ARCHITECTURE.md`."
      ]
    }
  ],
  "uiMap": "# UI State Machine\n\n**Last Updated**: 2025-12-28  \n**Purpose**: Document UI state machine and transitions\n\n---\n\n## States\n\n### IDLE\n- **Description**: No selection, empty state\n- **UI**: Empty preview area (no placeholder text or box)\n- **Actions**: User selects a node in Figma\n\n### IDENTIFYING\n- **Description**: Scanning/vision classification in progress\n- **UI**: Shows \"AI scanning selection...\" or \"Detecting component type...\"\n- **Actions**: Auto-transitions based on classification result\n\n### NEEDS_CONFIRMATION\n- **Description**: Classification confidence below gate (0.90), requires user confirmation\n- **UI**: Shows chips (sorted by confidence) + manual input + \"Start over\"\n- **Actions**: User selects component type or enters custom name\n\n### IDENTIFIED\n- **Description**: Component type confirmed (either auto-passed or user-selected)\n- **UI**: Shows component type chip, \"Correct\" button, intent display\n- **Actions**: User can click \"Correct\" to change type, or proceed to scan\n\n### PLAN_READY\n- **Description**: Scan complete, plan shown with Designer Changes + Developer Handoff\n- **UI**: Shows \"Designer Changes\" and \"Developer Handoff\" sections, \"Accessible it\" button\n- **Actions**: User can review plan, apply fixes, or export handoff\n\n### EXECUTING\n- **Description**: Applying autofixes in progress\n- **UI**: Shows progress indicator\n- **Actions**: Auto-transitions to DONE when complete\n\n### DONE\n- **Description**: All fixes applied, handoff ready\n- **UI**: Shows completion message, export options\n- **Actions**: User can export handoff or start over\n\n---\n\n## Transitions\n\n```\nIDLE â†’ IDENTIFYING\n  Trigger: User selects node + clicks \"Accessible it\"\n  \nIDENTIFYING â†’ NEEDS_CONFIRMATION\n  Trigger: Classification confidence < 0.90 OR gate fails\n  \nIDENTIFYING â†’ IDENTIFIED\n  Trigger: Classification confidence >= 0.90 AND gate passes\n  \nNEEDS_CONFIRMATION â†’ IDENTIFIED\n  Trigger: User selects component type (chip or manual input)\n  \nIDENTIFIED â†’ PLAN_READY\n  Trigger: Scan complete, plan generated\n  \nPLAN_READY â†’ EXECUTING\n  Trigger: User clicks \"Accessible it\" (apply fixes)\n  \nEXECUTING â†’ DONE\n  Trigger: All fixes applied\n  \nAny state â†’ IDLE\n  Trigger: Selection cleared (nodes = 0)\n```\n\n---\n\n## State Variables\n\n### selectionState\n- `none`: No selection\n- `hasSelection`: Node selected\n\n### classifyState\n- `idle`: Not classifying\n- `processing`: Classification in progress\n- `done`: Classification complete\n\n### certaintyState\n- `certain`: Confidence >= 0.90, gate passed\n- `uncertain`: Confidence < 0.90 or gate failed\n\n### reasoningState\n- `collapsed`: Reasoning panel hidden\n- `expanded`: Reasoning panel visible\n\n---\n\n## UI Components by State\n\n### IDLE\n- Empty preview area (no placeholder UI)\n- No preview image\n- No actions\n\n### IDENTIFYING\n- Preview (immutable, from selection)\n- Status text: \"AI scanning selection...\"\n- Loading indicator (optional)\n\n### NEEDS_CONFIRMATION\n- Preview (immutable)\n- Component type chips (sorted by confidence)\n- Manual input field\n- \"Start over\" button\n\n### IDENTIFIED\n- Preview (immutable, from selection only)\n- Component type chip\n- \"Correct\" button\n- Intent display\n- \"Show Reasoning\" toggle\n- \"Accessible it\" button (only after classification confirmed)\n\n### PLAN_READY\n- Preview (collapsed to header thumbnail)\n- \"Designer Changes\" section\n- \"Developer Handoff\" section\n- \"Accessible it\" button\n\n### EXECUTING\n- Progress indicator\n- Status text: \"Applying fixes...\"\n\n### DONE\n- Completion message\n- Export options\n- \"Start over\" button\n\n---\n\n## Notes\n\n- **Preview Immutability**: Preview image only changes when selection changes, not when classification certainty changes\n- **Single UI Shell**: All states use the same layout structure. Uncertainty adds suggestions section, doesn't replace entire UI\n- **State Reset**: When selection cleared, all states reset to IDLE, preview cleared\n- **No Placeholder UI**: Empty state shows empty preview area, no \"Select a node\" message or gray box\n- **One Accessible it Button**: Only one \"Accessible it\" button exists, shown only after classification confirmed\n- **No Annotate Button**: Annotate functionality removed per Figma design\n- **Layer Icons**: Node type icons loaded from `src/assets/layers icons/` based on Figma node type\n- **Data Attributes**: `data-node-id` exists only as HTML attributes, never as visible text\n\n",
  "projectPlan": "# NotebookLM Onboarding - Design-Time Accessibility Plugin\n\n**Purpose**: This document serves as the single onboarding source for NotebookLM (\"Noty\") to understand and navigate the Figma Design-Time Accessibility Plugin project.\n\n**Last Updated**: 2024-12-19  \n**Source of Truth**: `docs/02-project/Project-plan.md` (master plan)\n\n---\n\n## 1. Project in One Page\n\n### Goal\nBuild a Figma plugin that identifies components during design-time, runs accessibility checks, suggests safe fixes, and generates developer handoff. **Shift-left accessibility** - catch issues before code is written.\n\n### MVP Scope\n**Components**: Text Field, Button, Checkbox, Dropdown/Select only  \n**Severity**: WARN only (no FAIL/BLOCKER)  \n**Output**: Design guidance + UX patterns + Code snippets (HTML/ARIA)\n\n### Core Principle\n**AI Visual First (default)**: Vision classification is the primary method. Local tree-based analysis is fallback when AI unavailable or uncertain.\n\n### Locked Decisions\n- **AI Visual First**: Vision default, signals backup\n- **Confidence Gate**: 0.90 threshold for PASS (strict)\n- **Severity Policy**: PASS/ASK/WARN only (no FAIL)\n- **UI Shell**: Static layout, uncertainty adds suggestions only (no layout change)\n- **Output Schema**: Unified JSON contract for classifier/orchestrator\n\n---\n\n## 2. Current Status Snapshot\n\n### What's Implemented\n\n#### UI (`ui/ui.html`)\n- âœ… **Single UI Shell**: State machine with `selectionState`, `classifyState`, `certaintyState`, `reasoningState`\n- âœ… **Header Row**: Node icon, name, preview thumbnail\n- âœ… **Identification Card**: Component type chip, \"Correct\" button, intent display\n- âœ… **Reasoning Panel**: Collapsible, shows \"Why {componentType}\" and \"Why Intent\"\n- âœ… **Correction Flow**: Chips (sorted by confidence) + manual input + \"Start over\"\n- âœ… **Preview**: Natural size export, zoom (100-500%), panning, theme toggle (preview bg only)\n- âœ… **Asset Loading**: All icons embedded as inline SVG\n- âœ… **State Reset**: Clears preview when no selection\n\n#### Engine (`src/code.ts`)\n- âœ… **Multi-Component Orchestrator**: `classifyComponent()` runs detectors for TextField, Button, Checkbox, Dropdown\n- âœ… **AI Vision Integration**: `classifyFromImageVision()` using OpenAI GPT-4o (if API key provided)\n- âœ… **Local Classifiers**: Tree-based detectors with structure/layout/semantic scoring\n- âœ… **Design System Context**: `detectDesignSystemContext()` reads file/page names, applies bias rules\n- âœ… **Hard-Gating**: DS context excludes incompatible component types (e.g., checkbox on \"buttons\" page)\n- âœ… **Auto-Resolve**: Climbs parent tree (up to 3 levels) if initial classification fails\n- âœ… **Decision Fusion**: AI Vision (if `confidence >= 0.80`) else local classifier\n- âœ… **Confidence Gate**: 0.90 threshold for PASS (strict)\n- âœ… **Session Persistence**: Stores chosen component type per nodeId\n\n#### Routing (`src/protocol.ts`)\n- âœ… **Message Types**: `VISION_CLASSIFY_REQUEST`, `VISION_CLASSIFY_RESULT`, `CLASSIFICATION_UPDATED`\n- âœ… **Schema**: `VisionClassifyResultMessage` with `componentType`, `componentTypeConfidence`, `intent`, `intentConfidence`, `reasoning[]`, `gate`, `method`\n- âœ… **User Actions**: `USER_SET_COMPONENT_TYPE`, `USER_SET_COMPONENT_NAME`, `USER_RESTART`\n\n### What's NOT Implemented (MVP Gaps)\n\n#### Missing Features\n- âŒ **Scan Rules**: TF-01..TF-14 checks not implemented (placeholder only)\n- âŒ **Autofix Engine**: Safe autofix (layer renaming, focus states, annotations) not implemented\n- âŒ **Handoff Generator**: Design/UX/Code output not implemented\n- âŒ **ASK Flow Full**: Partial (component type confirmation works, but scan-level ASK not implemented)\n\n#### Known Limitations\n- AI Vision requires OpenAI API key in `figma.clientStorage` (falls back to local if missing)\n- Checkbox and Dropdown detectors are basic (need refinement)\n- No streaming scan results (all-at-once only)\n\n---\n\n## 3. Architecture Map\n\n### Folder Structure\n\n```\nFigma plugin/\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ code.ts              # Main thread (Figma API, classification, message handling)\nâ”‚   â”œâ”€â”€ protocol.ts          # Message types and guards (UI â†” Main contract)\nâ”‚   â””â”€â”€ assets/\nâ”‚       â”œâ”€â”€ ui/              # UI icons (logo, buttons, chevron, etc.)\nâ”‚       â””â”€â”€ layers icons/    # Figma node type icons (frame, component, text, etc.)\nâ”œâ”€â”€ ui/\nâ”‚   â””â”€â”€ ui.html              # UI thread (HTML/CSS/JS, state machine, rendering)\nâ”œâ”€â”€ dist/                    # Build output (generated)\nâ”‚   â”œâ”€â”€ src/code.js          # Compiled main thread\nâ”‚   â”œâ”€â”€ ui.html              # Inline HTML (via build-ui.cjs)\nâ”‚   â””â”€â”€ assets/              # Copied assets\nâ”œâ”€â”€ docs/\nâ”‚   â”œâ”€â”€ 01-foundations/      # Source of truth: foundations-engine-logic.docx\nâ”‚   â”œâ”€â”€ 02-project/         # Project plan, test scenarios, this doc\nâ”‚   â”œâ”€â”€ 03-components/      # Source of truth: mvp-rule-pack.docx\nâ”‚   â””â”€â”€ 04-research/         # Supporting docs (classifier research, runtime catalog)\nâ””â”€â”€ scripts/\n    â””â”€â”€ build-ui.cjs         # Build script (copies ui.html, generates ui-inline.ts)\n```\n\n### Entry Points\n\n- **Main Thread**: `src/code.ts` â†’ compiled to `dist/src/code.js` (loaded by Figma)\n- **UI Thread**: `ui/ui.html` â†’ copied to `dist/ui.html` (loaded by `figma.showUI()`)\n- **Build**: `npm run build` â†’ runs `build-ui` + `build-main` + `typecheck`\n\n### Runtime Flow\n\n```\n1. User selects node in Figma\n   â†“\n2. Main thread: handleSelectionChange()\n   â†’ Export PNG preview (natural size, transparent)\n   â†’ Send SELECTION_PREVIEW_READY to UI\n   â†“\n3. UI: renderShell() updates preview, shows identification card\n   â†“\n4. User clicks \"Accessible it\"\n   â†“\n5. UI: sends ACCESSIBLE_IT_RUN\n   â†“\n6. Main: handleAccessibilityRun()\n   â†’ Export preview (if not already)\n   â†’ Send PREVIEW_READY\n   â†“\n7. UI: sends VISION_CLASSIFY_REQUEST\n   â†“\n8. Main: handleVisionClassify()\n   â†’ detectDesignSystemContext()\n   â†’ classifyFromImageVision() [if ENABLE_AI_VISION && API key]\n   â†’ classifyComponent() [orchestrator: runs all detectors]\n   â†’ Decision fusion (AI vs local)\n   â†’ Auto-resolve (if FAIL, climb parent tree)\n   â†’ Send VISION_CLASSIFY_RESULT\n   â†“\n9. UI: handleVisionClassifyResult()\n   â†’ If gate PASS: show Summary Mode, emit ASK_START\n   â†’ If gate FAIL: show Chat Mode (suggestions), wait for user\n   â†“\n10. User confirms/overrides component type\n    â†“\n11. Main: handleUserSetComponentType()\n    â†’ Update finalComponentType\n    â†’ Send CLASSIFICATION_UPDATED\n    â†“\n12. UI: handleClassificationUpdated()\n    â†’ Update reasoning to match finalComponentType\n    â†’ Switch to Summary Mode\n    â†’ Show \"Accessible it\" button\n```\n\n### Key Functions\n\n**Main Thread (`src/code.ts`)**:\n- `classifyComponent(node, dsContext)`: Orchestrator - runs all detectors, applies context bias, selects best candidate\n- `classifyTextFieldFromNodeTree(node)`: Text Field detector (structure + layout + semantic scoring)\n- `classifyButtonFromNodeTree(node)`: Button detector\n- `classifyCheckboxFromNodeTree(node)`: Checkbox detector (with negative gates)\n- `classifyFromImageVision(bytesBase64, nodeContext, dsContext)`: AI Vision classifier\n- `detectDesignSystemContext()`: Reads file/page names, returns `{ isDS, pageDomain, reasons }`\n- `handleVisionClassify()`: Main classification handler (AI + local fusion)\n\n**UI Thread (`ui/ui.html`)**:\n- `renderShell()`: Single UI shell renderer (manages all states)\n- `handleVisionClassifyResult()`: Updates UI based on classification result\n- `handleClassificationUpdated()`: Updates UI after user override\n\n---\n\n## 4. State Machine & UI Shell Rule\n\n### State Machine\n\nThe UI uses a single state machine (no \"two screens\"):\n\n```typescript\nconst state = {\n  // Selection state\n  selectionState: \"none\" | \"hasSelection\",\n  selectedNode: SceneNode | null,\n  selectionFingerprint: string | null,\n\n  // Classification state\n  classifyState: \"idle\" | \"processing\" | \"done\",\n\n  // Certainty state\n  certaintyState: \"certain\" | \"uncertain\",\n\n  // Reasoning state\n  reasoningState: \"collapsed\" | \"expanded\",\n\n  // Component type (separate suggested vs final)\n  suggestedComponentType: string | null,\n  finalComponentType: string | null, // After user override\n};\n```\n\n### UI Shell Rule\n\n**Always the same layout**:\n- Top bar (header with logo, buttons)\n- Identification card (component name, preview, type chip)\n- Validation section (intent, confidence)\n- Details section (reasoning toggle + panel)\n- Actions (Accessible it, Annotate buttons)\n\n**Uncertainty behavior**:\n- If `certaintyState === \"uncertain\"`: Add \"Suggestions / Correction Flow\" section at bottom\n- Do NOT replace entire screen with chat\n- Do NOT hide Summary Mode\n- Suggestions section contains: chips (sorted by confidence) + manual input + \"Start over\"\n\n**Reasoning correctness**:\n- Always use `finalComponentType` (after user override) for reasoning title/content\n- Never show \"Why Button\" if user selected \"Text Field\"\n\n---\n\n## 5. Classifier/Engine Output Contract\n\n### JSON Schema\n\n**`VISION_CLASSIFY_RESULT` message**:\n\n```typescript\n{\n  type: \"VISION_CLASSIFY_RESULT\",\n  nodeId: string,\n  suggestedComponentType: \"textField\" | \"dropdown\" | \"button\" | \"checkbox\" | \"unknown\",\n  componentTypeConfidence: number, // 0..1\n  intent?: \"password\" | \"email\" | \"phone\" | \"search\" | \"name\" | \"address\" | \"zip\" | \"url\" | \"username\" | \"description\" | \"other\" | \"unknown\",\n  intentConfidence?: number, // 0..1\n  suggestedLabel?: string,\n  reasoning: string[], // Bullet strings for \"Why {componentType}\"\n  intentReasoning?: string[], // Bullet strings for \"Why Intent\"\n  gate: \"PASS\" | \"FAIL\",\n  thresholds: { pass: number }, // Echo threshold used (0.90)\n  method?: \"local\" | \"ai_vision\" | \"fallback\",\n  nodeName?: string,\n  reasoningDataContext?: string, // File/page context\n}\n```\n\n### Gate Rules\n\n**PASS** (auto-proceed):\n- `componentTypeConfidence >= 0.90` AND\n- `componentType !== \"unknown\"` AND\n- (For Text Field) `structureScore >= 0.35`\n\n**FAIL** (ask user):\n- `componentTypeConfidence < 0.90` OR\n- `componentType === \"unknown\"` OR\n- (For Text Field) `structureScore < 0.35`\n\n### Decision Fusion Logic\n\n1. **AI Vision** (if enabled and API key available):\n   - Call `classifyFromImageVision()`\n   - If `componentType !== \"unknown\"` AND `componentTypeConfidence >= 0.80` â†’ use AI\n   - If AI intent: `intentConfidence >= 0.75` â†’ use AI intent\n\n2. **Local Classifier** (fallback or if AI fails):\n   - Call `classifyComponent()` (orchestrator)\n   - Runs all detectors, applies context bias, selects best candidate\n   - Returns `componentType`, `confidence`, `reasoning[]`\n\n3. **Auto-Resolve** (if FAIL):\n   - Climb parent tree (up to 3 levels)\n   - Re-run classification on parent\n   - If parent PASS â†’ return parent result with \"Auto-resolved\" in reasoning\n\n### Example Outputs\n\n**PASS Example**:\n```json\n{\n  \"type\": \"VISION_CLASSIFY_RESULT\",\n  \"nodeId\": \"123:456\",\n  \"suggestedComponentType\": \"textField\",\n  \"componentTypeConfidence\": 0.92,\n  \"intent\": \"search\",\n  \"intentConfidence\": 0.78,\n  \"reasoning\": [\n    \"Container with visible fill/stroke\",\n    \"Text node inside container bounds\",\n    \"Left padding >= 8px\",\n    \"Single-line text structure\"\n  ],\n  \"intentReasoning\": [\n    \"Search icon detected\",\n    \"Nearby text: '×—×™×¤×•×©'\"\n  ],\n  \"gate\": \"PASS\",\n  \"thresholds\": { \"pass\": 0.90 },\n  \"method\": \"ai_vision\",\n  \"nodeName\": \"Search Input\"\n}\n```\n\n**FAIL Example**:\n```json\n{\n  \"type\": \"VISION_CLASSIFY_RESULT\",\n  \"nodeId\": \"123:456\",\n  \"suggestedComponentType\": \"unknown\",\n  \"componentTypeConfidence\": 0.65,\n  \"reasoning\": [\n    \"Ambiguous structure\",\n    \"No clear input container pattern\"\n  ],\n  \"gate\": \"FAIL\",\n  \"thresholds\": { \"pass\": 0.90 },\n  \"method\": \"local\",\n  \"nodeName\": \"Component 1\"\n}\n```\n\n---\n\n## 6. How to Run / Build / Deploy\n\n### Build\n\n```bash\nnpm run build\n```\n\nThis runs:\n1. `build-ui`: Copies `ui/ui.html` to `dist/ui.html`, generates `src/ui-inline.ts`\n2. `build-main`: Compiles `src/code.ts` to `dist/src/code.js` (esbuild)\n3. `typecheck`: TypeScript type checking (no emit)\n\n### Development\n\n```bash\n# Watch UI changes\nnpm run dev:ui\n\n# Build only\nnpm run build-ui\nnpm run build-main\n```\n\n### Testing in Figma\n\n1. Open Figma Desktop\n2. Plugins â†’ Development â†’ Import plugin from manifest\n3. Select `manifest.json` from project root\n4. Plugin appears in Plugins menu\n5. Run plugin, select a node, click \"Accessible it\"\n\n### Deployment\n\n**Not yet implemented** - MVP is local development only.\n\n**Future**: Deploy to Figma Community (requires plugin approval process).\n\n---\n\n## 7. Definition of Done Summary\n\n**Source**: `Definition_Of_Done.md`\n\n### Build & Runtime\n- âœ… `npm run build` completes successfully\n- âœ… Plugin loads in Figma Desktop without errors\n- âœ… No unsupported JavaScript features in compiled output\n- âœ… `figma.showUI` receives valid HTML\n\n### MVP: Text Field E2E (Current Focus)\n\n**Selection â†’ Preview**:\n- âœ… Preview exports as PNG at natural size (no upscale)\n- âœ… Transparent background\n- âœ… Preview renders correctly in UI\n\n**Component Detection**:\n- âœ… Multi-signal classification runs\n- âœ… Confidence gate: `confidence >= 0.90 AND structureScore >= 0.35`\n- âœ… Auto-resolve: climb parent tree up to 3 levels if FAIL\n- âœ… Returns `componentType: \"textField\"` or `\"unknown\"`\n\n**ASK Flow**:\n- âœ… If PASS: auto-filled, user can review/adjust\n- âœ… If FAIL: manual chips + input\n- âœ… `ASK_START` message sent with `source: \"auto\"` or `\"manual\"`\n\n**Scan Rules** (TF-01..TF-14):\n- âŒ **NOT IMPLEMENTED** - Placeholder only\n\n**Autofix**:\n- âŒ **NOT IMPLEMENTED** - Placeholder only\n\n**Handoff**:\n- âŒ **NOT IMPLEMENTED** - Placeholder only\n\n### Error Handling\n- âœ… Runtime errors surfaced to UI\n- âœ… User always gets feedback\n- âœ… No silent failures\n\n### UI Accessibility\n- âœ… Status updates via `aria-live`\n- âœ… Icon-only buttons have accessible names\n- âœ… Keyboard navigation works\n\n### Designer Experience\n- âœ… Plugin doesn't modify layout unexpectedly\n- âœ… Risky fixes are suggestions only\n- âœ… User understands what changed and why\n\n---\n\n## 8. Open TODOs (Finish MVP)\n\n### Critical (Block MVP Completion)\n\n1. **Scan Rules Implementation** (`src/code.ts`)\n   - Implement TF-01..TF-14 checks for Text Field\n   - All checks return WARN (no FAIL)\n   - Stream results to UI (`SCAN_PROGRESS` messages)\n   - Reference: `docs/03-components/mvp-rule-pack.docx`\n\n2. **Autofix Engine v1** (`src/code.ts`)\n   - Safe autofix (default ON):\n     - Rename layers (Input / Label / Helper / Icon / Container)\n     - Enforce min font sizes (body min 14, headings/labels 16) - WARN + suggestion only\n     - Create Focus state variant when missing\n     - Add annotation metadata (plugin data)\n   - Reference: `docs/01-foundations/foundations-engine-logic.docx`\n\n3. **Handoff Generator** (`src/code.ts`)\n   - Design guidance (what to change in design)\n   - UX patterns (states, focus, error patterns)\n   - Code snippets (HTML/ARIA)\n   - Reference: `docs/03-components/mvp-rule-pack.docx`\n\n4. **ASK Flow Completion** (`src/code.ts`, `ui/ui.html`)\n   - Scan-level ASK (not just component type)\n   - Template-based questions\n   - User responses stored and applied\n\n### High Priority (Before Launch)\n\n5. **Button/Checkbox/Dropdown Detectors Refinement**\n   - Improve confidence scoring\n   - Add negative gates (like checkbox has)\n   - Test on Design System pages\n\n6. **Test Scenarios Execution**\n   - Run all tests in `docs/02-project/test-scenarios.md`\n   - Document results\n   - Fix any failures\n\n7. **UI Polish**\n   - Preview zoom/pan bounds clamping (408x408)\n   - Theme toggle persistence\n   - Animation smoothness\n\n### Medium Priority (Post-MVP)\n\n8. **Post-MVP Components**\n   - Radio, Toggle/Switch, Link, Icon Button, Textarea, Search, Password, Date picker, Modal/Dialog, Toast/Alert\n   - Reference: `docs/02-project/Project-plan.md` section 10.2\n\n9. **Deployment**\n   - Figma Community submission\n   - Plugin store listing\n   - Documentation site\n\n---\n\n## 9. Key Documents Reference\n\n### Source of Truth (Locked)\n- `docs/01-foundations/foundations-engine-logic.docx`: Engine logic, AI Visual First, gates, schema\n- `docs/03-components/mvp-rule-pack.docx`: MVP component rules, checks, autofix boundaries, handoff\n\n### Master Plan\n- `docs/02-project/Project-plan.md`: Complete project plan, locked decisions, workstreams\n\n### Supporting Docs\n- `docs/02-project/test-scenarios.md`: Acceptance tests (15 test cases)\n- `docs/04-research/classifier-orchestrator-research.md`: Classifier architecture details\n- `docs/04-research/Runtime Accessibility Intent Catalog.md`: Runtime intents (filtered to MVP)\n- `docs/04-research/Design-Time Signals â€“ Raw Extraction.md`: Signal extraction details\n\n### Code\n- `src/code.ts`: Main thread (classification, message handling)\n- `src/protocol.ts`: Message types and guards\n- `ui/ui.html`: UI thread (state machine, rendering)\n\n---\n\n## 10. Quick Reference: Locked Decisions\n\n| Decision | Value | Source |\n|----------|-------|--------|\n| AI Visual First | Default ON | Project-plan.md Â§5.1 |\n| Confidence Gate | 0.90 (strict) | Project-plan.md Â§5.3 |\n| Severity Policy | PASS/ASK/WARN only (no FAIL) | Project-plan.md Â§7 |\n| UI Shell | Static layout, uncertainty adds suggestions | Project-plan.md Â§10.4.1 |\n| Output Schema | Unified JSON contract | Project-plan.md Â§11.1 |\n| MVP Components | Text Field, Button, Checkbox, Dropdown | Project-plan.md Â§10.1 |\n\n---\n\n## 11. Common Questions\n\n**Q: Why is AI Vision default ON but sometimes uses local classifier?**  \nA: AI Vision requires OpenAI API key. If missing or API call fails, falls back to local classifier automatically.\n\n**Q: What's the difference between `suggestedComponentType` and `finalComponentType`?**  \nA: `suggestedComponentType` is what the classifier detected. `finalComponentType` is after user override (if any). Reasoning always uses `finalComponentType`.\n\n**Q: Why does DS context exclude certain component types?**  \nA: Design System pages have strong context signals. A \"Buttons\" page should never classify as Checkbox, even with weak icon signals. Hard-gating prevents misclassification.\n\n**Q: What happens if classification fails on selected node?**  \nA: Auto-resolve climbs parent tree (up to 3 levels) and re-runs classification. If parent passes gate, returns parent result with \"Auto-resolved\" in reasoning.\n\n**Q: How do I add a new component type?**  \nA: 1) Add detector function (e.g., `classifyRadioFromNodeTree()`), 2) Add to orchestrator in `classifyComponent()`, 3) Update protocol types, 4) Add to MVP rule pack.\n\n---\n\n## Immediate Execution Phase\n\n- [ ] Create Logic Rules for Text Field (TF-01 to TF-14).\n- [ ] Create Logic Rules for Button (BL-01 to BL-05).\n- [ ] Hook Logic into Orchestrator (src/code.ts).\n",
  "currentStatus": "# Current Rules Status\n\n**Last Updated**: 2025-12-29  \n**Purpose**: Track which rules are implemented vs pending\n\n---\n\n## Text Field Rules\n\n- TF-01: Type Detection âœ… Implemented\n- TF-02: Field Label âœ… Implemented\n- TF-03: Field Required âœ… Implemented\n- TF-04: Field Validation Focus âœ… Implemented\n- TF-05: Field Validations âœ… Implemented\n- TF-06: Field Context âœ… Implemented\n- TF-07: Field Placeholder âœ… Implemented\n- TF-08: Field Error Messages âœ… Implemented\n- TF-09: Field Help Text âœ… Implemented\n- TF-10: Field Keyboard Navigation âœ… Implemented\n- TF-11: Field Auto-complete âœ… Implemented\n- TF-12: Field Input Types âœ… Implemented\n- TF-13: Field Size Constraints âœ… Implemented\n- TF-14: Field Color Contrast âœ… Implemented\n\n**Total**: 14/14 implemented (100%)\n\n---\n\n## Button Rules\n\n- BL-01: Button Roles âœ… Implemented\n- BL-02: Button Labeling âœ… Implemented\n- BL-03: Button States âœ… Implemented\n- BL-04: Button Keyboard Navigation âœ… Implemented\n- BL-05: Button Focus Indicators âœ… Implemented\n\n**Total**: 5/5 implemented (100%)\n\n---\n\n## Checkbox Rules\n\n- CB-01: Checkbox Roles âœ… Implemented\n- CB-02: Checkbox Labeling âœ… Implemented\n- CB-03: Checkbox States âœ… Implemented\n\n**Total**: 3/3 implemented (100%)\n\n---\n\n## Select/Dropdown Rules\n\n- SC-01: Select Roles âœ… Implemented\n- SC-02: Select Labeling âœ… Implemented\n- SC-03: Select Keyboard Navigation âœ… Implemented\n\n**Total**: 3/3 implemented (100%)\n\n---\n\n## Overall Status\n\n**Total Rules**: 25  \n**Implemented**: 25  \n**Pending**: 0  \n**Coverage**: 100%\n\n---\n\n## Notes\n\n- All MVP rules (TF-01..TF-14, BL-01..BL-05, CB-01..CB-03, SC-01..SC-03) are fully implemented in `src/rules/`\n- Rules are wired into the orchestrator in `src/code.ts` via `classifyComponent`\n- All rules return WARN/ASK only (no FAIL/BLOCKER per MVP policy)\n- Evidence: `src/rules/textField.ts`, `src/rules/button.ts`, `src/rules/checkbox.ts`, `src/rules/dropdown.ts`\n",
  "truth": {
    "note": "Source of truth: Foundations + MVP rule pack. ×©××¨ ×”××¡××›×™× ×ª×•××›×™× ×‘×œ×‘×“.",
    "docs": [
      {
        "label": "Foundations â€“ engine logic",
        "path": "docs/foundations-engine-logic-LOCKED.docx"
      },
      {
        "label": "MVP rule pack",
        "path": "docs/mvp-rule-pack-LOCKED.docx"
      }
    ]
  },
  "pipeline": [
    {
      "id": "select",
      "title": "×‘×—×™×¨×”",
      "detail": "×”××¢×¦×‘ ×‘×•×—×¨ × ×•×“ ×‘-Figma"
    },
    {
      "id": "preview",
      "title": "×ª×¦×•×’×” ××§×“×™××”",
      "detail": "PNG ×‘×’×•×“×œ ×˜×‘×¢×™ ×¢× ×¨×§×¢ ×©×§×•×£"
    },
    {
      "id": "type",
      "title": "×–×™×”×•×™ ×¡×•×’ ×§×•××¤×•× × ×˜×”",
      "detail": "×—×•×§×™× ××§×•××™×™× ×¢× Gate ×§×©×™×—"
    },
    {
      "id": "intent",
      "title": "Intent/Label",
      "detail": "×‘×¨×™×¨×ª ××—×“×œ: Unknown. Auto-resolve ×¢×“ 3 ×”×•×¨×™×"
    },
    {
      "id": "checks",
      "title": "×‘×“×™×§×•×ª",
      "detail": "TF-01â€¦TF-14 (WARN ×‘×œ×‘×“ ×‘-MVP)"
    },
    {
      "id": "fix",
      "title": "××•×˜×•-×¤×™×§×¡",
      "detail": "×¨×§ Safe autofixes ×œ×¤×™ ×§×¨×™×˜×¨×™×•× ×™×"
    },
    {
      "id": "handoff",
      "title": "Handoff",
      "detail": "×¤×œ×˜ ××•×‘× ×” ×œ×“×™×–×™×™×Ÿ + Dev"
    }
  ],
  "gates": {
    "local": {
      "confidence": 0.85,
      "structural": 0.35
    },
    "vision": {
      "enabledByDefault": false,
      "role": "Boost + sanity check (×œ× dependency)"
    }
  },
  "build": {
    "command": "npm run build",
    "artifacts": [
      {
        "path": "dist/src/code.js",
        "note": "Main plugin bundle"
      },
      {
        "path": "dist/ui.html",
        "note": "UI bundle"
      },
      {
        "path": "src/ui-inline.ts",
        "note": "Generated â€“ ×œ× ×œ×¢×¨×•×š"
      }
    ]
  },
  "storage": [
    {
      "key": "aims.log",
      "type": "Array<JobLog>",
      "purpose": "×”×™×¡×˜×•×¨×™×™×ª ×”×¨×¦×•×ª (UNDO)"
    },
    {
      "key": "ams-settings",
      "type": "Settings",
      "purpose": "×”×¢×“×¤×•×ª ××©×ª××© (provider/model/keys)"
    },
    {
      "key": "OPENAI_API_KEY",
      "type": "string",
      "purpose": "××¤×ª×— AI Vision"
    }
  ],
  "files": {
    "mustEdit": [
      {
        "path": "src/code.ts",
        "why": "×œ×•×’×™×§×”: orchestrator + detectors + gates"
      },
      {
        "path": "ui/ui.html",
        "why": "UI + state machine"
      },
      {
        "path": "src/protocol.ts",
        "why": "×¤×¨×•×˜×•×§×•×œ ×”×•×“×¢×•×ª"
      }
    ],
    "dontEdit": [
      {
        "path": "src/ui-inline.ts",
        "why": "Generated"
      },
      {
        "path": "dist/*",
        "why": "Build output"
      }
    ]
  },
  "projectTree": {
    "groups": [
      {
        "title": "Must-edit (MVP)",
        "nodes": [
          {
            "path": "src/code.ts",
            "tags": [
              "logic",
              "orchestrator",
              "detectors"
            ]
          },
          {
            "path": "ui/ui.html",
            "tags": [
              "ui",
              "state-machine"
            ]
          },
          {
            "path": "src/protocol.ts",
            "tags": [
              "protocol"
            ]
          }
        ]
      },
      {
        "title": "Generated (do not edit)",
        "nodes": [
          {
            "path": "src/ui-inline.ts",
            "tags": [
              "generated"
            ]
          },
          {
            "path": "dist/src/code.js",
            "tags": [
              "compiled"
            ]
          },
          {
            "path": "dist/ui.html",
            "tags": [
              "copied"
            ]
          }
        ]
      },
      {
        "title": "Docs",
        "nodes": [
          {
            "path": "docs/foundations-engine-logic-LOCKED.docx",
            "tags": [
              "authoritative"
            ]
          },
          {
            "path": "docs/mvp-rule-pack-LOCKED.docx",
            "tags": [
              "authoritative"
            ]
          },
          {
            "path": "README.md",
            "tags": [
              "supporting"
            ]
          },
          {
            "path": "ARCHITECTURE.md",
            "tags": [
              "supporting"
            ]
          }
        ]
      }
    ]
  },
  "ideas": {
    "src/code.ts": [
      "DS-context hard block: ×‘×¢××•×“ Buttons ×œ× ×œ×¡×•×•×’ ×›-Text Field ×‘×œ×™ ×¨××™×•×ª ×—×–×§×•×ª.",
      "Cross-check ×‘×™×Ÿ Vision ×œ×‘×™×Ÿ local: ×× Vision ×‘×˜×•×— ××‘×œ structural × ××•×š â€“ ×œ×¢×‘×•×¨ ×œ-Ask.",
      "Reasoning trace ×˜×™×¤×•×¡×™ ×œ×›×œ ×¡×™×•×•×’ (debug drawer ×‘-UI)."
    ],
    "ui/ui.html": [
      "Ambiguity resolution: ×‘××§×•× dropdown â€“ 2â€“4 ×›×¤×ª×•×¨×™ ×‘×—×™×¨×” inline.",
      "×ª×¦×•×’×” ××§×“×™××” ×’×“×•×œ×” ×¢×“ ××—×¨×™ ××™×©×•×¨ (×œ× ×œ×›×•×•×¥ ×œ×¤× ×™).",
      "Status timeline ×§×•××¤×§×˜×™: ×¡×¨×™×§×” â†’ ×¡×™×’× ×œ×™× â†’ Gate â†’ ×‘×“×™×§×•×ª â†’ handoff."
    ],
    "src/protocol.ts": [
      "JOB_UPDATE ××—×™×“ ×¢× payload ××•×‘× ×” (stage/progress/trace/preview).",
      "Protocol versioning ×›×“×™ ×œ×× ×•×¢ ××™-×ª××™××•×ª UI/Main ×‘×–××Ÿ ××™×˜×¨×¦×™×•×ª."
    ],
    "Build/Deploy": [
      "build:watch ×©××“×¤×™×¡ ××” ×”×©×ª× ×” (UI/Main).",
      "deploy sanity: ××™××•×ª path ×©×œ manifest ×œ-dist/."
    ]
  },
  "architectureTasks": [
    {
      "id": "arch-01",
      "name": "Bounded traversal with collectNodeSignals",
      "status": "done",
      "note": "Done as bounded traversal v1 (maxDepth=2). Selection normalization deferred."
    },
    {
      "id": "arch-02",
      "name": "Detector contract standardization",
      "status": "done",
      "note": "Done for all components"
    },
    {
      "id": "arch-04",
      "name": "AI Skip Gate / Fusion",
      "status": "done",
      "note": "Done as Fusion v1 (local-first AI skip, threshold 0.85). Not global arbitration."
    }
  ]
}

==================================================
FILE_PATH: src/index.css
==================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --border: 214.3 31.8% 91.4%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}



==================================================
FILE_PATH: src/components/ui/index.ts
==================================================
export * from './card';
export * from './button';
export * from './input';
export * from './badge';
export * from './tabs';
export * from './scroll-area';
export * from './separator';
export * from './checkbox';



==================================================
FILE_PATH: src/hooks/useToast.ts
==================================================
import { useState, useCallback } from 'react';
import { Toast, ToastContainer } from '@/components/Toast';

let toastIdCounter = 0;

export function useToast() {
  const [toasts, setToasts] = useState<Toast[]>([]);

  const addToast = useCallback((toast: Omit<Toast, 'id'>) => {
    const id = `toast-${++toastIdCounter}`;
    setToasts((prev) => [...prev, { ...toast, id }]);
    return id;
  }, []);

  const removeToast = useCallback((id: string) => {
    setToasts((prev) => prev.filter((t) => t.id !== id));
  }, []);

  const showInfo = useCallback((title: string, message?: string) => {
    return addToast({ type: 'info', title, message });
  }, [addToast]);

  const showSuccess = useCallback((title: string, message?: string) => {
    return addToast({ type: 'success', title, message });
  }, [addToast]);

  const showWarning = useCallback((title: string, message?: string) => {
    return addToast({ type: 'warning', title, message });
  }, [addToast]);

  const showError = useCallback((title: string, message?: string) => {
    return addToast({ type: 'error', title, message });
  }, [addToast]);

  return {
    toasts,
    addToast,
    removeToast,
    showInfo,
    showSuccess,
    showWarning,
    showError,
    ToastContainer,
  };
}



==================================================
FILE_PATH: src/lib/utils.ts
==================================================
import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}



==================================================
FILE_PATH: src/data/loadData.ts
==================================================
/**
 * Data loading from xp-map repo
 * 
 * Strategy: 
 * 1. Try to fetch from GitHub API (always up-to-date)
 * 2. Fallback to local files (dashboard-sync.json + data/data.json)
 * 3. Fallback to default data
 */

const XP_MAP_REPO = 'haimXseb/xp-map';
const BRANCH = 'main';

export interface ExecutionLog {
  metadata: {
    version: string;
    lastUpdated: string;
    currentPhase: string;
    currentGoal: string;
  };
  blockers: Array<{
    id: string;
    title: string;
    description: string;
    severity: string;
    created: string;
  }>;
  phases: Array<{
    id: string;
    name: string;
    epics: Array<{
      id: string;
      name: string;
      status: string;
      owner: string;
      evidence: string;
      tasks: Array<{
        id: string;
        name: string;
        status: string;
        owner: string;
        evidence: string;
      }>;
    }>;
  }>;
  logEntries: Array<{
    timestamp: string;
    type: string;
    message: string;
    phase: string;
    files: string[];
  }>;
  reasoning: Array<{
    timestamp: string;
    action: string;
    why: string;
    relatedFiles: string[];
    phase: string;
  }>;
}

export interface ProjectData {
  meta: {
    name: string;
    updated: string;
    mvp: string;
    repo: string;
  };
  truth: {
    note: string;
    docs: Array<{ label: string; path: string }>;
  };
  pipeline: Array<{
    id: string;
    title: string;
    detail: string;
  }>;
  gates: {
    local: { confidence: number; structural: number };
    vision: { enabledByDefault: boolean; role: string };
  };
  build: {
    command: string;
    artifacts: Array<{ path: string; note: string }>;
  };
  storage: Array<{
    key: string;
    type: string;
    purpose: string;
  }>;
  files: {
    mustEdit: Array<{ path: string; why: string }>;
    dontEdit: Array<{ path: string; why: string }>;
  };
  recent: Array<{
    date: string;
    items: string[];
  }>;
  projectTree: {
    groups: Array<{
      title: string;
      nodes: Array<{ path: string; tags?: string[] }>;
    }>;
  };
  ideas: Record<string, string[]>;
  executionLog?: ExecutionLog;
  gitStatus?: {
    branch: string;
    workingTree: string;
    modifiedFiles: string[];
    ahead: number;
    behind: number;
    lastCommit: string;
    lastPush: string;
    timestamp: string;
  };
  progress?: {
    masterPlan: {
      total: number;
      completed: number;
      percentage: number;
    };
    rules: {
      total: number;
      implemented: number;
      percentage: number;
    };
  };
  notifications?: Array<{
    id: string;
    type: string;
    title: string;
    message: string;
    timestamp: string;
    read: boolean;
  }>;
  sync?: {
    metadata: {
      lastUpdated: string;
      version: string;
    };
    project: {
      name: string;
      mvp: string;
      currentPhase: string;
      currentGoal: string;
    };
    status: {
      blockers: any[];
      buildStatus: string;
      workingTree: string;
      branch: string;
    };
    progress: {
      masterPlan: { total: number; completed: number; percentage: number };
      rules: { total: number; implemented: number; percentage: number };
    };
  };
}

let cachedData: ProjectData | null = null;

async function fetchFromGitHub(path: string): Promise<any> {
  const url = `https://raw.githubusercontent.com/${XP_MAP_REPO}/${BRANCH}/${path}`;
  const response = await fetch(url);
  if (!response.ok) {
    throw new Error(`Failed to fetch ${path}: ${response.statusText}`);
  }
  return response.json();
}

async function loadLocalFiles(): Promise<{ sync?: any; data?: ProjectData }> {
  try {
    // Try to load from local files (if they exist from sync)
    // Use fetch instead of import to avoid build-time errors if files don't exist
    // Try multiple possible paths (with and without base path)
    const possibleSyncPaths = [
      '/xp-map/dashboard-sync.json',
      '/dashboard-sync.json',
      './dashboard-sync.json',
      '../dashboard-sync.json'
    ];
    const possibleDataPaths = [
      '/xp-map/data/data.json',
      '/data/data.json',
      './data/data.json',
      '../data/data.json'
    ];
    
    // Try all possible paths for sync file
    let sync: any = null;
    for (const path of possibleSyncPaths) {
      try {
        const response = await fetch(path);
        if (response.ok) {
          sync = await response.json();
          break;
        }
      } catch {
        // Continue to next path
      }
    }
    
    // Try all possible paths for data file
    let data: ProjectData | null = null;
    for (const path of possibleDataPaths) {
      try {
        const response = await fetch(path);
        if (response.ok) {
          data = await response.json();
          break;
        }
      } catch {
        // Continue to next path
      }
    }
    
    if (!sync && !data) {
      return {};
    }
    
    return {
      sync: sync || undefined,
      data: data || undefined
    };
  } catch (error) {
    console.warn('Failed to load local files:', error);
    return {};
  }
}

export async function loadProjectData(): Promise<ProjectData> {
  if (cachedData) {
    return cachedData;
  }

  // Strategy 1: Try GitHub API (always up-to-date)
  try {
    console.log('ğŸ“¡ Fetching data from GitHub API...');
    const [syncData, fullData] = await Promise.all([
      fetchFromGitHub('dashboard-sync.json'),
      fetchFromGitHub('data/data.json')
    ]);
    
    // Merge sync data into full data
    const mergedData: ProjectData = {
      ...fullData,
      sync: syncData,
      // Override with sync data if available
      meta: {
        ...fullData.meta,
        updated: syncData.metadata?.lastUpdated?.split('T')[0] || fullData.meta.updated
      },
      executionLog: {
        ...fullData.executionLog,
        metadata: {
          ...fullData.executionLog?.metadata,
          ...syncData.project,
          lastUpdated: syncData.metadata?.lastUpdated || fullData.executionLog?.metadata?.lastUpdated
        },
        blockers: syncData.status?.blockers || fullData.executionLog?.blockers || []
      },
      progress: syncData.progress || fullData.progress,
      notifications: syncData.notifications || []
    };
    
    cachedData = mergedData;
    console.log('âœ… Loaded data from GitHub API');
    return mergedData;
  } catch (error) {
    console.warn('âš ï¸  Failed to fetch from GitHub API, trying local files...', error);
  }

  // Strategy 2: Try local files (from sync)
  try {
    const local = await loadLocalFiles();
    if (local.data) {
      cachedData = {
        ...local.data,
        sync: local.sync
      };
      console.log('âœ… Loaded data from local files');
      return cachedData;
    }
  } catch (error) {
    console.warn('âš ï¸  Failed to load local files, using fallback...', error);
  }

  // Strategy 3: Fallback to default data
  console.warn('âš ï¸  Using fallback default data');
  return getDefaultData();
}

function getDefaultData(): ProjectData {
  return {
    meta: {
      name: "OZ â€“ Design-Time Accessibility Assistant",
      updated: new Date().toISOString().split('T')[0],
      mvp: "Text Field â€“ E2E",
      repo: "github.com/haimXseb/xp-map",
    },
    truth: {
      note: "Source of truth: Foundations + MVP rule pack. ×©××¨ ×”××¡××›×™× ×ª×•××›×™× ×‘×œ×‘×“.",
      docs: [
        { label: "Foundations â€“ engine logic", path: "docs/01-foundations/foundations-engine-logic.docx" },
        { label: "MVP rule pack", path: "docs/03-components/mvp-rule-pack.docx" },
      ],
    },
    pipeline: [
      { id: "select", title: "×‘×—×™×¨×”", detail: "×”××¢×¦×‘ ×‘×•×—×¨ × ×•×“ ×‘-Figma" },
      { id: "preview", title: "×ª×¦×•×’×” ××§×“×™××”", detail: "PNG ×‘×’×•×“×œ ×˜×‘×¢×™ ×¢× ×¨×§×¢ ×©×§×•×£" },
      { id: "type", title: "×–×™×”×•×™ ×¡×•×’ ×§×•××¤×•× × ×˜×”", detail: "×—×•×§×™× ××§×•××™×™× ×¢× Gate ×§×©×™×—" },
      { id: "intent", title: "Intent/Label", detail: "×‘×¨×™×¨×ª ××—×“×œ: Unknown. Auto-resolve ×¢×“ 3 ×”×•×¨×™×" },
      { id: "checks", title: "×‘×“×™×§×•×ª", detail: "TF-01â€¦TF-14 (WARN ×‘×œ×‘×“ ×‘-MVP)" },
      { id: "fix", title: "××•×˜×•-×¤×™×§×¡", detail: "×¨×§ Safe autofixes ×œ×¤×™ ×§×¨×™×˜×¨×™×•× ×™×" },
      { id: "handoff", title: "Handoff", detail: "×¤×œ×˜ ××•×‘× ×” ×œ×“×™×–×™×™×Ÿ + Dev" },
    ],
    gates: {
      local: { confidence: 0.85, structural: 0.35 },
      vision: { enabledByDefault: false, role: "Boost + sanity check (×œ× dependency)" },
    },
    build: {
      command: "npm run build",
      artifacts: [
        { path: "dist/src/code.js", note: "Main plugin bundle" },
        { path: "dist/ui.html", note: "UI bundle" },
        { path: "src/ui-inline.ts", note: "Generated â€“ ×œ× ×œ×¢×¨×•×š" },
      ],
    },
    storage: [
      { key: "aims.log", type: "Array<JobLog>", purpose: "×”×™×¡×˜×•×¨×™×™×ª ×”×¨×¦×•×ª (UNDO)" },
      { key: "ams-settings", type: "Settings", purpose: "×”×¢×“×¤×•×ª ××©×ª××© (provider/model/keys)" },
      { key: "OPENAI_API_KEY", type: "string", purpose: "××¤×ª×— AI Vision" },
    ],
    files: {
      mustEdit: [
        { path: "src/code.ts", why: "×œ×•×’×™×§×”: orchestrator + detectors + gates" },
        { path: "ui/ui.html", why: "UI + state machine" },
        { path: "src/protocol.ts", why: "×¤×¨×•×˜×•×§×•×œ ×”×•×“×¢×•×ª" },
      ],
      dontEdit: [
        { path: "src/ui-inline.ts", why: "Generated" },
        { path: "dist/*", why: "Build output" },
      ],
    },
    recent: [],
    projectTree: {
      groups: [],
    },
    ideas: {},
  } as ProjectData;
}


